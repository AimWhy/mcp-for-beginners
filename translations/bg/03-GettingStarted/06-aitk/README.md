<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "a3cbadbf632058aa59a523ac659aa1df",
  "translation_date": "2025-05-17T12:30:03+00:00",
  "source_file": "03-GettingStarted/06-aitk/README.md",
  "language_code": "bg"
}
-->
# Използване на сървър от разширението AI Toolkit за Visual Studio Code

Когато създавате AI агент, не става въпрос само за генериране на интелигентни отговори; става въпрос и за даване на възможност на вашия агент да предприема действия. Тук влиза в игра Протоколът за контекст на модела (MCP). MCP улеснява агентите да получават достъп до външни инструменти и услуги по последователен начин. Помислете за това като за свързване на вашия агент с кутия с инструменти, която той *наистина* може да използва.

Да кажем, че свържете агент към вашия сървър MCP калкулатор. Внезапно вашият агент може да извършва математически операции само като получи заявка като „Колко е 47 умножено по 89?“ — без нужда от твърдо кодиране на логика или създаване на персонализирани API.

## Преглед

Този урок обхваща как да свържете MCP сървър калкулатор към агент с разширението [AI Toolkit](https://aka.ms/AIToolkit) в Visual Studio Code, позволявайки на вашия агент да извършва математически операции като събиране, изваждане, умножение и деление чрез естествен език.

AI Toolkit е мощно разширение за Visual Studio Code, което улеснява разработването на агенти. AI инженерите могат лесно да създават AI приложения, като разработват и тестват генеративни AI модели — локално или в облака. Разширението поддържа повечето основни генеративни модели, налични днес.

*Забележка*: AI Toolkit в момента поддържа Python и TypeScript.

## Цели на обучението

До края на този урок ще можете:

- Да използвате MCP сървър чрез AI Toolkit.
- Да конфигурирате конфигурация на агент, за да му позволите да открива и използва инструменти, предоставени от MCP сървъра.
- Да използвате MCP инструменти чрез естествен език.

## Подход

Ето как трябва да подходим към това на високо ниво:

- Създайте агент и дефинирайте неговата системна заявка.
- Създайте MCP сървър с инструменти калкулатор.
- Свържете Builder на агенти към MCP сървъра.
- Тествайте извикването на инструмента на агента чрез естествен език.

Чудесно, сега, когато разбираме потока, нека конфигурираме AI агент да използва външни инструменти чрез MCP, подобрявайки неговите възможности!

## Предварителни изисквания

- [Visual Studio Code](https://code.visualstudio.com/)
- [AI Toolkit за Visual Studio Code](https://aka.ms/AIToolkit)

## Упражнение: Използване на сървър

В това упражнение ще създадете, стартирате и подобрите AI агент с инструменти от MCP сървър вътре в Visual Studio Code, използвайки AI Toolkit.

### -0- Предварителна стъпка, добавете модела OpenAI GPT-4o към Моите модели

Упражнението използва модела **GPT-4o**. Моделът трябва да бъде добавен към **Моите модели** преди създаването на агента.

1. Отворете разширението **AI Toolkit** от **Activity Bar**.
1. В секцията **Catalog** изберете **Models**, за да отворите **Model Catalog**. Избирането на **Models** отваря **Model Catalog** в нов редакторски таб.
1. В полето за търсене на **Model Catalog** въведете **OpenAI GPT-4o**.
1. Кликнете **+ Add**, за да добавите модела към вашия списък **My Models**. Уверете се, че сте избрали модела, който е **Hosted by GitHub**.
1. В **Activity Bar** потвърдете, че моделът **OpenAI GPT-4o** се появява в списъка.

### -1- Създайте агент

**Agent (Prompt) Builder** ви позволява да създавате и персонализирате свои собствени AI-управлявани агенти. В тази секция ще създадете нов агент и ще му зададете модел, който да захранва разговора.

1. Отворете разширението **AI Toolkit** от **Activity Bar**.
1. В секцията **Tools** изберете **Agent (Prompt) Builder**. Избирането на **Agent (Prompt) Builder** отваря **Agent (Prompt) Builder** в нов редакторски таб.
1. Кликнете бутона **+ New Builder**. Разширението ще стартира помощник за настройка чрез **Command Palette**.
1. Въведете името **Calculator Agent** и натиснете **Enter**.
1. В **Agent (Prompt) Builder**, за полето **Model**, изберете модела **OpenAI GPT-4o (via GitHub)**.

### -2- Създайте системна заявка за агента

След като агентът е създаден, е време да дефинирате неговата личност и цел. В тази секция ще използвате функцията **Generate system prompt**, за да опишете предвиденото поведение на агента — в този случай, агент калкулатор — и ще накарате модела да напише системната заявка вместо вас.

1. За секцията **Prompts** кликнете бутона **Generate system prompt**. Този бутон отваря в prompt builder, който използва AI, за да генерира системна заявка за агента.
1. В прозореца **Generate a prompt** въведете следното: `You are a helpful and efficient math assistant. When given a problem involving basic arithmetic, you respond with the correct result.`
1. Кликнете бутона **Generate**. В долния десен ъгъл ще се появи уведомление, потвърждаващо, че системната заявка се генерира. След като генерирането на заявката приключи, тя ще се появи в полето **System prompt** на **Agent (Prompt) Builder**.
1. Прегледайте **System prompt** и модифицирайте, ако е необходимо.

### -3- Създайте MCP сървър

Сега, след като сте дефинирали системната заявка на вашия агент — насочвайки неговото поведение и отговори — е време да оборудвате агента с практическите възможности. В тази секция ще създадете MCP сървър калкулатор с инструменти за изпълнение на събиране, изваждане, умножение и деление. Този сървър ще позволи на вашия агент да извършва математически операции в реално време в отговор на заявки на естествен език.

AI Toolkit е оборудван с шаблони за лесно създаване на ваш собствен MCP сървър. Ще използваме шаблона Python за създаване на MCP сървър калкулатор.

*Забележка*: AI Toolkit в момента поддържа Python и TypeScript.

1. В секцията **Tools** на **Agent (Prompt) Builder** кликнете бутона **+ MCP Server**. Разширението ще стартира помощник за настройка чрез **Command Palette**.
1. Изберете **+ Add Server**.
1. Изберете **Create a New MCP Server**.
1. Изберете **python-weather** като шаблон.
1. Изберете **Default folder** за запазване на шаблона MCP сървър.
1. Въведете следното име за сървъра: **Calculator**
1. Ще се отвори нов прозорец на Visual Studio Code. Изберете **Yes, I trust the authors**.
1. Използвайки терминала (**Terminal** > **New Terminal**), създайте виртуална среда: `python -m venv .venv`
1. Използвайки терминала, активирайте виртуалната среда:
    1. Windows - `.venv\Scripts\activate`
    1. macOS/Linux - `source venv/bin/activate`
1. Използвайки терминала, инсталирайте зависимостите: `pip install -e .[dev]`
1. В **Explorer** изгледа на **Activity Bar**, разширете директорията **src** и изберете **server.py**, за да отворите файла в редактора.
1. Заменете кода във файла **server.py** със следното и запазете:

    ```python
    """
    Sample MCP Calculator Server implementation in Python.

    
    This module demonstrates how to create a simple MCP server with calculator tools
    that can perform basic arithmetic operations (add, subtract, multiply, divide).
    """
    
    from mcp.server.fastmcp import FastMCP
    
    server = FastMCP("calculator")
    
    @server.tool()
    def add(a: float, b: float) -> float:
        """Add two numbers together and return the result."""
        return a + b
    
    @server.tool()
    def subtract(a: float, b: float) -> float:
        """Subtract b from a and return the result."""
        return a - b
    
    @server.tool()
    def multiply(a: float, b: float) -> float:
        """Multiply two numbers together and return the result."""
        return a * b
    
    @server.tool()
    def divide(a: float, b: float) -> float:
        """
        Divide a by b and return the result.
        
        Raises:
            ValueError: If b is zero
        """
        if b == 0:
            raise ValueError("Cannot divide by zero")
        return a / b
    ```

### -4- Стартирайте агента с MCP сървъра калкулатор

Сега, след като вашият агент има инструменти, е време да ги използва! В тази секция ще изпратите заявки на агента, за да тествате и потвърдите дали агентът използва подходящия инструмент от MCP сървъра калкулатор.

Ще стартирате MCP сървъра калкулатор на вашата локална dev машина чрез **Agent Builder** като MCP клиент.

1. Натиснете `F5` to start debugging the MCP server. The **Agent (Prompt) Builder** will open in a new editor tab. The status of the server is visible in the terminal.
1. In the **User prompt** field of the **Agent (Prompt) Builder**, enter the following prompt: `Купих 3 артикула на цена $25 всеки и след това използвах отстъпка от $20. Колко платих?`
1. Click the **Run** button to generate the agent's response.
1. Review the agent output. The model should conclude that you paid **$55**.
1. Here's a breakdown of what should occur:
    - The agent selects the **multiply** and **substract** tools to aid in the calculation.
    - The respective `a` and `b` values are assigned for the **multiply** tool.
    - The respective `a` and `b` стойности са зададени за инструмента **subtract**.
    - Отговорът от всеки инструмент е предоставен в съответния **Tool Response**.
    - Крайният изход от модела е предоставен в крайния **Model Response**.
1. Изпратете допълнителни заявки, за да тествате допълнително агента. Можете да модифицирате съществуващата заявка в полето **User prompt**, като кликнете в полето и замените съществуващата заявка.
1. След като приключите с тестването на агента, можете да спрете сървъра чрез **терминала**, като въведете **CTRL/CMD+C**, за да излезете.

## Задание

Опитайте да добавите допълнителен инструмент към вашия файл **server.py** (например: връщане на квадратния корен на число). Изпратете допълнителни заявки, които биха изисквали агентът да използва вашия нов инструмент (или съществуващи инструменти). Уверете се, че сте рестартирали сървъра, за да заредите новодобавените инструменти.

## Решение

[Решение](./solution/README.md)

## Основни изводи

Изводите от тази глава са следните:

- Разширението AI Toolkit е страхотен клиент, който ви позволява да използвате MCP сървъри и техните инструменти.
- Можете да добавяте нови инструменти към MCP сървъри, разширявайки възможностите на агента, за да отговорите на развиващите се изисквания.
- AI Toolkit включва шаблони (например шаблони за MCP сървър на Python), за да улесни създаването на персонализирани инструменти.

## Допълнителни ресурси

- [AI Toolkit docs](https://aka.ms/AIToolkit/doc)

## Какво следва

Следва: [Урок 4 Практическа реализация](/04-PracticalImplementation/README.md)

**Отказ от отговорност**:
Този документ е преведен с помощта на AI услуга за превод [Co-op Translator](https://github.com/Azure/co-op-translator). Въпреки че се стремим към точност, моля, имайте предвид, че автоматизираните преводи могат да съдържат грешки или неточности. Оригиналният документ на неговия роден език трябва да се счита за авторитетен източник. За критична информация се препоръчва професионален човешки превод. Не носим отговорност за никакви недоразумения или погрешни интерпретации, възникнали от използването на този превод.