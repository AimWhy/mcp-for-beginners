<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "c69f9df7f3215dac8d056020539bac36",
  "translation_date": "2025-07-04T18:58:06+00:00",
  "source_file": "02-Security/README.md",
  "language_code": "bg"
}
-->
# Най-добри практики за сигурност

Приемането на Model Context Protocol (MCP) носи мощни нови възможности за приложения, базирани на изкуствен интелект, но също така въвежда уникални предизвикателства по отношение на сигурността, които надхвърлят традиционните рискове при софтуера. Освен установените проблеми като сигурно кодиране, принципа на най-малките привилегии и сигурността на веригата за доставки, MCP и AI натоварванията са изложени на нови заплахи като prompt injection, отравяне на инструменти и динамична модификация на инструменти. Тези рискове могат да доведат до изтичане на данни, нарушения на поверителността и нежелано поведение на системата, ако не се управляват правилно.

Този урок разглежда най-значимите рискове за сигурността, свързани с MCP — включително удостоверяване, авторизация, прекомерни права, индиректен prompt injection и уязвимости във веригата за доставки — и предоставя практически контролни мерки и най-добри практики за тяхното смекчаване. Ще научите и как да използвате решения на Microsoft като Prompt Shields, Azure Content Safety и GitHub Advanced Security, за да укрепите вашата MCP имплементация. Чрез разбирането и прилагането на тези контролни мерки можете значително да намалите вероятността от пробив в сигурността и да гарантирате, че вашите AI системи остават стабилни и надеждни.

# Учебни цели

Към края на този урок ще можете да:

- Идентифицирате и обясните уникалните рискове за сигурността, въведени от Model Context Protocol (MCP), включително prompt injection, отравяне на инструменти, прекомерни права и уязвимости във веригата за доставки.
- Описвате и прилагате ефективни мерки за смекчаване на рисковете за сигурността на MCP, като надеждно удостоверяване, принцип на най-малките привилегии, сигурно управление на токени и проверка на веригата за доставки.
- Разбирате и използвате решения на Microsoft като Prompt Shields, Azure Content Safety и GitHub Advanced Security за защита на MCP и AI натоварвания.
- Разпознавате важността на валидирането на метаданни на инструменти, мониторинга за динамични промени и защитата срещу индиректни prompt injection атаки.
- Интегрирате установени най-добри практики за сигурност — като сигурно кодиране, затягане на сървъри и архитектура с нулево доверие — във вашата MCP имплементация, за да намалите вероятността и въздействието от пробиви в сигурността.

# Контролни мерки за сигурност на MCP

Всяка система, която има достъп до важни ресурси, има подразбиращи се предизвикателства по отношение на сигурността. Тези предизвикателства обикновено могат да бъдат адресирани чрез правилното прилагане на основни контролни мерки и концепции за сигурност. Тъй като MCP е сравнително нов протокол, спецификацията му се променя много бързо и с развитието на протокола, контролите за сигурност в него ще узреят, позволявайки по-добра интеграция с корпоративни и утвърдени архитектури и най-добри практики за сигурност.

Изследване, публикувано в [Microsoft Digital Defense Report](https://aka.ms/mddr), посочва, че 98% от докладваните пробиви биха могли да бъдат предотвратени чрез стриктна хигиена на сигурността, а най-добрата защита срещу всякакъв вид пробив е да имате правилно базово ниво на хигиена на сигурността, най-добри практики за сигурно кодиране и сигурност на веригата за доставки — тези изпитани и доказани практики все още имат най-голямо влияние за намаляване на риска.

Нека разгледаме някои от начините, по които можете да започнете да адресирате рисковете за сигурността при приемането на MCP.

> **Note:** Следващата информация е актуална към **29 май 2025 г.** MCP протоколът се развива непрекъснато и бъдещите имплементации може да въведат нови модели и контролни мерки за удостоверяване. За най-новите актуализации и насоки винаги се обръщайте към [MCP Specification](https://spec.modelcontextprotocol.io/) и официалното [MCP GitHub хранилище](https://github.com/modelcontextprotocol) и [страницата с най-добри практики за сигурност](https://modelcontextprotocol.io/specification/draft/basic/security_best_practices).

### Описание на проблема  
Първоначалната спецификация на MCP предполагаше, че разработчиците ще изградят собствен удостоверителен сървър. Това изискваше познания за OAuth и свързаните с него ограничения за сигурност. MCP сървърите действаха като OAuth 2.0 Authorization Servers, управлявайки необходимото удостоверяване на потребителите директно, вместо да го делегират на външна услуга като Microsoft Entra ID. От **26 април 2025 г.** актуализация на спецификацията позволява MCP сървърите да делегират удостоверяването на потребителите към външна услуга.

### Рискове
- Неправилно конфигурираната логика за авторизация в MCP сървъра може да доведе до излагане на чувствителни данни и неправилно прилагане на контролите за достъп.
- Кражба на OAuth токен на локалния MCP сървър. Ако токенът бъде откраднат, той може да се използва за имитиране на MCP сървъра и достъп до ресурси и данни от услугата, за която е издаден токенът.

#### Token Passthrough
Token passthrough е изрично забранен в спецификацията за авторизация, тъй като въвежда редица рискове за сигурността, включително:

#### Заобикаляне на контролите за сигурност
MCP сървърът или downstream API-тата може да прилагат важни контролни мерки като ограничаване на честотата на заявки, валидиране на заявки или мониторинг на трафика, които зависят от аудиторията на токена или други ограничения на удостоверенията. Ако клиентите могат да получават и използват токени директно с downstream API-тата без MCP сървърът да ги валидира правилно или да гарантира, че токените са издадени за правилната услуга, те заобикалят тези контролни мерки.

#### Проблеми с отчетността и одитния след
MCP сървърът няма да може да идентифицира или различава MCP клиентите, когато клиентите извършват заявки с токен за достъп, издаден от upstream, който може да е непрозрачен за MCP сървъра. Логовете на downstream Resource Server може да показват заявки, които изглежда идват от различен източник с различна идентичност, а не от MCP сървъра, който всъщност препраща токените. И двата фактора затрудняват разследването на инциденти, контрола и одита. Ако MCP сървърът препраща токени без да валидира техните твърдения (например роли, привилегии или аудитория) или други метаданни, злонамерен актьор, който разполага с откраднат токен, може да използва сървъра като прокси за изтичане на данни.

#### Проблеми с границата на доверие
Downstream Resource Server предоставя доверие на конкретни субекти. Това доверие може да включва предположения за произход или модели на поведение на клиента. Нарушаването на тази граница на доверие може да доведе до неочаквани проблеми. Ако токенът се приема от множество услуги без правилна валидация, нападател, компрометирал една услуга, може да използва токена за достъп до други свързани услуги.

#### Риск за бъдеща съвместимост
Дори ако MCP сървърът започне като „чист прокси“ днес, може да се наложи да добави контролни мерки за сигурност по-късно. Започването с правилно разделяне на аудиторията на токените улеснява развитието на модела за сигурност.

### Мерки за смекчаване

**MCP сървърите НЕ ТРЯБВА да приемат никакви токени, които не са изрично издадени за MCP сървъра**

- **Преглед и затягане на логиката за авторизация:** Внимателно одитирайте имплементацията на авторизацията на вашия MCP сървър, за да гарантирате, че само предвидените потребители и клиенти имат достъп до чувствителни ресурси. За практическо ръководство вижте [Azure API Management Your Auth Gateway For MCP Servers | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) и [Using Microsoft Entra ID To Authenticate With MCP Servers Via Sessions - Den Delimarsky](https://den.dev/blog/mcp-server-auth-entra-id-session/).
- **Прилагане на сигурни практики за токени:** Следвайте [най-добрите практики на Microsoft за валидиране и живот на токените](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens), за да предотвратите злоупотреба с токени за достъп и да намалите риска от повторно използване или кражба на токени.
- **Защита на съхранението на токени:** Винаги съхранявайте токените сигурно и използвайте криптиране, за да ги защитите както в покой, така и при пренос. За съвети по имплементация вижте [Use secure token storage and encrypt tokens](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2).

# Прекомерни права за MCP сървъри

### Описание на проблема
MCP сървърите може да са получили прекомерни права за услугата или ресурса, до който имат достъп. Например, MCP сървър, който е част от AI приложение за продажби и се свързва с корпоративно хранилище на данни, трябва да има достъп само до данните за продажбите и не трябва да има достъп до всички файлове в хранилището. Връщайки се към принципа на най-малките привилегии (един от най-старите принципи за сигурност), никой ресурс не трябва да има права, надвишаващи необходимите за изпълнение на предназначените задачи. AI представя допълнително предизвикателство в тази област, тъй като за да бъде гъвкав, е трудно да се дефинират точно необходимите права.

### Рискове  
- Даване на прекомерни права може да позволи изтичане или промяна на данни, до които MCP сървърът не би трябвало да има достъп. Това може да бъде и проблем с поверителността, ако данните са лична идентифицираща информация (PII).

### Мерки за смекчаване
- **Прилагане на принципа на най-малките привилегии:** Давайте на MCP сървъра само минималните права, необходими за изпълнение на задачите му. Редовно преглеждайте и актуализирайте тези права, за да гарантирате, че не надвишават необходимото. За подробни насоки вижте [Secure least-privileged access](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access).
- **Използване на контрол на достъпа, базиран на роли (RBAC):** Присвоявайте роли на MCP сървъра, които са строго ограничени до конкретни ресурси и действия, като избягвате широки или ненужни права.
- **Мониторинг и одит на правата:** Непрекъснато наблюдавайте използването на правата и одитирайте логовете за достъп, за да откривате и коригирате прекомерни или неизползвани привилегии своевременно.

# Индиректни prompt injection атаки

### Описание на проблема

Злонамерени или компрометирани MCP сървъри могат да въведат значителни рискове чрез излагане на клиентски данни или позволяване на нежелани действия. Тези рискове са особено релевантни при AI и натоварвания, базирани на MCP, където:

- **Prompt Injection Атаки:** Нападатели вграждат злонамерени инструкции в prompt-и или външно съдържание, карайки AI системата да извършва нежелани действия или да изтича чувствителна информация. Научете повече: [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- **Отравяне на инструменти:** Нападатели манипулират метаданните на инструментите (като описания или параметри), за да влияят на поведението на AI, потенциално заобикаляйки контролите за сигурност или изтичащи данни. Подробности: [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- **Cross-Domain Prompt Injection:** Злонамерени инструкции са вградени в документи, уеб страници или имейли, които след това се обработват от AI, водейки до изтичане или манипулация на данни.
- **Динамична модификация на инструменти (Rug Pulls):** Дефинициите на инструментите могат да бъдат променяни след одобрение от потребителя, въвеждайки нови злонамерени поведения без знанието на потребителя.

Тези уязвимости подчертават необходимостта от надеждна валидация, мониторинг и контролни мерки за сигурност при интегриране на MCP сървъри и инструменти във вашата среда. За по-задълбочено разглеждане вижте посочените по-горе препратки.

![prompt-injection-lg-2048x1034](../../../translated_images/prompt-injection.ed9fbfde297ca877c15bc6daa808681cd3c3dc7bf27bbbda342ef1ba5fc4f52d.bg.png)

**Индиректен Prompt Injection** (известен още като cross-domain prompt injection или XPIA) е критична уязвимост в генеративните AI системи, включително тези, използващи Model Context Protocol (MCP). При тази атака злонамерени инструкции са скрити във външно съдържание — като документи, уеб страници или имейли. Когато AI системата обработва това съдържание, тя може да интерпретира вградените инструкции като легитимни команди от потребителя, което води до нежелани действия като изтичане на данни, генериране на вредно съдържание или манипулация на взаимодействията с потребителя. За подробно обяснение и реални примери вижте [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/).

Особено опасна форма на тази атака е **Отравянето на инструменти**. Тук нападателите вмъкват злонамерени инструкции в метаданните на MCP инструментите (като описания или параметри). Тъй като големите езикови модели (LLM) разчитат на тези метаданни, за да решат кои инструменти да извикат, компрометираните описания могат да заблудят модела да изпълни неоторизирани повиквания на инструменти или да заобиколи контролите за сигурност. Тези манипулации често са невидими за крайните потребители, но могат да бъдат интерпретирани и изпълнени от AI системата. Този риск е засилен в хоствани MCP сървърни среди, където дефинициите на инструментите могат да се актуализират след одобрение от потребителя — сценарий, понякога наричан „[rug pull](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)“. В такива случаи инструмент, който преди е бил безопасен, може по-късно да бъде модифициран да извършва злонамерени действия, като изтичане на данни или промяна на поведението на системата, без знанието на потребителя. За повече информация относно този вектор на атака вижте [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks).

![tool-injection-lg-2048x1239 (1)](../images/02-Security/tool-in
Сигурността на веригата за доставки остава фундаментална в ерата на изкуствения интелект, но обхватът на това, което се счита за ваша верига за доставки, се е разширил. Освен традиционните кодови пакети, сега трябва стриктно да проверявате и наблюдавате всички компоненти, свързани с ИИ, включително основни модели, услуги за вграждане, доставчици на контекст и външни API-та. Всеки от тях може да въведе уязвимости или рискове, ако не се управлява правилно.

**Ключови практики за сигурност на веригата за доставки за ИИ и MCP:**
- **Проверявайте всички компоненти преди интеграция:** Това включва не само библиотеки с отворен код, но и ИИ модели, източници на данни и външни API-та. Винаги проверявайте произхода, лицензирането и известните уязвимости.
- **Поддържайте сигурни процеси за внедряване:** Използвайте автоматизирани CI/CD процеси с вградени сканирания за сигурност, за да откривате проблеми рано. Уверете се, че в продукция се внедряват само доверени артефакти.
- **Непрекъснато наблюдавайте и одитирайте:** Внедрете постоянен мониторинг на всички зависимости, включително модели и услуги за данни, за да откривате нови уязвимости или атаки върху веригата за доставки.
- **Прилагайте принципа на най-малките привилегии и контрол на достъпа:** Ограничете достъпа до модели, данни и услуги само до необходимото за функционирането на вашия MCP сървър.
- **Реагирайте бързо на заплахи:** Осигурете процес за поправяне или замяна на компрометирани компоненти и за ротация на тайни или идентификационни данни при откриване на пробив.

[GitHub Advanced Security](https://github.com/security/advanced-security) предлага функции като сканиране за тайни, сканиране на зависимости и анализ с CodeQL. Тези инструменти се интегрират с [Azure DevOps](https://azure.microsoft.com/en-us/products/devops) и [Azure Repos](https://azure.microsoft.com/en-us/products/devops/repos/), за да помогнат на екипите да идентифицират и смекчат уязвимости както в кода, така и в компонентите на ИИ веригата за доставки.

Microsoft също прилага обширни практики за сигурност на веригата за доставки вътрешно за всички продукти. Научете повече в [The Journey to Secure the Software Supply Chain at Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/).


# Утвърдени най-добри практики за сигурност, които ще подобрят сигурността на вашата MCP имплементация

Всяка MCP имплементация наследява съществуващата сигурност на средата на вашата организация, върху която е изградена, затова при разглеждане на сигурността на MCP като компонент от цялостните ви ИИ системи се препоръчва да подобрите общата си съществуваща сигурност. Следните утвърдени контролни мерки са особено релевантни:

-   Най-добри практики за сигурно кодиране във вашето ИИ приложение – защита срещу [OWASP Top 10](https://owasp.org/www-project-top-ten/), [OWASP Top 10 за LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559), използване на сигурни хранилища за тайни и токени, внедряване на криптирана комуникация между всички компоненти на приложението и др.
-   Укрепване на сървъра – използвайте MFA, където е възможно, поддържайте системата актуализирана с пачове, интегрирайте сървъра с външен доставчик на идентичност за достъп и др.
-   Поддържайте устройствата, инфраструктурата и приложенията актуализирани с пачове
-   Мониторинг на сигурността – внедряване на логване и мониторинг на ИИ приложението (включително MCP клиент/сървъри) и изпращане на тези логове към централен SIEM за откриване на аномални дейности
-   Архитектура с нулево доверие – изолиране на компонентите чрез мрежови и идентификационни контроли по логичен начин, за да се минимизира страничното движение при компрометиране на ИИ приложението.

# Основни изводи

- Основите на сигурността остават критични: сигурно кодиране, принцип на най-малките привилегии, проверка на веригата за доставки и непрекъснат мониторинг са от съществено значение за MCP и ИИ натоварвания.
- MCP въвежда нови рискове – като инжектиране на подсказки, отравяне на инструменти и прекомерни разрешения, които изискват както традиционни, така и специфични за ИИ контроли.
- Използвайте надеждни практики за удостоверяване, авторизация и управление на токени, като се възползвате от външни доставчици на идентичност като Microsoft Entra ID, когато е възможно.
- Защитете се от косвено инжектиране на подсказки и отравяне на инструменти чрез валидиране на метаданни на инструментите, мониторинг на динамични промени и използване на решения като Microsoft Prompt Shields.
- Отнасяйте се към всички компоненти във вашата ИИ верига за доставки – включително модели, вграждания и доставчици на контекст – със същата строгост, както към зависимостите в кода.
- Бъдете в крак с развиващите се спецификации на MCP и допринасяйте за общността, за да помогнете за формирането на сигурни стандарти.

# Допълнителни ресурси

- [Microsoft Digital Defense Report](https://aka.ms/mddr)
- [MCP Specification](https://spec.modelcontextprotocol.io/)
- [Prompt Injection in MCP (Simon Willison)](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- [Tool Poisoning Attacks (Invariant Labs)](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- [Rug Pulls in MCP (Wiz Security)](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)
- [Prompt Shields Documentation (Microsoft)](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [OWASP Top 10 for LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559)
- [GitHub Advanced Security](https://github.com/security/advanced-security)
- [Azure DevOps](https://azure.microsoft.com/products/devops)
- [Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [The Journey to Secure the Software Supply Chain at Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)
- [Secure Least-Privileged Access (Microsoft)](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [Best Practices for Token Validation and Lifetime](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [Use Secure Token Storage and Encrypt Tokens (YouTube)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)
- [Azure API Management as Auth Gateway for MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [MCP Security Best Practice](https://modelcontextprotocol.io/specification/draft/basic/security_best_practices)
- [Using Microsoft Entra ID to Authenticate with MCP Servers](https://den.dev/blog/mcp-server-auth-entra-id-session/)

### Следващо

Следващо: [Глава 3: Първи стъпки](../03-GettingStarted/README.md)

**Отказ от отговорност**:  
Този документ е преведен с помощта на AI преводаческа услуга [Co-op Translator](https://github.com/Azure/co-op-translator). Въпреки че се стремим към точност, моля, имайте предвид, че автоматизираните преводи могат да съдържат грешки или неточности. Оригиналният документ на неговия роден език трябва да се счита за авторитетен източник. За критична информация се препоръчва професионален човешки превод. Ние не носим отговорност за каквито и да е недоразумения или неправилни тълкувания, произтичащи от използването на този превод.