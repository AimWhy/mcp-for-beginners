<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "f00aedb7b1d11b7eaacb0618d8791c65",
  "translation_date": "2025-05-29T23:37:31+00:00",
  "source_file": "02-Security/README.md",
  "language_code": "bg"
}
-->
# Най-добри практики за сигурност

Приемането на Model Context Protocol (MCP) носи мощни нови възможности за приложения, базирани на изкуствен интелект, но също така въвежда уникални предизвикателства по отношение на сигурността, които надхвърлят традиционните рискове в софтуера. Освен утвърдените въпроси като сигурно кодиране, принципа за минимални права и сигурността на доставната верига, MCP и AI работните натоварвания са изложени на нови заплахи като prompt injection, отравяне на инструменти и динамична модификация на инструменти. Тези рискове могат да доведат до изтичане на данни, нарушения на поверителността и нежелано поведение на системата, ако не бъдат управлявани правилно.

Този урок разглежда най-значимите рискове за сигурността, свързани с MCP — включително удостоверяване, авторизация, прекомерни права, косвено prompt injection и уязвимости в доставната верига — и предоставя практически мерки и най-добри практики за тяхното смекчаване. Ще научите също как да използвате решения на Microsoft като Prompt Shields, Azure Content Safety и GitHub Advanced Security за укрепване на вашата MCP реализация. Чрез разбиране и прилагане на тези мерки можете значително да намалите вероятността от пробив в сигурността и да гарантирате, че вашите AI системи остават стабилни и надеждни.

# Учебни цели

Към края на този урок ще можете да:

- Идентифицирате и обясните уникалните рискове за сигурността, които въвежда Model Context Protocol (MCP), включително prompt injection, отравяне на инструменти, прекомерни права и уязвимости в доставната верига.
- Описвате и прилагате ефективни мерки за смекчаване на рисковете за сигурността на MCP, като надеждно удостоверяване, принципа на минимални права, сигурно управление на токени и проверка на доставната верига.
- Разбирате и използвате решения на Microsoft като Prompt Shields, Azure Content Safety и GitHub Advanced Security за защита на MCP и AI работните натоварвания.
- Разпознавате значението на валидирането на метаданни на инструменти, мониторинга за динамични промени и защитата срещу косвени атаки с prompt injection.
- Интегрирате утвърдени най-добри практики за сигурност — като сигурно кодиране, затягане на сървъри и архитектура с нулево доверие — в своята MCP реализация, за да намалите вероятността и въздействието на пробиви в сигурността.

# MCP мерки за сигурност

Всяка система с достъп до важни ресурси има присъщи предизвикателства по отношение на сигурността. Обикновено тези предизвикателства могат да бъдат адресирани чрез правилното прилагане на основни мерки и концепции за сигурност. Тъй като MCP е сравнително нов протокол, спецификацията му се променя много бързо и с развитието на протокола мерките за сигурност в него ще се усъвършенстват, позволявайки по-добра интеграция с корпоративни и утвърдени архитектури и най-добри практики за сигурност.

Изследване, публикувано в [Microsoft Digital Defense Report](https://aka.ms/mddr), посочва, че 98% от докладваните пробиви биха могли да бъдат предотвратени с добра хигиена на сигурността, а най-добрата защита срещу всякакъв вид пробив е да имате основна хигиена на сигурността, най-добри практики за сигурно кодиране и сигурност на доставната верига — тези изпитани и доказани практики все още имат най-голямо въздействие при намаляване на риска.

Нека разгледаме някои от начините, по които можете да започнете да адресирате рисковете за сигурността при приемането на MCP.

> **Note:** Следващата информация е вярна към **29 май 2025 г.** MCP протоколът постоянно се развива и бъдещите реализации могат да въведат нови модели на удостоверяване и мерки за контрол. За най-актуална информация и насоки винаги се обръщайте към [MCP Specification](https://spec.modelcontextprotocol.io/) и официалното [MCP GitHub хранилище](https://github.com/modelcontextprotocol) и [страница с най-добри практики за сигурност](https://modelcontextprotocol.io/specification/draft/basic/security_best_practices).

### Описание на проблема  
Първоначалната спецификация на MCP предполагаше, че разработчиците ще изградят собствен удостоверяващ сървър. Това изискваше познания по OAuth и свързаните с него ограничения за сигурност. MCP сървърите действаха като OAuth 2.0 Authorization Servers, управлявайки потребителското удостоверяване директно, вместо да го делегират на външна услуга като Microsoft Entra ID. Към **26 април 2025 г.** актуализация на спецификацията позволява на MCP сървърите да делегират удостоверяването на потребителите на външна услуга.

### Рискове
- Грешно конфигурирана логика за авторизация в MCP сървъра може да доведе до излагане на чувствителни данни и неправилно прилагане на контролите за достъп.
- Кражба на OAuth токени на локалния MCP сървър. Ако токенът бъде откраднат, той може да се използва за представяне на MCP сървъра и достъп до ресурси и данни от услугата, за която е издаден.

#### Token Passthrough
Token passthrough е изрично забранен в спецификацията за авторизация, тъй като въвежда редица рискове за сигурността, включително:

#### Заобикаляне на мерките за сигурност
MCP сървърът или downstream API-тата може да прилагат важни мерки за сигурност като ограничаване на честотата на заявките, валидиране на заявки или мониторинг на трафика, които зависят от аудиторията на токена или други ограничения на идентификационните данни. Ако клиентите могат да получават и използват токени директно с downstream API, без MCP сървърът да ги валидира правилно или да гарантира, че токените са издадени за правилната услуга, те заобикалят тези мерки.

#### Проблеми с отчетността и одитния следа
MCP сървърът няма да може да идентифицира или различава MCP клиентите, когато клиентите използват достъпни токени, издадени от upstream, които могат да са непрозрачни за MCP сървъра. Логовете на downstream Resource Server могат да показват заявки, които изглеждат като идващи от различен източник с различна идентичност, а не от MCP сървъра, който всъщност препраща токените. И двата фактора затрудняват разследването на инциденти, контрола и одита. Ако MCP сървърът препраща токени без да валидира техните твърдения (напр. роли, привилегии или аудитория) или други метаданни, злонамерен участник, който разполага с откраднат токен, може да използва сървъра като прокси за изтичане на данни.

#### Проблеми с границата на доверие
Downstream Resource Server предоставя доверие на конкретни субекти. Това доверие може да включва предположения за произход или поведенчески модели на клиента. Нарушаването на тази граница може да доведе до неочаквани проблеми. Ако токенът бъде приет от няколко услуги без правилна валидация, атакуващ, който компрометира една услуга, може да използва токена за достъп до други свързани услуги.

#### Риск за съвместимост в бъдеще
Дори ако MCP сървърът започне като „чист прокси“ днес, по-късно може да се наложи да добави мерки за сигурност. Започването с правилно разделяне на аудиторията на токена улеснява развитието на модела за сигурност.

### Мерки за смекчаване

**MCP сървърите НЕ ТРЯБВА да приемат никакви токени, които не са изрично издадени за MCP сървъра**

- **Преглед и затягане на логиката за авторизация:** Внимателно одитирайте имплементацията на авторизация на вашия MCP сървър, за да гарантирате, че само предназначените потребители и клиенти имат достъп до чувствителни ресурси. За практически насоки вижте [Azure API Management Your Auth Gateway For MCP Servers | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) и [Using Microsoft Entra ID To Authenticate With MCP Servers Via Sessions - Den Delimarsky](https://den.dev/blog/mcp-server-auth-entra-id-session/).
- **Прилагане на сигурни практики за токени:** Следвайте [най-добрите практики на Microsoft за валидиране и живот на токените](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens), за да предотвратите злоупотреба с токени за достъп и да намалите риска от повторно използване или кражба на токени.
- **Защита на съхранението на токени:** Винаги съхранявайте токените сигурно и използвайте криптиране за защита както при покой, така и при трансфер. За съвети при имплементация вижте [Use secure token storage and encrypt tokens](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2).

# Прекомерни права за MCP сървъри

### Описание на проблема
MCP сървърите могат да имат прекомерни права върху услугата или ресурса, до който имат достъп. Например MCP сървър, който е част от AI приложение за продажби и се свързва с корпоративна база данни, трябва да има достъп ограничен само до данните за продажбите и да няма разрешение да достъпва всички файлове в базата. Спазвайки принципа на минимални права (един от най-старите принципи за сигурност), никой ресурс не трябва да има права, които надхвърлят необходимото за изпълнение на задачите, за които е предназначен. AI добавя допълнително предизвикателство, тъй като за да бъде гъвкав, понякога е трудно да се дефинират точно необходимите права.

### Рискове  
- Даване на прекомерни права може да позволи изтичане или промяна на данни, до които MCP сървърът не би трябвало да има достъп. Това може да бъде и проблем с поверителността, ако данните са лична идентифицираща информация (PII).

### Мерки за смекчаване
- **Прилагане на принципа на минимални права:** Давайте на MCP сървъра само минималните необходими права за изпълнение на задачите му. Редовно преглеждайте и актуализирайте тези права, за да гарантирате, че не надхвърлят нуждите. За подробни насоки вижте [Secure least-privileged access](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access).
- **Използване на контрол на достъпа базиран на роли (RBAC):** Присвоявайте на MCP сървъра роли, които са стриктно ограничени до конкретни ресурси и действия, като избягвате широки или ненужни права.
- **Мониторинг и одит на правата:** Непрекъснато следете използването на правата и одитирайте логовете за достъп, за да откривате и коригирате прекомерни или неизползвани привилегии своевременно.

# Косвени атаки с prompt injection

### Описание на проблема

Злонамерени или компрометирани MCP сървъри могат да въведат сериозни рискове чрез излагане на клиентски данни или активиране на нежелани действия. Тези рискове са особено актуални при AI и работни натоварвания, базирани на MCP, където:

- **Атаки с prompt injection**: Атакуващите вграждат злонамерени инструкции в prompt-и или външно съдържание, карайки AI системата да изпълнява нежелани действия или да изтича чувствителна информация. Научете повече: [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- **Отравяне на инструменти**: Атакуващите манипулират метаданните на инструментите (като описания или параметри), за да влияят на поведението на AI, евентуално заобикаляйки мерки за сигурност или изнасяйки данни. Повече информация: [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- **Кросдомейн prompt injection**: Злонамерени инструкции се вграждат в документи, уеб страници или имейли, които след това се обработват от AI, водейки до изтичане или манипулация на данни.
- **Динамична модификация на инструменти (Rug Pulls)**: Дефинициите на инструментите могат да се променят след одобрение от потребителя, въвеждайки нови злонамерени поведения без знанието му.

Тези уязвимости подчертават нуждата от надеждна валидация, мониторинг и мерки за сигурност при интегриране на MCP сървъри и инструменти във вашата среда. За по-задълбочена информация вижте посочените по-горе препратки.

![prompt-injection-lg-2048x1034](../../../translated_images/prompt-injection.ed9fbfde297ca877c15bc6daa808681cd3c3dc7bf27bbbda342ef1ba5fc4f52d.bg.png)

**Косвен prompt injection** (известен още като cross-domain prompt injection или XPIA) е критична уязвимост в генеративните AI системи, включително тези, използващи Model Context Protocol (MCP). При тази атака злонамерени инструкции се скриват във външно съдържание — като документи, уеб страници или имейли. Когато AI системата обработва това съдържание, тя може да интерпретира вградените инструкции като легитимни потребителски команди, което води до нежелани действия като изтичане на данни, генериране на вредно съдържание или манипулация на взаимодействията с потребителя. За подробно обяснение и реални примери вижте [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/).

Особено опасна форма на тази атака е **отравянето на инструменти**. Тук атакуващите инжектират злонамерени инструкции в метаданните на MCP инструментите (като описания или параметри). Тъй като големите езикови модели (LLM) разчитат на тези метаданни, за да решат кои инструменти да извикат, компрометираните описания могат да заблудят модела да изпълни неоторизирани повиквания на инструменти или да заобиколи мерки за сигурност. Тези манипулации често са невидими за крайния потребител, но могат да бъдат интерпретирани и изпълнени от AI системата. Рискът е по-голям при хоствани MCP сървърни среди, където дефинициите на инструментите могат да бъдат актуализирани след одобрение от потребителя — ситуация, понякога наричана "[rug pull](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)". В такива случаи инструмент, който преди е бил безопасен, може по-късно да бъде модифициран да извършва злонамерени действия, като изтичане на данни или промяна на поведението на системата, без знанието на потребителя. За повече информация за този вектор на атака вижте [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks).

![tool-injection-lg-2048x1239 (1)](../../../translated_images/tool-injection.3b0b4a6b24de6befe7d3afdeae44138ef005881aebcfc84c6f61369ce31e3640.bg.png)

## Рискове
Нежеланите действия на AI представят различни рискове за сигурността, включително изтичане на данни и нарушения на поверителността.

### Мерки за смекчав
- [OWASP Топ 10](https://owasp.org/www-project-top-ten/)
- [OWASP Топ 10 за LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559)
- [GitHub Advanced Security](https://github.com/security/advanced-security)
- [Azure DevOps](https://azure.microsoft.com/products/devops)
- [Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [Пътят към осигуряване на веригата за доставка на софтуер в Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)
- [Сигурен достъп с минимални привилегии (Microsoft)](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [Добри практики за валидиране и срок на валидност на токени](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [Използване на сигурно съхранение на токени и криптиране на токените (YouTube)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)
- [Azure API Management като шлюз за удостоверяване за MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [Най-добри практики за сигурност на MCP](https://modelcontextprotocol.io/specification/draft/basic/security_best_practices)
- [Използване на Microsoft Entra ID за удостоверяване с MCP сървъри](https://den.dev/blog/mcp-server-auth-entra-id-session/)

### Следващо

Следващо: [Глава 3: Започване](/03-GettingStarted/README.md)

**Отказ от отговорност**:  
Този документ е преведен с помощта на AI преводаческа услуга [Co-op Translator](https://github.com/Azure/co-op-translator). Въпреки че се стремим към точност, моля, имайте предвид, че автоматизираните преводи могат да съдържат грешки или неточности. Оригиналният документ на неговия роден език трябва да се счита за авторитетен източник. За критична информация се препоръчва професионален човешки превод. Ние не носим отговорност за каквито и да е недоразумения или неправилни тълкувания, възникнали от използването на този превод.