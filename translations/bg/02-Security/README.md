<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "98be664d3b19a81ee24fa3f920233864",
  "translation_date": "2025-05-20T23:26:49+00:00",
  "source_file": "02-Security/README.md",
  "language_code": "bg"
}
-->
# Security Best Practices

Приемането на Model Context Protocol (MCP) носи мощни нови възможности за AI-базирани приложения, но също така въвежда уникални предизвикателства по отношение на сигурността, които надхвърлят традиционните рискове в софтуера. Освен утвърдените практики като сигурно кодиране, принципа на минимални права и сигурността на доставната верига, MCP и AI натоварванията се изправят пред нови заплахи като prompt injection, tool poisoning и динамична модификация на инструменти. Тези рискове могат да доведат до изтичане на данни, нарушаване на личната неприкосновеност и нежелано поведение на системата, ако не бъдат правилно управлявани.

Този урок разглежда най-значимите рискове за сигурността, свързани с MCP — включително автентикация, авторизация, прекомерни права, индиректен prompt injection и уязвимости в доставната верига — и предоставя практически контролни мерки и добри практики за тяхното намаляване. Ще научите и как да използвате решения на Microsoft като Prompt Shields, Azure Content Safety и GitHub Advanced Security, за да подсилите вашата MCP имплементация. Чрез разбирането и прилагането на тези контролни мерки можете значително да намалите вероятността от пробив в сигурността и да гарантирате, че вашите AI системи остават стабилни и надеждни.

# Learning Objectives

Към края на този урок ще можете да:

- Идентифицирате и обясните уникалните рискове за сигурността, въведени от Model Context Protocol (MCP), включително prompt injection, tool poisoning, прекомерни права и уязвимости в доставната верига.
- Описвате и прилагате ефективни мерки за смекчаване на рисковете за сигурността на MCP, като стабилна автентикация, принципа на минимални права, сигурно управление на токени и верификация на доставната верига.
- Разбирате и използвате решения на Microsoft като Prompt Shields, Azure Content Safety и GitHub Advanced Security за защита на MCP и AI натоварвания.
- Признавате значението на валидирането на метаданни на инструменти, мониторинга за динамични промени и защитата срещу индиректни prompt injection атаки.
- Интегрирате утвърдени добри практики за сигурност — като сигурно кодиране, затягане на сървъри и zero trust архитектура — във вашата MCP имплементация, за да намалите вероятността и въздействието на пробиви в сигурността.

# MCP security controls

Всяка система с достъп до важни ресурси има подразбиращи се предизвикателства по отношение на сигурността. Обикновено те могат да бъдат адресирани чрез правилното прилагане на основни контролни мерки и концепции за сигурност. Тъй като MCP е сравнително нов протокол, спецификацията му се променя бързо и се развива. В крайна сметка контролите за сигурност в него ще узреят, което ще позволи по-добра интеграция с корпоративни и утвърдени архитектури и добри практики за сигурност.

Изследване, публикувано в [Microsoft Digital Defense Report](https://aka.ms/mddr), посочва, че 98% от докладваните пробиви биха били предотвратени чрез стриктна хигиена на сигурността, а най-добрата защита срещу всякакъв вид пробив е да имате добра базова хигиена на сигурността, добри практики за сигурно кодиране и сигурност на доставната верига — тези проверени практики все още имат най-голям ефект за намаляване на риска.

Нека разгледаме някои от начините, по които можете да започнете да адресирате рисковете за сигурността при приемането на MCP.

# MCP server authentication (if your MCP implementation was before 26th April 2025)

> **Note:** Следната информация е вярна към 26 април 2025 г. MCP протоколът постоянно се развива и бъдещи имплементации могат да въведат нови модели и контролни мерки за автентикация. За най-актуални новини и насоки винаги се обръщайте към [MCP Specification](https://spec.modelcontextprotocol.io/) и официалното [MCP GitHub repository](https://github.com/modelcontextprotocol).

### Problem statement  
Първоначалната спецификация на MCP предполагаше, че разработчиците ще изградят собствен автентикационен сървър. Това изискваше познания по OAuth и свързаните с него ограничения за сигурност. MCP сървърите действаха като OAuth 2.0 Authorization Servers, управлявайки необходимата автентикация на потребителите директно, вместо да я делегират на външна услуга като Microsoft Entra ID. От 26 април 2025 г. актуализация в спецификацията позволява на MCP сървърите да делегират автентикацията на потребителите към външна услуга.

### Risks
- Неправилно конфигурираната логика за авторизация в MCP сървъра може да доведе до излагане на чувствителни данни и неправилно прилагане на контролите за достъп.
- Кражба на OAuth токен на локалния MCP сървър. Ако токенът бъде откраднат, той може да се използва за имитиране на MCP сървъра и достъп до ресурси и данни от услугата, за която е предназначен.

### Mitigating controls
- **Преглед и затягане на логиката за авторизация:** Внимателно одитирайте имплементацията на авторизация в MCP сървъра, за да гарантирате, че само предвидените потребители и клиенти имат достъп до чувствителни ресурси. За практическо ръководство вижте [Azure API Management Your Auth Gateway For MCP Servers | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) и [Using Microsoft Entra ID To Authenticate With MCP Servers Via Sessions - Den Delimarsky](https://den.dev/blog/mcp-server-auth-entra-id-session/).
- **Прилагане на сигурни практики за токени:** Следвайте [най-добрите практики на Microsoft за валидация и живот на токените](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens), за да предотвратите злоупотреби с токени и да намалите риска от повторно използване или кражба.
- **Защита на съхранението на токени:** Винаги съхранявайте токените сигурно и използвайте криптиране, за да ги защитите в покой и при трансфер. За съвети по имплементация вижте [Use secure token storage and encrypt tokens](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2).

# Excessive permissions for MCP servers

### Problem statement  
MCP сървърите може да са получили прекомерни права върху услугата или ресурса, до които имат достъп. Например MCP сървър, който е част от AI приложение за продажби и се свързва с корпоративно хранилище на данни, трябва да има достъп ограничен само до данните за продажбите и да не може да достъпва всички файлове в хранилището. Връщайки се към принципа на минимални права (един от най-старите принципи за сигурност), нито един ресурс не трябва да има права, надвишаващи необходимите за изпълнение на предназначените задачи. AI създава допълнително предизвикателство, тъй като за да бъде гъвкав, понякога е трудно да се дефинират точно необходимите права.

### Risks  
- Даване на прекомерни права може да позволи изтичане или промяна на данни, до които MCP сървърът не би трябвало да има достъп. Това може да бъде и проблем с поверителността, ако данните съдържат лична информация (PII).

### Mitigating controls
- **Прилагане на принципа на минимални права:** Давайте на MCP сървъра само необходимите минимални права за изпълнение на задачите му. Редовно преглеждайте и актуализирайте тези права, за да гарантирате, че не надвишават нуждите. За подробно ръководство вижте [Secure least-privileged access](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access).
- **Използване на ролеви базиран контрол на достъпа (RBAC):** Присвоявайте роли на MCP сървъра, които са строго ограничени до конкретни ресурси и действия, като избягвате широки или ненужни права.
- **Мониторинг и одит на правата:** Непрекъснато следете използването на правата и одитирайте логовете за достъп, за да откривате и коригирате прекомерни или неизползвани привилегии своевременно.

# Indirect prompt injection attacks

### Problem statement

Злонамерени или компрометирани MCP сървъри могат да въведат сериозни рискове чрез излагане на клиентски данни или активиране на нежелани действия. Тези рискове са особено важни при AI и MCP базирани натоварвания, където:

- **Prompt Injection Attacks**: Атакуващите вмъкват злонамерени инструкции в prompt-и или външно съдържание, карайки AI системата да изпълни нежелани действия или да изтече чувствителна информация. Научете повече: [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- **Tool Poisoning**: Атакуващите манипулират метаданните на инструментите (като описания или параметри), за да повлияят на поведението на AI, евентуално заобикаляйки контролите за сигурност или изнасяйки данни. Подробности: [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- **Cross-Domain Prompt Injection**: Злонамерени инструкции са вградени в документи, уеб страници или имейли, които се обработват от AI, водещо до изтичане или манипулация на данни.
- **Dynamic Tool Modification (Rug Pulls)**: Дефинициите на инструментите могат да бъдат променени след одобрение от потребителя, въвеждайки нови злонамерени поведения без знанието на потребителя.

Тези уязвимости подчертават нуждата от стабилна валидация, мониторинг и контрол на сигурността при интегриране на MCP сървъри и инструменти във вашата среда. За по-задълбочено разглеждане вижте посочените по-горе препратки.

![prompt-injection-lg-2048x1034](../../../translated_images/prompt-injection.ed9fbfde297ca877c15bc6daa808681cd3c3dc7bf27bbbda342ef1ba5fc4f52d.bg.png)

**Indirect Prompt Injection** (известна още като cross-domain prompt injection или XPIA) е критична уязвимост в генеративните AI системи, включително тези, използващи Model Context Protocol (MCP). При тази атака злонамерени инструкции са скрити във външно съдържание — като документи, уеб страници или имейли. Когато AI системата обработва това съдържание, може да интерпретира вградените инструкции като легитимни команди от потребителя, което води до нежелани действия като изтичане на данни, генериране на вредно съдържание или манипулиране на взаимодействията с потребителя. За подробно обяснение и реални примери вижте [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/).

Особено опасна форма на тази атака е **Tool Poisoning**. Тук атакуващите вмъкват злонамерени инструкции в метаданните на MCP инструментите (като описания или параметри). Тъй като големите езикови модели (LLMs) разчитат на тези метаданни, за да решат кои инструменти да използват, компрометираните описания могат да заблудят модела да извърши неоторизирани повиквания на инструменти или да заобиколи контроли за сигурност. Тези манипулации често са невидими за крайния потребител, но могат да бъдат интерпретирани и изпълнени от AI системата. Този риск е особено голям при хоствани MCP сървъри, където дефинициите на инструментите могат да се обновяват след одобрение от потребителя — сценарий, известен понякога като "[rug pull](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)". В такива случаи инструмент, който преди е бил безопасен, може по-късно да бъде променен да изпълнява злонамерени действия, като изтичане на данни или промяна на поведението на системата, без знанието на потребителя. За повече информация вижте [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks).

![tool-injection-lg-2048x1239 (1)](../../../translated_images/tool-injection.3b0b4a6b24de6befe7d3afdeae44138ef005881aebcfc84c6f61369ce31e3640.bg.png)

## Risks  
Нежеланите действия на AI представляват различни рискове за сигурността, включително изтичане на данни и нарушаване на поверителността.

### Mitigating controls  
### Using prompt shields to protect against Indirect Prompt Injection attacks  
-----------------------------------------------------------------------------

**AI Prompt Shields** са решение, разработено от Microsoft, за защита както срещу директни, така и срещу индиректни prompt injection атаки. Те помагат чрез:

1.  **Откриване и филтриране:** Prompt Shields използват усъвършенствани алгоритми за машинно обучение и обработка на естествен език, за да откриват и филтрират злонамерени инструкции, вградени във външно съдържание като документи, уеб страници или имейли.
    
2.  **Spotlighting:** Тази техника помага на AI системата да различава валидни системни инструкции от потенциално ненадеждни външни входове. Чрез трансформиране на входния текст по начин, който го прави по-релевантен за модела, Spotlighting гарантира, че AI може по-добре да идентифицира и игнорира злонамерени инструкции.
    
3.  **Разделители и маркиране на данни:** Включването на разделители в системното съобщение ясно очертава местоположението на входния текст, което помага на AI системата да разпознае и отдели потребителските входове от потенциално вредното външно съдържание. Маркирането на данни разширява тази концепция чрез използване на специални маркери, които очертават границите между доверени и недоверени данни.
    
4.  **Непрекъснат мониторинг и обновления:** Microsoft постоянно следи и обновява Prompt Shields, за да се справя с нови и развиващи се заплахи. Този проактивен подход гарантира, че защитата остава ефективна срещу най-новите техники за атака.
    
5. **Интеграция с Azure Content Safety:** Prompt Shields са част от по-широкия пакет Azure AI Content Safety, който предоставя допълнителни инструменти за откриване на опити за jailbreak, вредно съдържание и други рискове за сигурността в AI приложения.

Можете да научите повече за AI prompt shields в [Prompt Shields documentation](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection).

![prompt-shield-lg-2048x1328](../../../translated_images/prompt-shield.ff5b95be76e9c78c6ec0888206a4a6a0a5ab4bb787832a9eceef7a62fe0138d1.bg.png)

### Supply chain security

Сигурността на доставната верига остава фундаментална в ерата на AI, но обхватът на това, което се счита за ваша доставна верига, се разшири. Освен традиционните кодови пакети, вече трябва стриктно да проверявате и наблюдавате всички AI свързани компоненти, включително основни модели, embedding услуги, доставчици на контекст и външни API-та. Всеки от тях може да въведе уязвимости или рискове, ако не се управлява правилно.

**Ключови практики за сигурност на доставната верига при AI и MCP:**
- **Проверявайте всички компоненти преди интеграция:** Това включва не само отворен код, но и AI модели, източници на данни и външни API-та. Винаги проверявайте произход, лицензи и известни уязвимости.
- **Подд
- [OWASP Топ 10 за LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559)
- [GitHub Advanced Security](https://github.com/security/advanced-security)
- [Azure DevOps](https://azure.microsoft.com/products/devops)
- [Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [Пътят към осигуряване на веригата за доставки на софтуер в Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)
- [Сигурен достъп с минимални права (Microsoft)](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [Добри практики за валидиране и живот на токените](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [Използване на сигурно съхранение на токени и криптиране на токени (YouTube)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)
- [Azure API Management като автентикационен шлюз за MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [Използване на Microsoft Entra ID за автентикация с MCP сървъри](https://den.dev/blog/mcp-server-auth-entra-id-session/)

### Следващо

Следващо: [Глава 3: Първи стъпки](/03-GettingStarted/README.md)

**Отказ от отговорност**:  
Този документ е преведен с помощта на AI преводаческа услуга [Co-op Translator](https://github.com/Azure/co-op-translator). Въпреки че се стремим към точност, моля, имайте предвид, че автоматизираните преводи могат да съдържат грешки или неточности. Оригиналният документ на неговия роден език трябва да се счита за авторитетен източник. За критична информация се препоръчва професионален човешки превод. Ние не носим отговорност за никакви недоразумения или неправилни тълкувания, произтичащи от използването на този превод.