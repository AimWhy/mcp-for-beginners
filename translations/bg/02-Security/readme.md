<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "98be664d3b19a81ee24fa3f920233864",
  "translation_date": "2025-05-17T07:54:30+00:00",
  "source_file": "02-Security/readme.md",
  "language_code": "bg"
}
-->
# Най-добри практики за сигурност

Прилагането на протокола за контекст на модела (MCP) предоставя мощни нови възможности за приложения, управлявани от AI, но също така въвежда уникални предизвикателства за сигурността, които надхвърлят традиционните рискове на софтуера. Освен утвърдени проблеми като сигурно кодиране, минимални привилегии и сигурност на веригата за доставки, MCP и AI натоварванията са изправени пред нови заплахи като инжектиране на подканяния, отравяне на инструменти и динамична модификация на инструменти. Тези рискове могат да доведат до изтичане на данни, нарушения на поверителността и нежелано поведение на системата, ако не се управляват правилно.

Този урок разглежда най-важните рискове за сигурността, свързани с MCP—включително удостоверяване, разрешение, прекомерни разрешения, индиректно инжектиране на подканяния и уязвимости на веригата за доставки—и предоставя приложими контроли и най-добри практики за тяхното смекчаване. Ще научите също как да използвате решения на Microsoft като Prompt Shields, Azure Content Safety и GitHub Advanced Security, за да укрепите вашата MCP имплементация. Като разбирате и прилагате тези контроли, можете значително да намалите вероятността от нарушение на сигурността и да гарантирате, че вашите AI системи остават надеждни и доверени.

# Учебни цели

До края на този урок ще можете да:

- Идентифицирате и обясните уникалните рискове за сигурността, въведени от протокола за контекст на модела (MCP), включително инжектиране на подканяния, отравяне на инструменти, прекомерни разрешения и уязвимости на веригата за доставки.
- Описвате и прилагате ефективни контроли за смекчаване на рисковете за сигурността на MCP, като например стабилно удостоверяване, минимални привилегии, управление на сигурни токени и проверка на веригата за доставки.
- Разбирате и използвате решения на Microsoft като Prompt Shields, Azure Content Safety и GitHub Advanced Security за защита на MCP и AI натоварванията.
- Признавате важността на валидирането на метаданни на инструменти, наблюдението за динамични промени и защитата срещу индиректни атаки за инжектиране на подканяния.
- Интегрирате утвърдени най-добри практики за сигурност—като сигурно кодиране, укрепване на сървъри и архитектура на нулево доверие—във вашата MCP имплементация, за да намалите вероятността и въздействието на нарушения на сигурността.

# Контроли за сигурност на MCP

Всяка система, която има достъп до важни ресурси, има подразбиращи се предизвикателства за сигурността. Предизвикателствата за сигурността обикновено могат да бъдат адресирани чрез правилното прилагане на основни контроли и концепции за сигурност. Тъй като MCP е ново дефиниран, спецификацията се променя много бързо и с развитието на протокола. В крайна сметка контролите за сигурност в него ще се усъвършенстват, позволявайки по-добра интеграция с корпоративни и утвърдени архитектури и най-добри практики за сигурност.

Изследвания, публикувани в [Microsoft Digital Defense Report](https://aka.ms/mddr), посочват, че 98% от докладваните нарушения биха били предотвратени чрез стабилна хигиена на сигурността и най-добрата защита срещу всякакъв вид нарушение е да осигурите вашата основна хигиена на сигурността, най-добрите практики за сигурно кодиране и сигурността на веригата за доставки—тези изпитани и тествани практики, които вече знаем, че все още имат най-голямо въздействие в намаляването на риска за сигурността.

Нека разгледаме някои от начините, по които можете да започнете да адресирате рисковете за сигурността при приемане на MCP.

# Удостоверяване на MCP сървър (ако вашата MCP имплементация е преди 26 април 2025 г.)

> **Note:** Следната информация е вярна към 26 април 2025 г. MCP протоколът постоянно се развива и бъдещи имплементации могат да въведат нови модели и контроли за удостоверяване. За последните актуализации и насоки винаги се отнасяйте към [MCP Specification](https://spec.modelcontextprotocol.io/) и официалното [MCP GitHub repository](https://github.com/modelcontextprotocol).

### Проблем
Първоначалната MCP спецификация предполагаше, че разработчиците ще пишат свой собствен сървър за удостоверяване. Това изискваше познания за OAuth и свързаните с него ограничения за сигурност. MCP сървърите действаха като OAuth 2.0 сървъри за разрешение, управлявайки необходимото удостоверяване на потребителя директно, вместо да го делегират на външна услуга като Microsoft Entra ID. От 26 април 2025 г. актуализация на MCP спецификацията позволява на MCP сървърите да делегират удостоверяване на потребителя на външна услуга.

### Рискове
- Неправилно конфигурирана логика за разрешение в MCP сървъра може да доведе до излагане на чувствителни данни и неправилно приложени контроли за достъп.
- Кражба на OAuth токен на локалния MCP сървър. Ако бъде откраднат, токенът може да бъде използван за представяне на MCP сървъра и достъп до ресурси и данни от услугата, за която е OAuth токенът.

### Контроли за смекчаване
- **Преглед и укрепване на логиката за разрешение:** Внимателно проверявайте имплементацията на разрешението на вашия MCP сървър, за да гарантирате, че само предвидените потребители и клиенти могат да получат достъп до чувствителни ресурси. За практически насоки, вижте [Azure API Management Your Auth Gateway For MCP Servers | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) и [Using Microsoft Entra ID To Authenticate With MCP Servers Via Sessions - Den Delimarsky](https://den.dev/blog/mcp-server-auth-entra-id-session/).
- **Прилагане на практики за сигурни токени:** Следвайте [най-добрите практики на Microsoft за валидиране и жизнен цикъл на токени](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens), за да предотвратите злоупотреба с токени за достъп и да намалите риска от повторение или кражба на токени.
- **Защита на съхранението на токени:** Винаги съхранявайте токените сигурно и използвайте криптиране, за да ги защитите в покой и по време на пренос. За съвети за имплементация, вижте [Use secure token storage and encrypt tokens](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2).

# Прекомерни разрешения за MCP сървъри

### Проблем
MCP сървърите може да са получили прекомерни разрешения за услугата/ресурса, който достъпват. Например, MCP сървър, който е част от AI приложение за продажби, свързващо се с корпоративен хранилище на данни, трябва да има достъп, ограничен до данните за продажби и да не му е позволено да достъпва всички файлове в хранилището. Позовавайки се на принципа на минимални привилегии (един от най-старите принципи за сигурност), нито един ресурс не трябва да има разрешения, които надвишават това, което е необходимо за изпълнение на задачите, за които е предназначен. AI представя повишено предизвикателство в тази област, защото за да бъде гъвкав, може да е трудно да се дефинират точните необходими разрешения.

### Рискове
- Даване на прекомерни разрешения може да позволи изтичане или промяна на данни, които MCP сървърът не е предназначен да може да достъпва. Това може да бъде и проблем за поверителността, ако данните са лична информация (PII).

### Контроли за смекчаване
- **Прилагане на принципа на минимални привилегии:** Дайте на MCP сървъра само минималните разрешения, необходими за изпълнение на неговите задачи. Редовно преглеждайте и актуализирайте тези разрешения, за да гарантирате, че не надвишават необходимото. За подробни насоки, вижте [Secure least-privileged access](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access).
- **Използване на контрол на достъпа на базата на роли (RBAC):** Присвоявайте роли на MCP сървъра, които са строго ограничени до конкретни ресурси и действия, избягвайки широки или ненужни разрешения.
- **Мониторинг и одит на разрешения:** Непрекъснато наблюдавайте използването на разрешения и одитирайте логовете за достъп, за да откривате и коригирате прекомерни или неизползвани привилегии своевременно.

# Индиректни атаки за инжектиране на подканяния

### Проблем

Злонамерени или компрометирани MCP сървъри могат да въведат значителни рискове, като излагат данни на клиенти или позволяват нежелани действия. Тези рискове са особено важни в AI и MCP-базирани натоварвания, където:

- **Атаки за инжектиране на подканяния**: Нападателите вграждат злонамерени инструкции в подканяния или външно съдържание, което кара AI системата да извършва нежелани действия или да изтича чувствителни данни. Научете повече: [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- **Отравяне на инструменти**: Нападателите манипулират метаданните на инструменти (като описания или параметри), за да влияят върху поведението на AI, потенциално заобикаляйки контроли за сигурност или изтичайки данни. Подробности: [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- **Крос-домейн инжектиране на подканяния**: Злонамерени инструкции са вградени в документи, уеб страници или имейли, които след това се обработват от AI, водещи до изтичане или манипулация на данни.
- **Динамична модификация на инструменти (Rug Pulls)**: Определенията на инструменти могат да бъдат променени след одобрение от потребителя, въвеждайки нови злонамерени поведения без знанието на потребителя.

Тези уязвимости подчертават необходимостта от стабилна валидиране, мониторинг и контроли за сигурност при интегриране на MCP сървъри и инструменти във вашата среда. За по-задълбочено разглеждане, вижте свързаните препратки по-горе.

![prompt-injection-lg-2048x1034](../../../translated_images/prompt-injection.4b2f1af239a32d46221a75c7bc5b6f392ebbacc47eccde241d4c60507232fa43.bg.png)

**Индиректно инжектиране на подканяния** (известно още като крос-домейн инжектиране на подканяния или XPIA) е критична уязвимост в генериращи AI системи, включително тези, използващи протокола за контекст на модела (MCP). В тази атака злонамерени инструкции са скрити във външно съдържание—като документи, уеб страници или имейли. Когато AI системата обработва това съдържание, тя може да интерпретира вградените инструкции като легитимни команди на потребителя, водещи до нежелани действия като изтичане на данни, генериране на вредно съдържание или манипулация на потребителски взаимодействия. За подробно обяснение и реални примери, вижте [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/).

Особено опасна форма на тази атака е **Отравяне на инструменти**. Тук нападателите вграждат злонамерени инструкции в метаданните на MCP инструменти (като описания на инструменти или параметри). Тъй като големите езикови модели (LLMs) разчитат на тези метаданни, за да решат кои инструменти да използват, компрометираните описания могат да измамят модела да изпълни неразрешени повиквания на инструменти или да заобиколи контроли за сигурност. Тези манипулации често са невидими за крайните потребители, но могат да бъдат интерпретирани и изпълнени от AI системата. Този риск се увеличава в хоствани MCP сървърни среди, където определенията на инструменти могат да бъдат актуализирани след одобрение от потребителя—сценарий, понякога наричан "[rug pull](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)". В такива случаи инструмент, който преди е бил безопасен, може по-късно да бъде модифициран да извършва злонамерени действия, като изтичане на данни или промяна на поведението на системата, без знанието на потребителя. За повече информация за този вектор на атака, вижте [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks).

![tool-injection-lg-2048x1239 (1)](../../../translated_images/tool-injection.d4607023f69e16157954001ad81afd763676361f03db0a1cf24ec696b2ddcb88.bg.png)

## Рискове
Нежеланите действия на AI представят разнообразие от рискове за сигурността, включително изтичане на данни и нарушения на поверителността.

### Контроли за смекчаване
### Използване на щитове за подканяния за защита срещу индиректни атаки за инжектиране на подканяния
-----------------------------------------------------------------------------

**AI Prompt Shields** са решение, разработено от Microsoft за защита срещу както директни, така и индиректни атаки за инжектиране на подканяния. Те помагат чрез:

1.  **Откриване и филтриране**: Prompt Shields използват напреднали алгоритми за машинно обучение и обработка на естествен език, за да откриват и филтрират злонамерени инструкции, вградени във външно съдържание, като документи, уеб страници или имейли.
    
2.  **Spotlighting**: Тази техника помага на AI системата да различава между валидни системни инструкции и потенциално ненадеждни външни входове. Чрез трансформиране на текста на входа по начин, който го прави по-релевантен за модела, Spotlighting гарантира, че AI може по-добре да идентифицира и игнорира злонамерени инструкции.
    
3.  **Делимитери и маркиране на данни**: Включването на делимитери в системното съобщение ясно очертава местоположението на текста на входа, помагайки на AI системата да разпознава и отделя потребителски входове от потенциално вредно външно съдържание. Маркирането на данни разширява тази концепция, използвайки специални маркери, за да подчертае границите на доверени и недоверени данни.
    
4.  **Непрекъснат мониторинг и актуализации**: Microsoft непрекъснато наблюдава и актуализира Prompt Shields, за да адресира нови и развиващи се заплахи. Този проактивен подход гарантира, че защитите остават ефективни срещу най-новите техники за атака.
    
5. **Интеграция с Azure Content Safety:** Prompt Shields са част от по-широкия Azure AI Content Safety пакет, който предоставя допълнителни инструменти за открив
- [OWASP Топ 10 за LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559)
- [GitHub Разширена сигурност](https://github.com/security/advanced-security)
- [Azure DevOps](https://azure.microsoft.com/products/devops)
- [Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [Пътешествието към осигуряване на софтуерната верига за доставки в Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)
- [Сигурен достъп с най-малко привилегии (Microsoft)](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [Най-добри практики за валидиране и живот на токени](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [Използване на сигурно съхранение на токени и криптиране на токени (YouTube)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)
- [Azure API Management като Auth Gateway за MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [Използване на Microsoft Entra ID за удостоверяване с MCP сървъри](https://den.dev/blog/mcp-server-auth-entra-id-session/)

### Следващо

Следващо: [Глава 3: Първи стъпки](/03-GettingStarted/README.md)

**Отказ от отговорност**:
Този документ е преведен с помощта на AI услуга за превод [Co-op Translator](https://github.com/Azure/co-op-translator). Въпреки че се стремим към точност, моля, имайте предвид, че автоматизираните преводи може да съдържат грешки или неточности. Оригиналният документ на неговия роден език трябва да се счита за авторитетния източник. За критична информация се препоръчва професионален човешки превод. Ние не носим отговорност за каквито и да било недоразумения или неправилни интерпретации, произтичащи от използването на този превод.