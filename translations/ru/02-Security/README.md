<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "98be664d3b19a81ee24fa3f920233864",
  "translation_date": "2025-05-20T22:50:00+00:00",
  "source_file": "02-Security/README.md",
  "language_code": "ru"
}
-->
# Лучшие практики безопасности

Внедрение Model Context Protocol (MCP) открывает новые возможности для приложений с искусственным интеллектом, но также порождает уникальные проблемы безопасности, выходящие за рамки традиционных рисков программного обеспечения. Помимо классических аспектов, таких как безопасное кодирование, принцип наименьших привилегий и безопасность цепочки поставок, MCP и AI-нагрузки сталкиваются с новыми угрозами — такими как инъекция подсказок, отравление инструментов и динамическое изменение инструментов. Если эти риски не контролировать, они могут привести к утечке данных, нарушению конфиденциальности и непредсказуемому поведению системы.

В этом уроке рассматриваются наиболее актуальные риски безопасности, связанные с MCP — включая аутентификацию, авторизацию, избыточные разрешения, косвенную инъекцию подсказок и уязвимости цепочки поставок, а также предлагаются практические меры и лучшие практики для их снижения. Вы также узнаете, как использовать решения Microsoft, такие как Prompt Shields, Azure Content Safety и GitHub Advanced Security, чтобы повысить безопасность вашей реализации MCP. Понимая и применяя эти меры, вы значительно уменьшите вероятность нарушения безопасности и обеспечите надежность и доверие к вашим AI-системам.

# Цели обучения

К концу этого урока вы сможете:

- Определять и объяснять уникальные риски безопасности, связанные с Model Context Protocol (MCP), включая инъекцию подсказок, отравление инструментов, избыточные разрешения и уязвимости цепочки поставок.
- Описывать и применять эффективные меры снижения рисков безопасности MCP, такие как надежная аутентификация, принцип наименьших привилегий, безопасное управление токенами и проверка цепочки поставок.
- Понимать и использовать решения Microsoft, включая Prompt Shields, Azure Content Safety и GitHub Advanced Security, для защиты MCP и AI-нагрузок.
- Осознавать важность проверки метаданных инструментов, мониторинга динамических изменений и защиты от косвенных атак инъекции подсказок.
- Интегрировать проверенные лучшие практики безопасности — такие как безопасное кодирование, укрепление серверов и архитектуру с нулевым доверием — в вашу реализацию MCP для снижения вероятности и последствий нарушений безопасности.

# Контроли безопасности MCP

Любая система с доступом к важным ресурсам сталкивается с присущими ей проблемами безопасности. Обычно их можно решить правильным применением базовых мер и концепций безопасности. Поскольку MCP — протокол новый и быстро развивается, спецификация постоянно меняется. Со временем меры безопасности в нем станут более зрелыми, что позволит лучше интегрировать MCP с корпоративными и проверенными архитектурами и лучшими практиками безопасности.

В исследовании, опубликованном в [Microsoft Digital Defense Report](https://aka.ms/mddr), говорится, что 98% зарегистрированных нарушений можно предотвратить с помощью надежной гигиены безопасности. Лучшей защитой от любых нарушений является правильное соблюдение базовых правил безопасности, безопасное кодирование и обеспечение безопасности цепочки поставок — проверенные временем методы, которые по-прежнему наиболее эффективно снижают риски.

Рассмотрим некоторые способы, с помощью которых вы можете начать снижать риски безопасности при внедрении MCP.

# Аутентификация MCP-сервера (если ваша реализация MCP была до 26 апреля 2025 года)

> **Note:** Следующая информация актуальна на 26 апреля 2025 года. Протокол MCP постоянно развивается, и будущие реализации могут вводить новые схемы аутентификации и меры контроля. Для последних обновлений и рекомендаций всегда обращайтесь к [MCP Specification](https://spec.modelcontextprotocol.io/) и официальному [репозиторию MCP на GitHub](https://github.com/modelcontextprotocol).

### Постановка проблемы  
Изначальная спецификация MCP предполагала, что разработчики сами напишут сервер аутентификации. Для этого требовались знания OAuth и связанных с ним ограничений безопасности. MCP-серверы выступали в роли OAuth 2.0 Authorization Servers, управляя аутентификацией пользователей напрямую, а не передавая её внешним сервисам, таким как Microsoft Entra ID. С 26 апреля 2025 года обновление спецификации MCP позволяет MCP-серверам делегировать аутентификацию пользователей внешним сервисам.

### Риски
- Некорректная настройка логики авторизации на MCP-сервере может привести к утечке конфиденциальных данных и неправильному применению контролей доступа.
- Кража OAuth-токена на локальном MCP-сервере. Если токен украден, злоумышленник может выдать себя за MCP-сервер и получить доступ к ресурсам и данным, защищенным этим токеном.

### Меры снижения риска
- **Проверка и усиление логики авторизации:** Тщательно аудитируйте реализацию авторизации вашего MCP-сервера, чтобы гарантировать доступ к чувствительным ресурсам только для нужных пользователей и клиентов. Практические рекомендации смотрите в [Azure API Management Your Auth Gateway For MCP Servers | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) и [Using Microsoft Entra ID To Authenticate With MCP Servers Via Sessions - Den Delimarsky](https://den.dev/blog/mcp-server-auth-entra-id-session/).
- **Соблюдение безопасных практик работы с токенами:** Следуйте [лучшим практикам Microsoft по валидации токенов и их срокам действия](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens), чтобы предотвратить неправильное использование токенов и снизить риск их повторного использования или кражи.
- **Защита хранения токенов:** Всегда храните токены надежно и используйте шифрование для защиты данных в покое и при передаче. Советы по реализации смотрите в [Use secure token storage and encrypt tokens](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2).

# Избыточные разрешения для MCP-серверов

### Постановка проблемы  
MCP-серверам могли быть предоставлены избыточные разрешения к сервисам или ресурсам, к которым они обращаются. Например, MCP-сервер, являющийся частью AI-приложения для продаж, подключающегося к корпоративному хранилищу данных, должен иметь доступ только к данным о продажах, а не ко всем файлам в хранилище. Возвращаясь к принципу наименьших привилегий (одному из старейших принципов безопасности), никакому ресурсу не следует предоставлять разрешения, превышающие необходимые для выполнения его задач. Искусственный интеллект усложняет задачу, поскольку для обеспечения гибкости сложно точно определить, какие разрешения нужны.

### Риски  
- Предоставление избыточных разрешений может привести к утечке или изменению данных, к которым MCP-сервер не должен иметь доступ. Это также может стать проблемой конфиденциальности, если данные содержат персональную информацию (PII).

### Меры снижения риска
- **Применение принципа наименьших привилегий:** Предоставляйте MCP-серверу только минимально необходимые разрешения для выполнения его задач. Регулярно пересматривайте и обновляйте эти разрешения, чтобы убедиться, что они не превышают необходимого. Подробные рекомендации — в [Secure least-privileged access](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access).
- **Использование ролевого контроля доступа (RBAC):** Назначайте MCP-серверу роли с узконаправленными разрешениями, ограниченными конкретными ресурсами и действиями, избегая широких или ненужных прав.
- **Мониторинг и аудит разрешений:** Постоянно отслеживайте использование разрешений и проверяйте журналы доступа, чтобы своевременно выявлять и устранять избыточные или неиспользуемые привилегии.

# Косвенные атаки инъекции подсказок

### Постановка проблемы

Злоумышленные или скомпрометированные MCP-серверы могут создавать серьезные риски, раскрывая данные клиентов или вызывая непреднамеренные действия. Эти риски особенно актуальны для AI и нагрузок на базе MCP, где:

- **Атаки инъекции подсказок:** Злоумышленники внедряют вредоносные инструкции в подсказки или внешний контент, заставляя AI-систему выполнять нежелательные действия или раскрывать конфиденциальные данные. Подробнее: [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- **Отравление инструментов:** Злоумышленники манипулируют метаданными инструментов (например, описаниями или параметрами), чтобы влиять на поведение AI, обходить меры безопасности или похищать данные. Подробнее: [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- **Кросс-доменные атаки инъекции подсказок:** Вредоносные инструкции внедряются в документы, веб-страницы или письма, которые затем обрабатываются AI, что приводит к утечке или манипуляциям с данными.
- **Динамическое изменение инструментов (Rug Pulls):** Определения инструментов могут изменяться после одобрения пользователем, вводя новые вредоносные функции без ведома пользователя.

Эти уязвимости подчеркивают необходимость надежной проверки, мониторинга и мер безопасности при интеграции MCP-серверов и инструментов в вашу среду. Для более глубокого изучения смотрите ссылки выше.

![prompt-injection-lg-2048x1034](../../../translated_images/prompt-injection.ed9fbfde297ca877c15bc6daa808681cd3c3dc7bf27bbbda342ef1ba5fc4f52d.ru.png)

**Косвенная инъекция подсказок** (также известная как кросс-доменная инъекция подсказок или XPIA) — критическая уязвимость в генеративных AI-системах, включая использующие MCP. В этой атаке вредоносные инструкции скрываются во внешнем контенте — документах, веб-страницах или письмах. При обработке AI может принять эти инструкции за легитимные команды пользователя, что приведет к нежелательным действиям: утечке данных, генерации вредоносного контента или манипуляциям с взаимодействием пользователя. Подробное объяснение и реальные примеры — в [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/).

Особо опасной формой этой атаки является **отравление инструментов**. Здесь злоумышленники внедряют вредоносные инструкции в метаданные MCP-инструментов (например, описания или параметры). Поскольку большие языковые модели (LLM) полагаются на эти метаданные для выбора инструментов, скомпрометированные описания могут заставить модель выполнить несанкционированные вызовы инструментов или обойти меры безопасности. Эти манипуляции часто незаметны для конечных пользователей, но могут быть распознаны и исполнены AI-системой. Риск усиливается в средах с хостингом MCP-серверов, где определения инструментов могут обновляться после одобрения пользователя — сценарий, известный как "[rug pull](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)". В таких случаях ранее безопасный инструмент может быть изменен для выполнения вредоносных действий, например, утечки данных или изменения поведения системы, без ведома пользователя. Подробнее об этом в [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks).

![tool-injection-lg-2048x1239 (1)](../../../translated_images/tool-injection.3b0b4a6b24de6befe7d3afdeae44138ef005881aebcfc84c6f61369ce31e3640.ru.png)

## Риски  
Непреднамеренные действия AI несут разнообразные риски безопасности, включая утечку данных и нарушение конфиденциальности.

### Меры снижения риска  
### Использование Prompt Shields для защиты от косвенных атак инъекции подсказок
-----------------------------------------------------------------------------

**AI Prompt Shields** — решение Microsoft для защиты от прямых и косвенных атак инъекции подсказок. Они помогают за счет:

1.  **Обнаружения и фильтрации:** Prompt Shields используют продвинутые алгоритмы машинного обучения и обработку естественного языка для выявления и фильтрации вредоносных инструкций, встроенных во внешний контент — документы, веб-страницы или письма.
    
2.  **Spotlighting:** Этот метод помогает AI-системе отличать легитимные системные инструкции от потенциально недостоверных внешних данных. Преобразуя входной текст так, чтобы он был более релевантен модели, Spotlighting позволяет AI лучше распознавать и игнорировать вредоносные команды.
    
3.  **Разделители и маркировка данных:** Включение разделителей в системное сообщение явно указывает местоположение входного текста, помогая AI отделять пользовательский ввод от потенциально опасного внешнего контента. Маркировка данных расширяет эту концепцию, используя специальные метки для обозначения границ доверенных и недоверенных данных.
    
4.  **Непрерывный мониторинг и обновления:** Microsoft постоянно отслеживает и обновляет Prompt Shields для противодействия новым и развивающимся угрозам. Такой проактивный подход обеспечивает эффективность защиты против современных методов атак.
    
5. **Интеграция с Azure Content Safety:** Prompt Shields входят в состав более широкой платформы Azure AI Content Safety, которая предоставляет дополнительные инструменты для обнаружения попыток обхода защиты, вредоносного контента и других рисков безопасности в AI-приложениях.

Подробнее о AI Prompt Shields можно узнать в [документации Prompt Shields](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection).

![prompt-shield-lg-2048x1328](../../../translated_images/prompt-shield.ff5b95be76e9c78c6ec0888206a4a6a0a5ab4bb787832a9eceef7a62fe0138d1.ru.png)

### Безопасность цепочки поставок

Безопасность цепочки поставок остается фундаментальной в эпоху AI, но теперь понятие цепочки поставок расширилось. Помимо традиционных пакетов кода, необходимо тщательно проверять и контролировать все AI-компоненты, включая базовые модели, сервисы встраивания, поставщиков контекста и сторонние API. Каждый из этих элементов может стать источником уязвимостей или рисков, если им не уделять должного внимания.

**Ключевые практики безопасности цепочки поставок для AI и MCP:**
- **Проверяйте все компоненты перед интеграцией:** Это касается не только open-source библиотек, но и AI-моделей, источников данных и внешних API. Всегда проверяйте происхождение, лицензии и известные уязвимости.
- **Поддерживайте безопасные конвейеры развертывания:** Используйте автоматизированные CI/CD с интегрированным сканированием безопасности для раннего обнаружения проблем. Обеспечьте развертывание в продакшен только доверенных артефактов.
- **Постоянно мониторьте и проводите аудит:** Внедряйте непрерывный мониторинг всех зависимостей, включая модели и сервисы данных, чтобы выявлять новые уязвимости или атаки на цепочку поставок.
- **Применяйте принцип наименьших привилегий и контролей доступа:** Ограничивайте доступ к моделям, данным и сервисам только необходимым минимумом для работы MCP-сервера.
- **Быстро реагируйте на угрозы:** Имейте процессы для патчинга или замены скомпрометированных компонентов, а также для ротации секретов и учетных данных при обнаружении нарушений.

[GitHub Advanced Security](https://github.com/security/advanced-security) предлагает функции сканирования секретов, анализа зависимостей и CodeQL. Эти инструменты интегрируются с [Azure DevOps](https://azure.microsoft.com/en-us/products/devops) и [Azure Repos](https://azure.microsoft.com/en-us/products/devops/repos/), помогая командам выявлять и снижать уязвимости как в коде, так и в AI-компонентах цепочки поставок.

Microsoft также реализует обширные меры безопасности цепочки поставок внутри компании для всех продуктов. Подробнее в [The Journey to Secure the Software Supply Chain at Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/).

# Проверенные лучшие практики безопасности, которые повысят уровень защиты вашей реализации MCP

Любая реализация MCP наследует существующий уровень безопасности среды вашей организации, на которой она построена. Поэтому при рассмотрении безопасности MCP как части общей AI-системы рекомендуется улучшать и общий уровень безопасности. Особенно актуальны следующие проверенные меры:

- Лучшие практики безопасного кодирования в вашем AI-приложении — защита от [OWASP Top 10](https://owasp.org/www-project-top-ten/), [OWASP Top 10 для LLM](https://genai.owasp.org/download/43299/?tmstv=1731900559), использование защищенных хранилищ для секретов и токенов, реализация сквозного шифрования между всеми компонентами приложения и т. д.
- Укрепление серверов — использование многофакторной аутентификации (MFA) там, где возможно, своевременное обновление патчей, интеграция сервера с внешним провайдером идентификации для управления доступом и прочее.
- Поддержание устройств, инфраструктуры и приложений в актуальном состоянии с помощью своевременных обновлений и патчей.
- Мониторинг безопасности — внедрение логирования и мониторинга AI-приложения (включая MCP-клиенты и серверы) с отправкой логов в центральную SIEM для обнаружения аномалий.
- Архитектура с нулевым доверием — логическое изолирование компонентов с помощью сетевых и идентификационных контролей для минимизации бокового перемещения в случае компрометации AI-приложения.

# Основные выводы

- Основы безопасности остаются критически важными: безопасное кодирование, принцип наименьших привилегий, проверка цепочки поставок и постоянный мониторинг необходимы для MCP и AI-нагрузок.
- MCP вводит новые рис
- [OWASP Top 10 для LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559)
- [GitHub Advanced Security](https://github.com/security/advanced-security)
- [Azure DevOps](https://azure.microsoft.com/products/devops)
- [Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [Путь к обеспечению безопасности цепочки поставок программного обеспечения в Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)
- [Безопасный доступ с минимальными привилегиями (Microsoft)](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [Лучшие практики проверки токенов и управления временем их жизни](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [Использование безопасного хранения токенов и их шифрование (YouTube)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)
- [Azure API Management как шлюз аутентификации для MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [Использование Microsoft Entra ID для аутентификации с MCP серверами](https://den.dev/blog/mcp-server-auth-entra-id-session/)

### Далее

Далее: [Глава 3: Начало работы](/03-GettingStarted/README.md)

**Отказ от ответственности**:  
Этот документ был переведен с помощью сервиса автоматического перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Несмотря на наши усилия по обеспечению точности, имейте в виду, что автоматический перевод может содержать ошибки или неточности. Оригинальный документ на его исходном языке следует считать авторитетным источником. Для критически важной информации рекомендуется профессиональный перевод человеком. Мы не несем ответственности за любые недоразумения или неправильные толкования, возникшие в результате использования данного перевода.