<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "98be664d3b19a81ee24fa3f920233864",
  "translation_date": "2025-05-17T07:07:24+00:00",
  "source_file": "02-Security/readme.md",
  "language_code": "ru"
}
-->
# Лучшие практики безопасности

Внедрение Протокола Контекста Модели (MCP) предоставляет мощные новые возможности для приложений на основе ИИ, но также вводит уникальные проблемы безопасности, которые выходят за рамки традиционных рисков программного обеспечения. В дополнение к устоявшимся вопросам, таким как безопасное кодирование, принцип наименьших привилегий и безопасность цепочки поставок, MCP и рабочие нагрузки ИИ сталкиваются с новыми угрозами, такими как внедрение инструкций, отравление инструментов и динамическая модификация инструментов. Эти риски могут привести к утечке данных, нарушениям конфиденциальности и непреднамеренному поведению системы, если их не управлять должным образом.

Этот урок исследует наиболее актуальные риски безопасности, связанные с MCP, включая аутентификацию, авторизацию, чрезмерные разрешения, косвенное внедрение инструкций и уязвимости цепочки поставок, и предоставляет практические средства контроля и лучшие практики для их смягчения. Вы также узнаете, как использовать решения Microsoft, такие как Prompt Shields, Azure Content Safety и GitHub Advanced Security, для укрепления вашей реализации MCP. Поняв и применив эти средства контроля, вы сможете значительно снизить вероятность нарушения безопасности и обеспечить надежность и доверие ваших систем ИИ.

# Цели обучения

К концу этого урока вы сможете:

- Определять и объяснять уникальные риски безопасности, введенные Протоколом Контекста Модели (MCP), включая внедрение инструкций, отравление инструментов, чрезмерные разрешения и уязвимости цепочки поставок.
- Описывать и применять эффективные средства смягчения рисков безопасности MCP, такие как надежная аутентификация, принцип наименьших привилегий, управление безопасными токенами и проверка цепочки поставок.
- Понимать и использовать решения Microsoft, такие как Prompt Shields, Azure Content Safety и GitHub Advanced Security, для защиты рабочих нагрузок MCP и ИИ.
- Признавать важность проверки метаданных инструментов, мониторинга динамических изменений и защиты от косвенных атак внедрения инструкций.
- Интегрировать устоявшиеся лучшие практики безопасности, такие как безопасное кодирование, укрепление серверов и архитектура нулевого доверия, в вашу реализацию MCP, чтобы уменьшить вероятность и воздействие нарушений безопасности.

# Средства контроля безопасности MCP

Любая система, имеющая доступ к важным ресурсам, сталкивается с предполагаемыми проблемами безопасности. Проблемы безопасности можно решить в целом через правильное применение фундаментальных средств контроля и концепций безопасности. Поскольку MCP только недавно определен, спецификация меняется очень быстро по мере эволюции протокола. В конечном итоге средства контроля безопасности внутри него созреют, что позволит лучше интегрироваться с корпоративными и устоявшимися архитектурами безопасности и лучшими практиками.

Исследования, опубликованные в [Отчете о цифровой защите Microsoft](https://aka.ms/mddr), утверждают, что 98% сообщенных нарушений можно было бы предотвратить с помощью надежной гигиены безопасности, и лучшая защита от любого рода нарушений — это правильная базовая гигиена безопасности, лучшие практики безопасного кодирования и безопасность цепочки поставок — эти проверенные временем практики, о которых мы уже знаем, все еще оказывают наибольшее влияние на снижение риска безопасности.

Давайте рассмотрим некоторые способы, с помощью которых вы можете начать решать проблемы безопасности при внедрении MCP.

# Аутентификация сервера MCP (если ваша реализация MCP была до 26 апреля 2025 года)

> **Примечание:** Следующая информация актуальна на 26 апреля 2025 года. Протокол MCP постоянно развивается, и будущие реализации могут вводить новые схемы и средства контроля аутентификации. Для получения последних обновлений и рекомендаций всегда обращайтесь к [Спецификации MCP](https://spec.modelcontextprotocol.io/) и официальному [репозиторию MCP на GitHub](https://github.com/modelcontextprotocol).

### Постановка проблемы 
Оригинальная спецификация MCP предполагала, что разработчики будут писать собственный сервер аутентификации. Это требовало знаний об OAuth и связанных с ним ограничениях безопасности. Сервера MCP действовали как серверы авторизации OAuth 2.0, управляя необходимой аутентификацией пользователей напрямую, а не делегируя ее внешней службе, такой как Microsoft Entra ID. С 26 апреля 2025 года обновление спецификации MCP позволяет серверам MCP делегировать аутентификацию пользователей внешней службе.

### Риски
- Неправильно настроенная логика авторизации на сервере MCP может привести к утечке конфиденциальных данных и неправильному применению средств контроля доступа.
- Кража токена OAuth на локальном сервере MCP. Если токен украден, его можно использовать для имитации сервера MCP и доступа к ресурсам и данным из службы, для которой предназначен токен OAuth.

### Средства смягчения
- **Проверка и укрепление логики авторизации:** Тщательно проверяйте реализацию авторизации на вашем сервере MCP, чтобы гарантировать, что только предполагаемые пользователи и клиенты могут получить доступ к конфиденциальным ресурсам. Для практических рекомендаций смотрите [Azure API Management Your Auth Gateway For MCP Servers | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) и [Using Microsoft Entra ID To Authenticate With MCP Servers Via Sessions - Den Delimarsky](https://den.dev/blog/mcp-server-auth-entra-id-session/).
- **Обеспечение безопасной практики работы с токенами:** Следуйте [лучшим практикам Microsoft по проверке и сроку действия токенов](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens), чтобы предотвратить неправильное использование токенов доступа и уменьшить риск их повторного использования или кражи.
- **Защита хранения токенов:** Всегда храните токены в безопасности и используйте шифрование для их защиты в состоянии покоя и в процессе передачи. Для советов по реализации смотрите [Используйте безопасное хранение токенов и шифруйте токены](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2).

# Чрезмерные разрешения для серверов MCP

### Постановка проблемы
Серверам MCP могли быть предоставлены чрезмерные разрешения на доступ к сервису/ресурсу. Например, сервер MCP, который является частью приложения для продаж на основе ИИ и подключается к корпоративному хранилищу данных, должен иметь доступ только к данным о продажах и не должен иметь доступа ко всем файлам в хранилище. Возвращаясь к принципу наименьших привилегий (одному из старейших принципов безопасности), ни один ресурс не должен иметь разрешений, превышающих те, которые необходимы для выполнения задач, для которых он был предназначен. ИИ представляет собой увеличенную проблему в этой области, так как для обеспечения его гибкости может быть сложно определить точные необходимые разрешения.

### Риски 
- Предоставление чрезмерных разрешений может позволить извлечение или изменение данных, к которым сервер MCP не должен был иметь доступ. Это также может быть проблемой конфиденциальности, если данные являются персональной информацией (PII).

### Средства смягчения
- **Применение принципа наименьших привилегий:** Предоставьте серверу MCP только минимально необходимые разрешения для выполнения его задач. Регулярно проверяйте и обновляйте эти разрешения, чтобы убедиться, что они не превышают необходимого. Для подробных рекомендаций смотрите [Безопасный доступ с наименьшими привилегиями](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access).
- **Использование управления доступом на основе ролей (RBAC):** Назначайте роли серверу MCP, которые строго ограничены определенными ресурсами и действиями, избегая широких или ненужных разрешений.
- **Мониторинг и аудит разрешений:** Постоянно следите за использованием разрешений и проводите аудит журналов доступа, чтобы своевременно выявлять и устранять чрезмерные или неиспользуемые привилегии.

# Косвенные атаки внедрения инструкций

### Постановка проблемы

Вредоносные или скомпрометированные серверы MCP могут представлять значительные риски, раскрывая данные клиентов или позволяя непреднамеренные действия. Эти риски особенно актуальны в рабочих нагрузках на основе ИИ и MCP, где:

- **Атаки внедрения инструкций**: Злоумышленники встраивают вредоносные инструкции в подсказки или внешнее содержание, заставляя систему ИИ выполнять непреднамеренные действия или раскрывать конфиденциальные данные. Подробнее: [Внедрение инструкций](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- **Отравление инструментов**: Злоумышленники манипулируют метаданными инструментов (например, описаниями или параметрами), чтобы повлиять на поведение ИИ, возможно, обходя средства контроля безопасности или извлекая данные. Подробности: [Отравление инструментов](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- **Кросс-доменное внедрение инструкций**: Вредоносные инструкции встраиваются в документы, веб-страницы или электронные письма, которые затем обрабатываются ИИ, что приводит к утечке данных или манипуляциям.
- **Динамическая модификация инструментов (Rug Pulls)**: Определения инструментов могут быть изменены после одобрения пользователем, вводя новые вредоносные поведения без ведома пользователя.

Эти уязвимости подчеркивают необходимость надежной проверки, мониторинга и средств контроля безопасности при интеграции серверов и инструментов MCP в вашу среду. Для более глубокого погружения смотрите ссылки выше.

![prompt-injection-lg-2048x1034](../../../translated_images/prompt-injection.4b2f1af239a32d46221a75c7bc5b6f392ebbacc47eccde241d4c60507232fa43.ru.png)

**Косвенное внедрение инструкций** (также известное как кросс-доменное внедрение инструкций или XPIA) является критической уязвимостью в генеративных системах ИИ, включая те, которые используют Протокол Контекста Модели (MCP). В этой атаке вредоносные инструкции скрываются во внешнем содержании — например, в документах, веб-страницах или электронных письмах. Когда система ИИ обрабатывает это содержание, она может интерпретировать встроенные инструкции как законные команды пользователя, что приводит к непреднамеренным действиям, таким как утечка данных, создание вредоносного контента или манипуляция взаимодействиями пользователя. Для подробного объяснения и реальных примеров смотрите [Внедрение инструкций](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/).

Особенно опасной формой этой атаки является **Отравление инструментов**. Здесь злоумышленники внедряют вредоносные инструкции в метаданные инструментов MCP (например, описания или параметры инструментов). Поскольку большие языковые модели (LLM) полагаются на эти метаданные для определения, какие инструменты вызывать, скомпрометированные описания могут обмануть модель, заставив ее выполнять неавторизованные вызовы инструментов или обходить средства контроля безопасности. Эти манипуляции часто невидимы для конечных пользователей, но могут быть интерпретированы и выполнены системой ИИ. Этот риск усиливается в средах с размещенными серверами MCP, где определения инструментов могут быть обновлены после одобрения пользователем — сценарий, иногда называемый "[rug pull](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)". В таких случаях инструмент, который ранее был безопасным, может позже быть изменен для выполнения вредоносных действий, таких как извлечение данных или изменение поведения системы, без ведома пользователя. Для получения дополнительной информации об этом векторе атаки смотрите [Отравление инструментов](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks).

![tool-injection-lg-2048x1239 (1)](../../../translated_images/tool-injection.d4607023f69e16157954001ad81afd763676361f03db0a1cf24ec696b2ddcb88.ru.png)

## Риски
Непреднамеренные действия ИИ представляют различные риски безопасности, включая утечку данных и нарушения конфиденциальности.

### Средства смягчения
### Использование щитов для защиты от косвенных атак внедрения инструкций
-----------------------------------------------------------------------------

**Щиты подсказок ИИ** — это решение, разработанное Microsoft для защиты от как прямых, так и косвенных атак внедрения инструкций. Они помогают через:

1.  **Обнаружение и фильтрация**: Щиты подсказок используют продвинутые алгоритмы машинного обучения и обработку естественного языка для обнаружения и фильтрации вредоносных инструкций, встроенных во внешнее содержание, такое как документы, веб-страницы или электронные письма.
    
2.  **Подсветка**: Эта техника помогает системе ИИ различать действительные системные инструкции и потенциально ненадежные внешние входные данные. Преобразуя текст ввода таким образом, чтобы он был более релевантен модели, Подсветка обеспечивает лучшее распознавание и игнорирование вредоносных инструкций ИИ.
    
3.  **Разделители и маркировка данных**: Включение разделителей в системное сообщение явно обозначает местоположение текста ввода, помогая системе ИИ распознавать и отделять входные данные пользователя от потенциально вредоносного внешнего контента. Маркировка данных расширяет эту концепцию, используя специальные метки для выделения границ надежных и ненадежных данных.
    
4.  **Непрерывный мониторинг и обновления**: Microsoft постоянно мониторит и обновляет Щиты подсказок для противодействия новым и развивающимся угрозам. Этот проактивный подход обеспечивает сохранение эффективности защит от последних техник атак.
    
5. **Интеграция с Azure Content Safety:** Щиты подсказок являются частью более широкой системы безопасности контента Azure AI, которая предоставляет дополнительные инструменты для обнаружения попыток взлома, вредоносного контента и других рисков безопасности в приложениях ИИ.

Вы можете узнать больше о щитах подсказок ИИ в [документации по Щитам подсказок](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection).

![prompt-shield-lg-2048x1328](../../../translated_images/prompt-shield.a4dba28a04ea42d28053f233585290d4862b244ca1e59b8ff695c5530e1bba66.ru.png)

### Безопасность цепочки поставок

Безопасность цепочки поставок остается фундаментальной в эпоху ИИ, но объем того, что составляет вашу цепочку поставок, расширился. В дополнение к традиционным пакетам кода, теперь вы должны тщательно проверять и мониторить все компоненты, связанные с ИИ, включая базовые модели, службы встраивания, поставщиков контекста и сторонние API. Каждый из них может ввести уязвимости или риски, если не управляется должным образом.

**Ключевые практики безопасности цепочки поставок для ИИ и MCP:**
- **Проверяйте все компоненты перед интеграцией:** Это касается не только библиотек с открытым исходным кодом, но и моделей ИИ, источников данных и внешних API. Всегда проверяйте происхождение, лицензирование и известные уязвимости.
- **Поддерживайте безопасные конвейеры развертывания:** Используйте автоматизированные конвейеры CI/CD с интегрированным сканированием безопасности, чтобы выявлять проблемы на ранней стадии. Убедитесь, что только надежные артефакты развертываются в производственной среде.
- **Постоянно мониторьте и проводите аудит:** Реализуйте постоянный мониторинг всех зависимостей, включая модели и службы данных, чтобы выявлять новые уязвимости или атаки на цепочку поставок.
- **Применяйте принцип наименьших привилегий и средства контроля доступа:** Ограничьте доступ к моделям, данным и службам только тем, что необходимо для работы вашего сервера MCP.
- **Быстро реагируйте на угрозы:** Имейте процесс для исправления или замены скомпрометированных компонентов, а также для ротации секретов или учетных данных в случае обнаружения нарушения.

[GitHub Advanced Security](https://github.com/security/advanced-security) предоставляет такие функции, как сканирование секретов, сканирование зависимостей и анализ CodeQL. Эти инструменты интегрируются с [Azure DevOps](https://azure.microsoft.com/en-us/products/devops) и [Azure Repos](https://azure.microsoft.com/en-us/products/devops/repos/), чтобы помочь командам выявлять и смягчать уязвимости как в коде, так и в компонентах цепочки поставок ИИ.

Microsoft также внедряет обширные практики безопасности цепочки поставок внутри компании для всех продуктов. Узнайте больше в [Путешествие по обеспечению безопасности цепочки поставок программного обеспечения в Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/).

# Установленные лучшие практики безопасности, которые улучшат безопасность вашей реализации MCP

Любая реализация MCP наследует существующую безопасность вашей организационной среды, на которой она построена, поэтому, рассматривая безопасность MCP как компонента ваших общих систем ИИ, рекомендуется обратить внимание на улучшение вашей общей существующей безопасности. Следующие установленные средства контроля безопасности особенно актуальны:

-   Лучшие практики безопасного кодирования в вашем приложении ИИ - защита от [OWASP Top 10](https://owasp.org/www-project-top-ten/), [OWASP Top 10 для LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559), использование безопасных хранилищ для секретов и токенов, реализация безопасных коммуникаций между всеми компонентами приложения и т. д.
-   Укрепление серверов -- использование MFA, где возможно, поддерж
- [OWASP Top 10 для LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559)
- [Расширенная безопасность GitHub](https://github.com/security/advanced-security)
- [Azure DevOps](https://azure.microsoft.com/products/devops)
- [Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [Путь к обеспечению безопасности цепочки поставок программного обеспечения в Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)
- [Безопасный доступ с минимальными привилегиями (Microsoft)](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [Лучшие практики для проверки токенов и их срока действия](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [Использование безопасного хранения токенов и их шифрование (YouTube)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)
- [Управление API Azure как шлюз аутентификации для MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [Использование Microsoft Entra ID для аутентификации с серверами MCP](https://den.dev/blog/mcp-server-auth-entra-id-session/)

### Далее

Далее: [Глава 3: Начало работы](/03-GettingStarted/README.md)

**Отказ от ответственности**:  
Этот документ был переведен с использованием сервиса автоматического перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Хотя мы стремимся к точности, пожалуйста, имейте в виду, что автоматизированные переводы могут содержать ошибки или неточности. Оригинальный документ на его родном языке следует считать авторитетным источником. Для получения критически важной информации рекомендуется профессиональный перевод человеком. Мы не несем ответственности за любые недоразумения или неправильные интерпретации, возникающие в результате использования этого перевода.