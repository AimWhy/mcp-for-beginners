<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "af6cee6052e751674c1d9022a4b204e6",
  "translation_date": "2025-06-03T14:22:26+00:00",
  "source_file": "03-GettingStarted/06-aitk/README.md",
  "language_code": "ru"
}
-->
# Использование сервера из расширения AI Toolkit для Visual Studio Code

При создании AI-агента важно не только генерировать умные ответы, но и дать агенту возможность выполнять действия. Здесь на помощь приходит Model Context Protocol (MCP). MCP упрощает доступ агентов к внешним инструментам и сервисам единообразным способом. Представьте это как подключение агента к набору инструментов, которыми он действительно может пользоваться.

Допустим, вы подключаете агента к серверу MCP с калькулятором. Вдруг агент может выполнять математические операции, просто получая запрос вроде «Сколько будет 47 умножить на 89?» — без необходимости жестко прописывать логику или создавать собственные API.

## Обзор

В этом уроке рассматривается, как подключить сервер MCP с калькулятором к агенту с помощью расширения [AI Toolkit](https://aka.ms/AIToolkit) в Visual Studio Code, чтобы агент мог выполнять операции сложения, вычитания, умножения и деления через естественный язык.

AI Toolkit — мощное расширение для Visual Studio Code, которое упрощает разработку агентов. AI-инженеры могут легко создавать AI-приложения, разрабатывая и тестируя генеративные AI-модели — локально или в облаке. Расширение поддерживает большинство популярных генеративных моделей на сегодняшний день.

*Примечание*: AI Toolkit в настоящее время поддерживает Python и TypeScript.

## Цели обучения

К концу урока вы сможете:

- Использовать MCP сервер через AI Toolkit.
- Настроить конфигурацию агента для обнаружения и использования инструментов, предоставляемых MCP сервером.
- Использовать инструменты MCP через естественный язык.

## Подход

Вот общий план действий:

- Создать агента и определить его системный промпт.
- Создать MCP сервер с инструментами калькулятора.
- Подключить Agent Builder к MCP серверу.
- Проверить вызов инструментов агента через естественный язык.

Отлично, теперь, когда мы понимаем общий процесс, давайте настроим AI-агента для использования внешних инструментов через MCP, расширяя его возможности!

## Требования

- [Visual Studio Code](https://code.visualstudio.com/)
- [AI Toolkit для Visual Studio Code](https://aka.ms/AIToolkit)

## Упражнение: Использование сервера

В этом упражнении вы создадите, запустите и улучшите AI-агента с помощью инструментов с MCP сервера внутри Visual Studio Code, используя AI Toolkit.

### -0- Подготовительный шаг: добавьте модель OpenAI GPT-4o в Мои модели

Для упражнения используется модель **GPT-4o**. Модель нужно добавить в **Мои модели** перед созданием агента.

![Скриншот интерфейса выбора модели в расширении AI Toolkit для Visual Studio Code. Заголовок гласит «Найдите подходящую модель для вашего AI-решения», подзаголовок призывает открывать, тестировать и разворачивать AI-модели. Ниже, в разделе «Популярные модели», отображаются шесть карточек моделей: DeepSeek-R1 (размещённая на GitHub), OpenAI GPT-4o, OpenAI GPT-4.1, OpenAI o1, Phi 4 Mini (CPU - маленькая, быстрая) и DeepSeek-R1 (размещённая на Ollama). На каждой карточке есть кнопки «Добавить» и «Попробовать в Playground».](../../../../translated_images/aitk-model-catalog.c0c66f0d9ac0ee73c1d21b9207db99e914ef9dd52fced6f226c2b1f537e2c447.ru.png)

1. Откройте расширение **AI Toolkit** через **Activity Bar**.
2. В разделе **Catalog** выберите **Models**, чтобы открыть **Каталог моделей**. Каталог откроется в новой вкладке редактора.
3. В строке поиска каталога введите **OpenAI GPT-4o**.
4. Нажмите **+ Add**, чтобы добавить модель в список **Мои модели**. Убедитесь, что выбрали модель, которая **размещена на GitHub**.
5. Проверьте в **Activity Bar**, что модель **OpenAI GPT-4o** появилась в списке.

### -1- Создайте агента

**Agent (Prompt) Builder** позволяет создавать и настраивать собственных AI-агентов. В этом разделе вы создадите нового агента и назначите модель для поддержки диалога.

![Скриншот интерфейса "Calculator Agent" в AI Toolkit для Visual Studio Code. На левой панели выбрана модель "OpenAI GPT-4o (через GitHub)". Системный промпт: "Вы профессор университета, преподающий математику", пользовательский промпт: "Объясни мне уравнение Фурье простыми словами". Дополнительно есть кнопки для добавления инструментов, включения MCP Server и выбора структурированного вывода. Внизу синяя кнопка «Run». Справа в разделе «Get Started with Examples» перечислены три примера агентов: Web Developer (с MCP Server), Second-Grade Simplifier и Dream Interpreter с краткими описаниями их функций.](../../../../translated_images/aitk-agent-builder.fb7df60f7923b4d8ba839662bf6d7647e843c01b57256e1e9adecb46a64d3408.ru.png)

1. Откройте расширение **AI Toolkit** через **Activity Bar**.
2. В разделе **Tools** выберите **Agent (Prompt) Builder**. Откроется новая вкладка редактора с этим инструментом.
3. Нажмите кнопку **+ New Agent**. Расширение запустит мастер настройки через **Command Palette**.
4. Введите имя **Calculator Agent** и нажмите **Enter**.
5. В поле **Model** выберите модель **OpenAI GPT-4o (через GitHub)**.

### -2- Создайте системный промпт для агента

Теперь, когда агент создан, пора задать его личность и цель. В этом разделе вы воспользуетесь функцией **Generate system prompt**, чтобы описать поведение агента — в данном случае, калькулятора — и позволить модели сгенерировать системный промпт.

![Скриншот интерфейса "Calculator Agent" в AI Toolkit для Visual Studio Code с открытым модальным окном «Generate a prompt». В окне объясняется, что шаблон промпта можно сгенерировать, указав базовые данные. В текстовом поле приведён пример системного промта: "Вы полезный и эффективный помощник по математике. При решении задач с базовой арифметикой вы отвечаете с правильным результатом." Ниже кнопки "Close" и "Generate". На заднем плане видна часть конфигурации агента с выбранной моделью "OpenAI GPT-4o (через GitHub)" и полями для системного и пользовательского промптов.](../../../../translated_images/aitk-generate-prompt.0d4292407c15282bf714e327f5d3d833389324004135727ef28adc22dbbb4e8f.ru.png)

1. В разделе **Prompts** нажмите кнопку **Generate system prompt**. Откроется генератор промптов, использующий AI для создания системного промпта.
2. В окне **Generate a prompt** введите: `You are a helpful and efficient math assistant. When given a problem involving basic arithmetic, you respond with the correct result.`
3. Нажмите кнопку **Generate**. В правом нижнем углу появится уведомление о начале генерации. После завершения сгенерированный промпт появится в поле **System prompt** в **Agent (Prompt) Builder**.
4. Проверьте системный промпт и при необходимости отредактируйте.

### -3- Создайте MCP сервер

Теперь, когда системный промпт агента задан — он определяет поведение и ответы — пора добавить практические возможности. В этом разделе вы создадите MCP сервер с калькулятором, который умеет выполнять сложение, вычитание, умножение и деление. Этот сервер позволит агенту выполнять математические операции в режиме реального времени, отвечая на запросы на естественном языке.

![Скриншот нижней части интерфейса Calculator Agent в AI Toolkit для Visual Studio Code. Видны раскрывающиеся меню «Tools» и «Structure output», выпадающее меню с выбором формата вывода, установленным на «text». Справа кнопка «+ MCP Server» для добавления сервера Model Context Protocol. Над разделом Tools отображается иконка-заглушка для изображения.](../../../../translated_images/aitk-add-mcp-server.9b158809336d87e8076eb5954846040a7370c88046639a09e766398c8855c3d3.ru.png)

AI Toolkit предоставляет шаблоны, облегчающие создание MCP серверов. Мы воспользуемся шаблоном на Python для создания сервера калькулятора.

*Примечание*: AI Toolkit в настоящее время поддерживает Python и TypeScript.

1. В разделе **Tools** в **Agent (Prompt) Builder** нажмите кнопку **+ MCP Server**. Запустится мастер настройки через **Command Palette**.
2. Выберите **+ Add Server**.
3. Выберите **Create a New MCP Server**.
4. Выберите шаблон **python-weather**.
5. Выберите **Default folder** для сохранения шаблона MCP сервера.
6. Введите имя сервера: **Calculator**.
7. Откроется новое окно Visual Studio Code. Подтвердите выбор, нажав **Yes, I trust the authors**.
8. В терминале (**Terminal** > **New Terminal**) создайте виртуальное окружение: `python -m venv .venv`
9. Активируйте виртуальное окружение в терминале:
    1. Windows — `.venv\Scripts\activate`
    2. macOS/Linux — `source venv/bin/activate`
10. Установите зависимости через терминал: `pip install -e .[dev]`
11. В обозревателе (**Explorer**) в **Activity Bar** раскройте папку **src** и откройте файл **server.py**.
12. Замените содержимое файла **server.py** на следующий код и сохраните:

    ```python
    """
    Sample MCP Calculator Server implementation in Python.

    
    This module demonstrates how to create a simple MCP server with calculator tools
    that can perform basic arithmetic operations (add, subtract, multiply, divide).
    """
    
    from mcp.server.fastmcp import FastMCP
    
    server = FastMCP("calculator")
    
    @server.tool()
    def add(a: float, b: float) -> float:
        """Add two numbers together and return the result."""
        return a + b
    
    @server.tool()
    def subtract(a: float, b: float) -> float:
        """Subtract b from a and return the result."""
        return a - b
    
    @server.tool()
    def multiply(a: float, b: float) -> float:
        """Multiply two numbers together and return the result."""
        return a * b
    
    @server.tool()
    def divide(a: float, b: float) -> float:
        """
        Divide a by b and return the result.
        
        Raises:
            ValueError: If b is zero
        """
        if b == 0:
            raise ValueError("Cannot divide by zero")
        return a / b
    ```

### -4- Запустите агента с сервером калькулятора MCP

Теперь, когда у вашего агента есть инструменты, пора их использовать! В этом разделе вы отправите запросы агенту, чтобы проверить, использует ли он соответствующий инструмент с сервера калькулятора MCP.

![Скриншот интерфейса Calculator Agent в AI Toolkit для Visual Studio Code. Слева в разделе «Tools» добавлен MCP сервер с именем local-server-calculator_server, отображаются четыре доступных инструмента: add, subtract, multiply и divide. Значок показывает, что активны четыре инструмента. Ниже свернут раздел «Structure output» и синяя кнопка «Run». Справа в разделе «Model Response» агент вызывает инструменты multiply и subtract с входными данными {"a": 3, "b": 25} и {"a": 75, "b": 20} соответственно. Итоговый ответ инструмента — 75.0. Внизу есть кнопка «View Code».](../../../../translated_images/aitk-agent-response-with-tools.0f0da2c6eef5eb3f5b7592d6d056449aa8aaa42a3ab0b0c2f14269b3049cfdb5.ru.png)

Вы запустите сервер калькулятора MCP локально через **Agent Builder** как MCP клиент.

1. Нажмите `F5`.
2. Введите запрос: ` to start debugging the MCP server. The **Agent (Prompt) Builder** will open in a new editor tab. The status of the server is visible in the terminal.
1. In the **User prompt** field of the **Agent (Prompt) Builder**, enter the following prompt: `I bought 3 items priced at $25 each, and then used a $20 discount. How much did I pay?`
1. Click the **Run** button to generate the agent's response.
1. Review the agent output. The model should conclude that you paid **$55**.
1. Here's a breakdown of what should occur:
    - The agent selects the **multiply** and **substract** tools to aid in the calculation.
    - The respective `a` and `b` values are assigned for the **multiply** tool.
    - The respective `a` and `b`, где значения назначены для инструмента **subtract**.
    - Ответы от каждого инструмента отображаются в соответствующем поле **Tool Response**.
    - Итоговый вывод модели отображается в поле **Model Response**.
3. Отправляйте дополнительные запросы для дальнейшего тестирования агента. Вы можете изменить текущий запрос в поле **User prompt**, просто кликнув по нему и заменив текст.
4. По окончании тестирования остановите сервер в терминале, нажав **CTRL/CMD+C**.

## Задание

Попробуйте добавить новую функцию в файл **server.py** (например, вычисление квадратного корня). Отправьте запросы, которые потребуют от агента использовать ваш новый инструмент (или существующие). Не забудьте перезапустить сервер, чтобы загрузить новые инструменты.

## Решение

[Решение](./solution/README.md)

## Основные выводы

Главные выводы из этой главы:

- Расширение AI Toolkit — отличный клиент для работы с MCP серверами и их инструментами.
- Вы можете добавлять новые инструменты в MCP серверы, расширяя возможности агента под меняющиеся задачи.
- AI Toolkit включает шаблоны (например, для Python MCP серверов), упрощающие создание собственных инструментов.

## Дополнительные ресурсы

- [Документация AI Toolkit](https://aka.ms/AIToolkit/doc)

## Что дальше

Далее: [Урок 4 Практическая реализация](/04-PracticalImplementation/README.md)

**Отказ от ответственности**:  
Этот документ был переведен с использованием сервиса автоматического перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Несмотря на наши усилия по обеспечению точности, имейте в виду, что автоматический перевод может содержать ошибки или неточности. Оригинальный документ на исходном языке следует считать авторитетным источником. Для получения критически важной информации рекомендуется использовать профессиональный перевод, выполненный человеком. Мы не несем ответственности за любые недоразумения или неправильные толкования, возникшие в результате использования данного перевода.