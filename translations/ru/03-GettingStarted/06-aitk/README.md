<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "a3cbadbf632058aa59a523ac659aa1df",
  "translation_date": "2025-05-17T12:14:25+00:00",
  "source_file": "03-GettingStarted/06-aitk/README.md",
  "language_code": "ru"
}
-->
# Использование сервера из расширения AI Toolkit для Visual Studio Code

При создании AI-агента важно не только генерировать умные ответы, но и предоставлять агенту возможность действовать. Именно здесь вступает в игру Протокол Контекста Модели (MCP). MCP позволяет агентам легко получать доступ к внешним инструментам и сервисам в едином формате. Представьте, что вы подключаете своего агента к набору инструментов, которые он может *действительно* использовать.

Предположим, вы подключаете агента к серверу MCP-калькулятора. Внезапно ваш агент может выполнять математические операции, просто получая запрос типа «Сколько будет 47 умножить на 89?» — без необходимости жестко кодировать логику или создавать пользовательские API.

## Обзор

Этот урок охватывает процесс подключения сервера MCP-калькулятора к агенту с помощью расширения [AI Toolkit](https://aka.ms/AIToolkit) в Visual Studio Code, позволяя вашему агенту выполнять математические операции, такие как сложение, вычитание, умножение и деление через естественный язык.

AI Toolkit — это мощное расширение для Visual Studio Code, которое упрощает разработку агентов. Инженеры AI могут легко создавать AI-приложения, разрабатывая и тестируя генеративные модели AI — локально или в облаке. Расширение поддерживает большинство основных генеративных моделей, доступных сегодня.

*Примечание*: AI Toolkit в настоящее время поддерживает Python и TypeScript.

## Цели обучения

К концу этого урока вы сможете:

- Использовать сервер MCP через AI Toolkit.
- Настроить конфигурацию агента, чтобы он мог обнаруживать и использовать инструменты, предоставляемые сервером MCP.
- Использовать инструменты MCP через естественный язык.

## Подход

Вот как мы должны подойти к этому на высоком уровне:

- Создать агента и определить его системный запрос.
- Создать сервер MCP с инструментами калькулятора.
- Подключить Конструктор Агентов к серверу MCP.
- Проверить вызов инструментов агента через естественный язык.

Отлично, теперь, когда мы понимаем поток, давайте настроим AI-агента для использования внешних инструментов через MCP, расширяя его возможности!

## Предварительные требования

- [Visual Studio Code](https://code.visualstudio.com/)
- [AI Toolkit для Visual Studio Code](https://aka.ms/AIToolkit)

## Упражнение: Использование сервера

В этом упражнении вы создадите, запустите и улучшите AI-агента с помощью инструментов из сервера MCP внутри Visual Studio Code с использованием AI Toolkit.

### -0- Предварительный шаг, добавьте модель OpenAI GPT-4o в Мои Модели

Упражнение использует модель **GPT-4o**. Модель должна быть добавлена в **Мои Модели** перед созданием агента.

1. Откройте расширение **AI Toolkit** из **Панели активности**.
1. В разделе **Каталог** выберите **Модели**, чтобы открыть **Каталог моделей**. Выбор **Модели** открывает **Каталог моделей** в новой вкладке редактора.
1. В строке поиска **Каталога моделей** введите **OpenAI GPT-4o**.
1. Нажмите **+ Add**, чтобы добавить модель в ваш список **Мои Модели**. Убедитесь, что вы выбрали модель, **хостируемую на GitHub**.
1. В **Панели активности** подтвердите, что модель **OpenAI GPT-4o** появляется в списке.

### -1- Создайте агента

**Конструктор Агентов (Prompt Builder)** позволяет создавать и настраивать собственных агентов на базе AI. В этом разделе вы создадите нового агента и назначите модель для ведения беседы.

1. Откройте расширение **AI Toolkit** из **Панели активности**.
1. В разделе **Инструменты** выберите **Конструктор Агентов (Prompt Builder)**. Выбор **Конструктор Агентов (Prompt Builder)** открывает **Конструктор Агентов (Prompt Builder)** в новой вкладке редактора.
1. Нажмите кнопку **+ Новый Конструктор**. Расширение запустит мастер настройки через **Палитру команд**.
1. Введите имя **Calculator Agent** и нажмите **Enter**.
1. В **Конструкторе Агентов (Prompt Builder)** для поля **Модель** выберите модель **OpenAI GPT-4o (via GitHub)**.

### -2- Создайте системный запрос для агента

С агентом, подготовленным к работе, пора определить его личность и цель. В этом разделе вы используете функцию **Генерация системного запроса**, чтобы описать предполагаемое поведение агента — в данном случае, агента-калькулятора — и позволить модели написать системный запрос для вас.

1. В разделе **Запросы** нажмите кнопку **Генерация системного запроса**. Эта кнопка открывается в конструкторе запросов, который использует AI для генерации системного запроса для агента.
1. В окне **Генерация запроса** введите следующее: `You are a helpful and efficient math assistant. When given a problem involving basic arithmetic, you respond with the correct result.`
1. Нажмите кнопку **Генерация**. В нижнем правом углу появится уведомление, подтверждающее, что системный запрос генерируется. После завершения генерации запроса он появится в поле **Системный запрос** в **Конструкторе Агентов (Prompt Builder)**.
1. Просмотрите **Системный запрос** и измените его, если необходимо.

### -3- Создайте сервер MCP

Теперь, когда вы определили системный запрос вашего агента, направляющий его поведение и ответы, пора предоставить агенту практические возможности. В этом разделе вы создадите сервер MCP-калькулятора с инструментами для выполнения вычислений сложения, вычитания, умножения и деления. Этот сервер позволит вашему агенту выполнять математические операции в реальном времени в ответ на запросы на естественном языке.

AI Toolkit оснащен шаблонами для легкости создания вашего собственного сервера MCP. Мы используем шаблон Python для создания сервера MCP-калькулятора.

*Примечание*: AI Toolkit в настоящее время поддерживает Python и TypeScript.

1. В разделе **Инструменты** в **Конструкторе Агентов (Prompt Builder)** нажмите кнопку **+ MCP Server**. Расширение запустит мастер настройки через **Палитру команд**.
1. Выберите **+ Добавить Сервер**.
1. Выберите **Создать новый сервер MCP**.
1. Выберите **python-weather** в качестве шаблона.
1. Выберите **Папка по умолчанию** для сохранения шаблона сервера MCP.
1. Введите следующее имя для сервера: **Calculator**
1. Откроется новое окно Visual Studio Code. Выберите **Да, я доверяю авторам**.
1. Используя терминал (**Терминал** > **Новый Терминал**), создайте виртуальное окружение: `python -m venv .venv`
1. Используя терминал, активируйте виртуальное окружение:
    1. Windows - `.venv\Scripts\activate`
    1. macOS/Linux - `source venv/bin/activate`
1. Используя терминал, установите зависимости: `pip install -e .[dev]`
1. В представлении **Проводник** в **Панели активности** разверните каталог **src** и выберите **server.py**, чтобы открыть файл в редакторе.
1. Замените код в файле **server.py** следующим и сохраните:

    ```python
    """
    Sample MCP Calculator Server implementation in Python.

    
    This module demonstrates how to create a simple MCP server with calculator tools
    that can perform basic arithmetic operations (add, subtract, multiply, divide).
    """
    
    from mcp.server.fastmcp import FastMCP
    
    server = FastMCP("calculator")
    
    @server.tool()
    def add(a: float, b: float) -> float:
        """Add two numbers together and return the result."""
        return a + b
    
    @server.tool()
    def subtract(a: float, b: float) -> float:
        """Subtract b from a and return the result."""
        return a - b
    
    @server.tool()
    def multiply(a: float, b: float) -> float:
        """Multiply two numbers together and return the result."""
        return a * b
    
    @server.tool()
    def divide(a: float, b: float) -> float:
        """
        Divide a by b and return the result.
        
        Raises:
            ValueError: If b is zero
        """
        if b == 0:
            raise ValueError("Cannot divide by zero")
        return a / b
    ```

### -4- Запустите агента с сервером MCP-калькулятора

Теперь, когда у вашего агента есть инструменты, пора их использовать! В этом разделе вы отправите запросы агенту, чтобы протестировать и подтвердить, использует ли агент соответствующий инструмент из сервера MCP-калькулятора.

Вы будете запускать сервер MCP-калькулятора на вашей локальной машине разработки через **Конструктор Агентов** как MCP-клиент.

1. Нажмите `F5` to start debugging the MCP server. The **Agent (Prompt) Builder** will open in a new editor tab. The status of the server is visible in the terminal.
1. In the **User prompt** field of the **Agent (Prompt) Builder**, enter the following prompt: `Я купил 3 товара по цене $25 каждый, а затем использовал скидку $20. Сколько я заплатил?`
1. Click the **Run** button to generate the agent's response.
1. Review the agent output. The model should conclude that you paid **$55**.
1. Here's a breakdown of what should occur:
    - The agent selects the **multiply** and **substract** tools to aid in the calculation.
    - The respective `a` and `b` values are assigned for the **multiply** tool.
    - The respective `a` and `b` значения назначаются для инструмента **вычитания**.
    - Ответ от каждого инструмента предоставляется в соответствующем **Ответе Инструмента**.
    - Окончательный вывод от модели предоставляется в окончательном **Ответе Модели**.
1. Отправьте дополнительные запросы, чтобы дальше тестировать агента. Вы можете изменить существующий запрос в поле **Запрос пользователя**, нажав на поле и заменив существующий запрос.
1. После завершения тестирования агента вы можете остановить сервер через **терминал**, введя **CTRL/CMD+C**, чтобы выйти.

## Задание

Попробуйте добавить дополнительную запись инструмента в ваш файл **server.py** (например, возврат квадратного корня числа). Отправьте дополнительные запросы, которые потребуют от агента использовать ваш новый инструмент (или существующие инструменты). Обязательно перезапустите сервер, чтобы загрузить вновь добавленные инструменты.

## Решение

[Решение](./solution/README.md)

## Основные выводы

Основные выводы из этой главы следующие:

- Расширение AI Toolkit — отличный клиент, который позволяет вам использовать MCP-серверы и их инструменты.
- Вы можете добавлять новые инструменты в MCP-серверы, расширяя возможности агента для удовлетворения изменяющихся требований.
- AI Toolkit включает шаблоны (например, шаблоны серверов MCP на Python), чтобы упростить создание пользовательских инструментов.

## Дополнительные ресурсы

- [Документы AI Toolkit](https://aka.ms/AIToolkit/doc)

## Что дальше

Далее: [Урок 4 Практическая реализация](/04-PracticalImplementation/README.md)

**Отказ от ответственности**:  
Этот документ был переведен с помощью сервиса автоматического перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Мы стремимся к точности, однако, пожалуйста, учитывайте, что автоматизированные переводы могут содержать ошибки или неточности. Оригинальный документ на его родном языке следует считать авторитетным источником. Для получения критически важной информации рекомендуется профессиональный перевод человеком. Мы не несем ответственности за любые недоразумения или неправильные интерпретации, возникающие в результате использования этого перевода.