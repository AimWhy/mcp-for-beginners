<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "d1980763f2a545ca6648363bf5757b5a",
  "translation_date": "2025-06-13T02:13:45+00:00",
  "source_file": "03-GettingStarted/07-aitk/README.md",
  "language_code": "ru"
}
-->
# Использование сервера из расширения AI Toolkit для Visual Studio Code

Когда вы создаёте AI-агента, важно не только генерировать умные ответы, но и дать агенту возможность выполнять действия. Именно здесь на помощь приходит Model Context Protocol (MCP). MCP упрощает доступ агентов к внешним инструментам и сервисам единообразным способом. Представьте это как подключение агента к настоящему набору инструментов, который он может использовать.

Допустим, вы подключаете агента к вашему серверу MCP с калькулятором. Вдруг ваш агент сможет выполнять математические операции, просто получая запрос вроде «Сколько будет 47 умножить на 89?» — без необходимости писать логику вручную или создавать кастомные API.

## Обзор

В этом уроке показано, как подключить сервер MCP с калькулятором к агенту с помощью расширения [AI Toolkit](https://aka.ms/AIToolkit) в Visual Studio Code, чтобы агент мог выполнять математические операции — сложение, вычитание, умножение и деление — через естественный язык.

AI Toolkit — мощное расширение для Visual Studio Code, которое упрощает разработку агентов. AI-инженеры могут легко создавать AI-приложения, разрабатывая и тестируя генеративные модели AI — локально или в облаке. Расширение поддерживает большинство популярных генеративных моделей.

*Примечание*: в данный момент AI Toolkit поддерживает Python и TypeScript.

## Цели обучения

К концу урока вы сможете:

- Использовать сервер MCP через AI Toolkit.
- Настроить конфигурацию агента для обнаружения и использования инструментов, предоставляемых сервером MCP.
- Взаимодействовать с инструментами MCP через естественный язык.

## Подход

Вот общий план действий:

- Создать агента и задать системный промпт.
- Создать сервер MCP с инструментами калькулятора.
- Подключить Agent Builder к серверу MCP.
- Проверить вызов инструментов агента через естественный язык.

Отлично, теперь, когда мы понимаем общий процесс, давайте настроим AI-агента для использования внешних инструментов через MCP, расширяя его возможности!

## Требования

- [Visual Studio Code](https://code.visualstudio.com/)
- [AI Toolkit для Visual Studio Code](https://aka.ms/AIToolkit)

## Упражнение: Использование сервера

В этом упражнении вы создадите, запустите и улучшите AI-агента с инструментами с сервера MCP внутри Visual Studio Code с помощью AI Toolkit.

### -0- Подготовительный шаг: добавьте модель OpenAI GPT-4o в Мои модели

В упражнении используется модель **GPT-4o**. Модель нужно добавить в **Мои модели** до создания агента.

![Скриншот интерфейса выбора модели в расширении AI Toolkit для Visual Studio Code. Заголовок: "Найдите подходящую модель для вашего AI-решения", подзаголовок приглашает открывать, тестировать и развёртывать AI-модели. В разделе “Популярные модели” отображены шесть карточек моделей: DeepSeek-R1 (хостинг GitHub), OpenAI GPT-4o, OpenAI GPT-4.1, OpenAI o1, Phi 4 Mini (CPU - Маленькая, Быстрая) и DeepSeek-R1 (хостинг Ollama). На каждой карточке есть кнопки “Добавить” или “Попробовать в Playground”.](../../../../translated_images/aitk-model-catalog.2acd38953bb9c119aa629fe74ef34cc56e4eed35e7f5acba7cd0a59e614ab335.ru.png)

1. Откройте расширение **AI Toolkit** через **Панель активности**.
2. В разделе **Каталог** выберите **Модели**, чтобы открыть **Каталог моделей**. Это откроется в новой вкладке редактора.
3. В строке поиска **Каталога моделей** введите **OpenAI GPT-4o**.
4. Нажмите **+ Добавить**, чтобы добавить модель в список **Мои модели**. Убедитесь, что выбрана модель, размещённая на **GitHub**.
5. Проверьте в **Панели активности**, что модель **OpenAI GPT-4o** появилась в списке.

### -1- Создайте агента

**Agent (Prompt) Builder** позволяет создавать и настраивать собственных AI-агентов. В этом разделе вы создадите нового агента и назначите модель для ведения диалога.

![Скриншот интерфейса создания агента "Calculator Agent" в AI Toolkit для Visual Studio Code. Слева выбрана модель "OpenAI GPT-4o (через GitHub)". Системный промпт: "Вы профессор университета, преподающий математику". Пользовательский промпт: "Объясни мне уравнение Фурье простыми словами". Есть кнопки для добавления инструментов, включения MCP Server и выбора структурированного вывода. Внизу синяя кнопка “Запустить”. Справа — раздел "Начать с примеров" с тремя образцами агентов: Веб-разработчик (с MCP Server, упрощателем для второго класса и толкователем снов), с краткими описаниями функций.](../../../../translated_images/aitk-agent-builder.901e3a2960c3e4774b29a23024ff5bec2d4232f57fae2a418b2aaae80f81c05f.ru.png)

1. Откройте расширение **AI Toolkit** через **Панель активности**.
2. В разделе **Инструменты** выберите **Agent (Prompt) Builder**. Откроется новая вкладка редактора.
3. Нажмите кнопку **+ Новый агент**. Запустится мастер настройки через **Command Palette**.
4. Введите имя **Calculator Agent** и нажмите **Enter**.
5. В поле **Модель** выберите модель **OpenAI GPT-4o (через GitHub)**.

### -2- Создайте системный промпт для агента

После создания каркаса агента пора задать его личность и цель. В этом разделе вы используете функцию **Сгенерировать системный промпт**, чтобы описать поведение агента — в данном случае, калькулятор — и позволить модели создать системный промпт за вас.

![Скриншот интерфейса "Calculator Agent" в AI Toolkit с открытым модальным окном "Сгенерировать промпт". В окне объясняется, что шаблон промпта можно создать, указав базовые данные. В текстовом поле пример системного промпта: "Вы — полезный и эффективный помощник по математике. При решении задач с базовой арифметикой вы отвечаете правильным результатом." Под полем кнопки "Закрыть" и "Сгенерировать". На фоне видна часть конфигурации агента с выбранной моделью "OpenAI GPT-4o (через GitHub)" и полями системного и пользовательского промптов.](../../../../translated_images/aitk-generate-prompt.ba9e69d3d2bbe2a26444d0c78775540b14196061eee32c2054e9ee68c4f51f3a.ru.png)

1. В разделе **Промпты** нажмите кнопку **Сгенерировать системный промпт**. Откроется конструктор промптов, который с помощью AI создаст системный промпт для агента.
2. В окне **Сгенерировать промпт** введите: `You are a helpful and efficient math assistant. When given a problem involving basic arithmetic, you respond with the correct result.`
3. Нажмите **Сгенерировать**. В правом нижнем углу появится уведомление о процессе генерации. После завершения промпт появится в поле **Системный промпт** в **Agent (Prompt) Builder**.
4. Просмотрите системный промпт и при необходимости отредактируйте.

### -3- Создайте сервер MCP

Теперь, когда системный промпт агента задан и определяет его поведение и ответы, пора дать агенту реальные возможности. В этом разделе вы создадите сервер MCP с калькулятором, включающий инструменты для сложения, вычитания, умножения и деления. Этот сервер позволит агенту выполнять математические операции в реальном времени, отвечая на запросы на естественном языке.

![Скриншот нижней части интерфейса Calculator Agent в AI Toolkit для Visual Studio Code. Видны раскрывающиеся меню “Инструменты” и “Структурированный вывод”, выпадающее меню “Выберите формат вывода” установлено на “текст”. Справа кнопка “+ MCP Server” для добавления сервера Model Context Protocol. Над разделом “Инструменты” показан плейсхолдер иконки изображения.](../../../../translated_images/aitk-add-mcp-server.9742cfddfe808353c0caf9cc0a7ed3e80e13abf4d2ebde315c81c3cb02a2a449.ru.png)

AI Toolkit содержит шаблоны, облегчающие создание собственного сервера MCP. Мы используем шаблон Python для создания калькуляторного сервера MCP.

*Примечание*: AI Toolkit поддерживает Python и TypeScript.

1. В разделе **Инструменты** в **Agent (Prompt) Builder** нажмите кнопку **+ MCP Server**. Запустится мастер настройки через **Command Palette**.
2. Выберите **+ Добавить сервер**.
3. Выберите **Создать новый MCP сервер**.
4. Выберите шаблон **python-weather**.
5. Выберите **Папка по умолчанию** для сохранения шаблона сервера MCP.
6. Введите имя сервера: **Calculator**
7. Откроется новое окно Visual Studio Code. Подтвердите выбор, нажав **Да, я доверяю авторам**.
8. В терминале (**Терминал** > **Новый терминал**) создайте виртуальное окружение: `python -m venv .venv`
9. Активируйте виртуальное окружение:
    1. Windows — `.venv\Scripts\activate`
    2. macOS/Linux — `source venv/bin/activate`
10. Установите зависимости: `pip install -e .[dev]`
11. В обозревателе файлов **Activity Bar** разверните папку **src** и откройте файл **server.py**.
12. Замените содержимое файла **server.py** на следующий код и сохраните:

    ```python
    """
    Sample MCP Calculator Server implementation in Python.

    
    This module demonstrates how to create a simple MCP server with calculator tools
    that can perform basic arithmetic operations (add, subtract, multiply, divide).
    """
    
    from mcp.server.fastmcp import FastMCP
    
    server = FastMCP("calculator")
    
    @server.tool()
    def add(a: float, b: float) -> float:
        """Add two numbers together and return the result."""
        return a + b
    
    @server.tool()
    def subtract(a: float, b: float) -> float:
        """Subtract b from a and return the result."""
        return a - b
    
    @server.tool()
    def multiply(a: float, b: float) -> float:
        """Multiply two numbers together and return the result."""
        return a * b
    
    @server.tool()
    def divide(a: float, b: float) -> float:
        """
        Divide a by b and return the result.
        
        Raises:
            ValueError: If b is zero
        """
        if b == 0:
            raise ValueError("Cannot divide by zero")
        return a / b
    ```

### -4- Запустите агента с сервером калькулятора MCP

Теперь, когда у агента есть инструменты, пора их использовать! В этом разделе вы отправите запросы агенту, чтобы проверить, использует ли он нужный инструмент из сервера калькулятора MCP.

![Скриншот интерфейса Calculator Agent в AI Toolkit для Visual Studio Code. Слева в разделе “Инструменты” добавлен MCP сервер с именем local-server-calculator_server, показаны четыре доступных инструмента: add, subtract, multiply и divide. Значок показывает, что четыре инструмента активны. Ниже свернут раздел “Структурированный вывод” и синяя кнопка “Запустить”. Справа в разделе “Ответ модели” агент вызывает инструменты multiply и subtract с параметрами {"a": 3, "b": 25} и {"a": 75, "b": 20} соответственно. Итоговый “Ответ инструмента” — 75.0. Внизу есть кнопка “Посмотреть код”.](../../../../translated_images/aitk-agent-response-with-tools.e7c781869dc8041a25f9903ed4f7e8e0c7e13d7d94f6786a6c51b1e172f56866.ru.png)

Вы запустите сервер калькулятора MCP на локальной машине разработчика через **Agent Builder** как MCP клиент.

1. Нажмите `F5` to start debugging the MCP server. The **Agent (Prompt) Builder** will open in a new editor tab. The status of the server is visible in the terminal.
1. In the **User prompt** field of the **Agent (Prompt) Builder**, enter the following prompt: `I bought 3 items priced at $25 each, and then used a $20 discount. How much did I pay?`
1. Click the **Run** button to generate the agent's response.
1. Review the agent output. The model should conclude that you paid **$55**.
1. Here's a breakdown of what should occur:
    - The agent selects the **multiply** and **substract** tools to aid in the calculation.
    - The respective `a` and `b` values are assigned for the **multiply** tool.
    - The respective `a` and `b` — эти значения назначены для инструмента **subtract**.
    - Ответ от каждого инструмента отображается в соответствующем поле **Tool Response**.
    - Итоговый ответ модели отображается в разделе **Model Response**.
2. Отправьте дополнительные запросы для дальнейшего тестирования агента. Вы можете изменить существующий запрос в поле **User prompt**, кликнув по нему и заменив текст.
3. По окончании тестирования остановите сервер через терминал, нажав **CTRL/CMD+C**.

## Задание

Попробуйте добавить новый инструмент в файл **server.py** (например, вычисление квадратного корня). Отправьте дополнительные запросы, требующие использования вашего нового инструмента (или существующих). Не забудьте перезапустить сервер, чтобы загрузить новые инструменты.

## Решение

[Решение](./solution/README.md)

## Основные выводы

Главные выводы из этой главы:

- Расширение AI Toolkit — отличный клиент для работы с серверами MCP и их инструментами.
- Вы можете добавлять новые инструменты в MCP серверы, расширяя возможности агента под новые задачи.
- AI Toolkit содержит шаблоны (например, шаблоны Python MCP серверов), упрощающие создание собственных инструментов.

## Дополнительные ресурсы

- [Документация AI Toolkit](https://aka.ms/AIToolkit/doc)

## Что дальше
- Далее: [Тестирование и отладка](/03-GettingStarted/08-testing/README.md)

**Отказ от ответственности**:  
Этот документ был переведен с помощью сервиса автоматического перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Несмотря на наши усилия обеспечить точность, просим учитывать, что автоматический перевод может содержать ошибки или неточности. Оригинальный документ на исходном языке следует считать авторитетным источником. Для критически важной информации рекомендуется профессиональный перевод человеком. Мы не несем ответственности за любые недоразумения или неправильные толкования, возникшие в результате использования данного перевода.