<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "8248e3491f5245ee6ab48ef724a4f65a",
  "translation_date": "2025-07-13T21:24:59+00:00",
  "source_file": "03-GettingStarted/07-aitk/README.md",
  "language_code": "ru"
}
-->
# Использование сервера из расширения AI Toolkit для Visual Studio Code

Когда вы создаёте AI-агента, важно не только генерировать умные ответы, но и дать агенту возможность выполнять действия. Здесь на помощь приходит Model Context Protocol (MCP). MCP упрощает доступ агентов к внешним инструментам и сервисам единообразным способом. Представьте, что вы подключаете агента к настоящему набору инструментов, который он действительно может использовать.

Допустим, вы подключаете агента к серверу MCP калькулятора. Вдруг ваш агент сможет выполнять математические операции, просто получая запрос вроде «Сколько будет 47 умножить на 89?» — без необходимости прописывать логику вручную или создавать специальные API.

## Обзор

В этом уроке рассказывается, как подключить сервер MCP калькулятора к агенту с помощью расширения [AI Toolkit](https://aka.ms/AIToolkit) в Visual Studio Code, чтобы ваш агент мог выполнять математические операции — сложение, вычитание, умножение и деление — используя естественный язык.

AI Toolkit — мощное расширение для Visual Studio Code, которое упрощает разработку агентов. AI-инженеры могут легко создавать AI-приложения, разрабатывая и тестируя генеративные модели AI — локально или в облаке. Расширение поддерживает большинство популярных генеративных моделей на сегодняшний день.

*Примечание*: AI Toolkit в настоящее время поддерживает Python и TypeScript.

## Цели обучения

К концу этого урока вы сможете:

- Использовать сервер MCP через AI Toolkit.
- Настроить конфигурацию агента для обнаружения и использования инструментов, предоставляемых сервером MCP.
- Использовать инструменты MCP через естественный язык.

## Подход

Вот общий план действий:

- Создать агента и определить его системный промпт.
- Создать сервер MCP с инструментами калькулятора.
- Подключить Agent Builder к серверу MCP.
- Проверить вызов инструментов агента через естественный язык.

Отлично, теперь, когда мы понимаем общий процесс, давайте настроим AI-агента для использования внешних инструментов через MCP, расширяя его возможности!

## Требования

- [Visual Studio Code](https://code.visualstudio.com/)
- [AI Toolkit для Visual Studio Code](https://aka.ms/AIToolkit)

## Упражнение: Использование сервера

В этом упражнении вы создадите, запустите и улучшите AI-агента с инструментами с сервера MCP внутри Visual Studio Code с помощью AI Toolkit.

### -0- Предварительный шаг: добавьте модель OpenAI GPT-4o в Мои модели

В упражнении используется модель **GPT-4o**. Перед созданием агента модель должна быть добавлена в раздел **Мои модели**.

![Скриншот интерфейса выбора модели в расширении AI Toolkit для Visual Studio Code. Заголовок гласит «Найдите подходящую модель для вашего AI-решения» с подзаголовком, призывающим открывать, тестировать и развёртывать AI-модели. Ниже, в разделе «Популярные модели», отображаются шесть карточек моделей: DeepSeek-R1 (размещена на GitHub), OpenAI GPT-4o, OpenAI GPT-4.1, OpenAI o1, Phi 4 Mini (CPU - маленькая, быстрая) и DeepSeek-R1 (размещена на Ollama). На каждой карточке есть кнопки «Добавить» и «Попробовать в песочнице».](../../../../translated_images/aitk-model-catalog.2acd38953bb9c119aa629fe74ef34cc56e4eed35e7f5acba7cd0a59e614ab335.ru.png)

1. Откройте расширение **AI Toolkit** через **Панель активности**.
2. В разделе **Каталог** выберите **Модели**, чтобы открыть **Каталог моделей**. При выборе **Модели** каталог откроется в новой вкладке редактора.
3. В строке поиска **Каталога моделей** введите **OpenAI GPT-4o**.
4. Нажмите **+ Добавить**, чтобы добавить модель в список **Мои модели**. Убедитесь, что выбрана модель, размещённая на **GitHub**.
5. В **Панели активности** проверьте, что модель **OpenAI GPT-4o** появилась в списке.

### -1- Создайте агента

**Agent (Prompt) Builder** позволяет создавать и настраивать собственных AI-агентов. В этом разделе вы создадите нового агента и назначите модель для ведения диалога.

![Скриншот интерфейса конструктора "Calculator Agent" в расширении AI Toolkit для Visual Studio Code. В левой панели выбрана модель "OpenAI GPT-4o (через GitHub)". Системный промпт гласит: "Вы профессор университета, преподающий математику", а пользовательский промпт: "Объясни мне уравнение Фурье простыми словами." Дополнительные опции включают кнопки для добавления инструментов, включения MCP Server и выбора структурированного вывода. Внизу синяя кнопка «Запустить». В правой панели под заголовком "Начать с примеров" перечислены три примерных агента: Веб-разработчик (с MCP Server, упрощателем для второго класса и толкователем снов, каждый с кратким описанием функций).](../../../../translated_images/aitk-agent-builder.901e3a2960c3e4774b29a23024ff5bec2d4232f57fae2a418b2aaae80f81c05f.ru.png)

1. Откройте расширение **AI Toolkit** через **Панель активности**.
2. В разделе **Инструменты** выберите **Agent (Prompt) Builder**. При выборе откроется новая вкладка редактора с конструктором агента.
3. Нажмите кнопку **+ Новый агент**. Расширение запустит мастер настройки через **Палитру команд**.
4. Введите имя **Calculator Agent** и нажмите **Enter**.
5. В **Agent (Prompt) Builder** в поле **Model** выберите модель **OpenAI GPT-4o (через GitHub)**.

### -2- Создайте системный промпт для агента

После создания каркаса агента пора определить его личность и назначение. В этом разделе вы воспользуетесь функцией **Generate system prompt**, чтобы описать поведение агента — в данном случае калькуляторного агента — и позволить модели сгенерировать системный промпт.

![Скриншот интерфейса "Calculator Agent" в AI Toolkit для Visual Studio Code с открытым модальным окном "Generate a prompt". В окне объясняется, что шаблон промпта можно сгенерировать, указав базовые данные, и показано текстовое поле с примером системного промпта: "Вы полезный и эффективный помощник по математике. При получении задачи с базовой арифметикой вы отвечаете правильным результатом." Ниже кнопки "Закрыть" и "Сгенерировать". На заднем плане видна часть конфигурации агента, включая выбранную модель "OpenAI GPT-4o (через GitHub)" и поля для системного и пользовательского промптов.](../../../../translated_images/aitk-generate-prompt.ba9e69d3d2bbe2a26444d0c78775540b14196061eee32c2054e9ee68c4f51f3a.ru.png)

1. В разделе **Prompts** нажмите кнопку **Generate system prompt**. Откроется конструктор промптов, который использует AI для генерации системного промпта.
2. В окне **Generate a prompt** введите следующее: `Вы полезный и эффективный помощник по математике. При получении задачи с базовой арифметикой вы отвечаете правильным результатом.`
3. Нажмите кнопку **Generate**. В правом нижнем углу появится уведомление о процессе генерации. После завершения промпт появится в поле **System prompt** в **Agent (Prompt) Builder**.
4. Проверьте системный промпт и при необходимости отредактируйте.

### -3- Создайте сервер MCP

Теперь, когда вы задали системный промпт агента — который направляет его поведение и ответы — пора наделить агента практическими возможностями. В этом разделе вы создадите сервер MCP калькулятора с инструментами для выполнения операций сложения, вычитания, умножения и деления. Этот сервер позволит агенту выполнять математические операции в реальном времени в ответ на запросы на естественном языке.

![Скриншот нижней части интерфейса Calculator Agent в расширении AI Toolkit для Visual Studio Code. Видны раскрывающиеся меню «Tools» и «Structure output», а также выпадающее меню «Choose output format», установленное в «text». Справа кнопка «+ MCP Server» для добавления сервера Model Context Protocol. Над разделом Tools показан значок-заглушка изображения.](../../../../translated_images/aitk-add-mcp-server.9742cfddfe808353c0caf9cc0a7ed3e80e13abf4d2ebde315c81c3cb02a2a449.ru.png)

AI Toolkit оснащён шаблонами, упрощающими создание собственного сервера MCP. Мы воспользуемся шаблоном на Python для создания сервера калькулятора MCP.

*Примечание*: AI Toolkit в настоящее время поддерживает Python и TypeScript.

1. В разделе **Tools** в **Agent (Prompt) Builder** нажмите кнопку **+ MCP Server**. Расширение запустит мастер настройки через **Палитру команд**.
2. Выберите **+ Add Server**.
3. Выберите **Create a New MCP Server**.
4. Выберите шаблон **python-weather**.
5. Выберите **Default folder** для сохранения шаблона сервера MCP.
6. Введите имя сервера: **Calculator**
7. Откроется новое окно Visual Studio Code. Подтвердите выбор, нажав **Yes, I trust the authors**.
8. В терминале (**Terminal** > **New Terminal**) создайте виртуальное окружение: `python -m venv .venv`
9. Активируйте виртуальное окружение:
    - Windows — `.venv\Scripts\activate`
    - macOS/Linux — `source venv/bin/activate`
10. Установите зависимости: `pip install -e .[dev]`
11. В обозревателе файлов (**Explorer**) в **Панели активности** разверните папку **src** и откройте файл **server.py**.
12. Замените содержимое файла **server.py** на следующий код и сохраните:

    ```python
    """
    Sample MCP Calculator Server implementation in Python.

    
    This module demonstrates how to create a simple MCP server with calculator tools
    that can perform basic arithmetic operations (add, subtract, multiply, divide).
    """
    
    from mcp.server.fastmcp import FastMCP
    
    server = FastMCP("calculator")
    
    @server.tool()
    def add(a: float, b: float) -> float:
        """Add two numbers together and return the result."""
        return a + b
    
    @server.tool()
    def subtract(a: float, b: float) -> float:
        """Subtract b from a and return the result."""
        return a - b
    
    @server.tool()
    def multiply(a: float, b: float) -> float:
        """Multiply two numbers together and return the result."""
        return a * b
    
    @server.tool()
    def divide(a: float, b: float) -> float:
        """
        Divide a by b and return the result.
        
        Raises:
            ValueError: If b is zero
        """
        if b == 0:
            raise ValueError("Cannot divide by zero")
        return a / b
    ```

### -4- Запустите агента с сервером MCP калькулятора

Теперь, когда у вашего агента есть инструменты, пора ими воспользоваться! В этом разделе вы отправите запросы агенту, чтобы проверить и убедиться, что агент использует нужный инструмент с сервера MCP калькулятора.

![Скриншот интерфейса Calculator Agent в расширении AI Toolkit для Visual Studio Code. В левой панели в разделе «Tools» добавлен MCP сервер с именем local-server-calculator_server, показывающий четыре доступных инструмента: add, subtract, multiply и divide. Значок показывает, что четыре инструмента активны. Ниже свернут раздел «Structure output» и синяя кнопка «Run». В правой панели в разделе «Model Response» агент вызывает инструменты multiply и subtract с входными данными {"a": 3, "b": 25} и {"a": 75, "b": 20} соответственно. В разделе «Tool Response» показан итоговый ответ 75.0. Внизу есть кнопка «View Code».](../../../../translated_images/aitk-agent-response-with-tools.e7c781869dc8041a25f9903ed4f7e8e0c7e13d7d94f6786a6c51b1e172f56866.ru.png)

Вы запустите сервер MCP калькулятора на локальной машине разработчика через **Agent Builder** в качестве клиента MCP.

1. Нажмите `F5`, чтобы запустить отладку сервера MCP. **Agent (Prompt) Builder** откроется в новой вкладке редактора. Статус сервера будет виден в терминале.
2. В поле **User prompt** в **Agent (Prompt) Builder** введите запрос: `Я купил 3 товара по $25 каждый, а затем использовал скидку $20. Сколько я заплатил?`
3. Нажмите кнопку **Run**, чтобы получить ответ агента.
4. Проверьте вывод агента. Модель должна определить, что вы заплатили **$55**.
5. Вот что должно произойти:
    - Агент выбирает инструменты **multiply** и **subtract** для вычислений.
    - Для инструмента **multiply** задаются значения `a` и `b`.
    - Для инструмента **subtract** задаются значения `a` и `b`.
    - Ответы каждого инструмента отображаются в разделе **Tool Response**.
    - Итоговый ответ модели отображается в разделе **Model Response**.
6. Отправляйте дополнительные запросы для дальнейшего тестирования агента. Вы можете изменить существующий запрос в поле **User prompt**, кликнув по нему и заменив текст.
7. По окончании тестирования остановите сервер в терминале, нажав **CTRL/CMD+C**.

## Задание

Попробуйте добавить новый инструмент в файл **server.py** (например, вычисление квадратного корня числа). Отправьте дополнительные запросы, которые потребуют от агента использовать ваш новый инструмент (или существующие). Не забудьте перезапустить сервер, чтобы загрузить новые инструменты.

## Решение

[Решение](./solution/README.md)

## Основные выводы

Главные выводы из этой главы:

- Расширение AI Toolkit — отличный клиент для работы с серверами MCP и их инструментами.
- Вы можете добавлять новые инструменты в серверы MCP, расширяя возможности агента под меняющиеся задачи.
- AI Toolkit включает шаблоны (например, шаблоны серверов MCP на Python), упрощающие создание собственных инструментов.

## Дополнительные ресурсы

- [Документация AI Toolkit](https://aka.ms/AIToolkit/doc)

## Что дальше
- Далее: [Тестирование и отладка](../08-testing/README.md)

**Отказ от ответственности**:  
Этот документ был переведен с помощью сервиса автоматического перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Несмотря на наши усилия по обеспечению точности, просим учитывать, что автоматический перевод может содержать ошибки или неточности. Оригинальный документ на его исходном языке следует считать авторитетным источником. Для получения критически важной информации рекомендуется обращаться к профессиональному переводу, выполненному человеком. Мы не несем ответственности за любые недоразумения или неправильные толкования, возникшие в результате использования данного перевода.