<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "154c00dc3b2c792102e4845c19fbd166",
  "translation_date": "2025-05-20T16:18:16+00:00",
  "source_file": "01-CoreConcepts/README.md",
  "language_code": "ja"
}
-->
# 📖 MCP Core Concepts: AI統合のためのModel Context Protocolのマスター

Model Context Protocol（MCP）は、大規模言語モデル（LLM）と外部ツール、アプリケーション、データソース間の通信を最適化する強力な標準化フレームワークです。このSEO最適化されたガイドでは、MCPのクライアント-サーバーアーキテクチャ、主要コンポーネント、通信メカニズム、実装のベストプラクティスを理解できるように解説します。

## 概要

このレッスンでは、Model Context Protocol（MCP）エコシステムを構成する基本的なアーキテクチャとコンポーネントについて学びます。クライアント-サーバーアーキテクチャ、主要コンポーネント、MCPの通信メカニズムについて理解を深めましょう。

## 👩‍🎓 主な学習目標

このレッスンを終えるまでに、あなたは以下を習得します：

- MCPのクライアント-サーバーアーキテクチャの理解
- Hosts、Clients、Serversの役割と責任の識別
- MCPが柔軟な統合レイヤーであるための主要機能の分析
- MCPエコシステム内での情報の流れの理解
- .NET、Java、Python、JavaScriptによる実践的なコード例の習得

## 🔎 MCPアーキテクチャ：詳細な解説

MCPエコシステムはクライアント-サーバーモデルに基づいて構築されています。このモジュラー構造により、AIアプリケーションはツール、データベース、API、コンテキストリソースと効率的に連携できます。アーキテクチャの主要コンポーネントを分解して見ていきましょう。

### 1. Hosts

Model Context Protocol（MCP）において、Hostsはユーザーがプロトコルとやり取りするための主要なインターフェースとして重要な役割を担います。HostsはMCPサーバーとの接続を開始し、データ、ツール、プロンプトへアクセスするアプリケーションや環境のことです。例としては、Visual Studio Codeのような統合開発環境（IDE）、Claude DesktopのようなAIツール、または特定のタスク向けにカスタム構築されたエージェントなどがあります。

**Hosts**はLLMアプリケーションであり、以下の役割を持ちます：

- AIモデルを実行または操作して応答を生成する
- MCPサーバーとの接続を開始する
- 会話の流れとユーザーインターフェースを管理する
- 権限とセキュリティ制約を制御する
- データ共有やツール実行に対するユーザーの同意を扱う

### 2. Clients

ClientsはHostsとMCPサーバー間のやり取りを円滑にする重要なコンポーネントです。Clientsは仲介者として機能し、HostsがMCPサーバーの提供する機能を利用できるようにします。MCPアーキテクチャ内でスムーズな通信と効率的なデータ交換を確保する役割を担います。

**Clients**はホストアプリケーション内のコネクタです。以下のことを行います：

- プロンプトや指示を含むリクエストをサーバーに送信する
- サーバーとの機能の交渉を行う
- モデルからのツール実行リクエストを管理する
- ユーザーへの応答を処理し表示する

### 3. Servers

ServersはMCPクライアントからのリクエストを処理し、適切な応答を提供する役割を担います。データ取得、ツール実行、プロンプト生成などのさまざまな操作を管理し、クライアントとHosts間の通信が効率的かつ信頼性の高いものになるようにします。やり取りの整合性も維持します。

**Servers**はコンテキストと機能を提供するサービスです。以下のことを行います：

- 利用可能な機能（リソース、プロンプト、ツール）を登録する
- クライアントからのツール呼び出しを受け取り実行する
- モデル応答を強化するためのコンテキスト情報を提供する
- 出力をクライアントに返す
- 必要に応じてやり取りの状態を維持する

Serversは誰でも開発可能で、専門的な機能を持つモデル拡張を提供できます。

### 4. Server Features

Model Context Protocol（MCP）のServersは、クライアント、ホスト、言語モデル間の豊かなやり取りを可能にする基本的な構成要素を提供します。これらの機能は、構造化されたコンテキスト、ツール、プロンプトを提供することでMCPの能力を強化するために設計されています。

MCPサーバーは以下の機能を提供できます：

#### 📑 Resources

Model Context Protocol（MCP）におけるResourcesは、ユーザーやAIモデルが利用できるさまざまな種類のコンテキストやデータを指します。具体的には：

- **コンテキストデータ**：ユーザーやAIモデルが意思決定やタスク実行に活用できる情報や状況
- **ナレッジベースやドキュメントリポジトリ**：記事、マニュアル、研究論文などの構造化・非構造化データのコレクションで、貴重な洞察や情報を提供
- **ローカルファイルやデータベース**：デバイス上やデータベース内に保存され、処理や分析に利用可能なデータ
- **APIやWebサービス**：外部のインターフェースやサービスで、追加データや機能を提供し、さまざまなオンラインリソースやツールと統合可能

リソースの例として、データベーススキーマやファイルが以下のようにアクセスされることがあります：

```text
file://log.txt
database://schema
```

### 🤖 Prompts

Model Context Protocol（MCP）におけるPromptsは、ユーザーのワークフローを効率化しコミュニケーションを向上させるためのさまざまな事前定義されたテンプレートや対話パターンを含みます。具体的には：

- **テンプレート化されたメッセージやワークフロー**：特定のタスクや対話を案内する事前構造化されたメッセージやプロセス
- **事前定義された対話パターン**：一貫性と効率的な通信を促進する標準化されたアクションと応答のシーケンス
- **専門的な会話テンプレート**：特定のタイプの会話に合わせてカスタマイズ可能なテンプレートで、関連性とコンテキスト適合性を確保

プロンプトテンプレートの例は以下の通りです：

```markdown
Generate a product slogan based on the following {{product}} with the following {{keywords}}
```

#### ⛏️ Tools

Model Context Protocol（MCP）におけるToolsは、AIモデルが特定のタスクを実行するために呼び出せる機能です。これらのツールは、構造化され信頼性の高い操作を提供することでAIモデルの能力を強化します。主な特徴は以下の通りです：

- **AIモデルが実行可能な関数**：ツールはAIモデルが呼び出してタスクを実行できる関数です
- **固有の名前と説明**：各ツールには目的や機能を説明する固有の名前と詳細な説明があります
- **パラメータと出力**：ツールは特定のパラメータを受け取り、構造化された出力を返すことで一貫性と予測可能性を確保します
- **個別の機能**：ウェブ検索、計算、データベースクエリなどの個別機能を実行します

ツールの例は以下のようになります：

```typescript
server.tool(
  "GetProducts",
  {
    pageSize: z.string().optional(),
    pageCount: z.string().optional()
  }, () => {
    // return results from API
  }
)
```

## Client Features

Model Context Protocol（MCP）において、クライアントはサーバーに対していくつかの重要な機能を提供し、プロトコル内の全体的な機能性と相互作用を向上させます。特に注目すべき機能の一つがSamplingです。

### 👉 Sampling

- **サーバー主導のエージェント的行動**：クライアントはサーバーが特定のアクションや行動を自律的に開始できるようにし、システムの動的能力を強化します
- **再帰的なLLMインタラクション**：この機能により、大規模言語モデル（LLM）との複雑で反復的な処理が可能になります
- **追加のモデル完了要求**：サーバーはモデルに追加の応答生成を要求でき、応答が十分かつ文脈に即したものになるようにします

## MCPにおける情報の流れ

Model Context Protocol（MCP）は、Hosts、Clients、Servers、モデル間の構造化された情報の流れを定義しています。この流れを理解することで、ユーザーリクエストがどのように処理され、外部ツールやデータがモデル応答に統合されるかが明確になります。

- **Hostが接続を開始**  
  IDEやチャットインターフェースなどのホストアプリケーションが、通常はSTDIO、WebSocket、または他のサポートされたトランスポート経由でMCPサーバーへの接続を確立します。

- **機能の交渉**  
  ホストに組み込まれたクライアントとサーバーが、サポートされている機能、ツール、リソース、プロトコルバージョンについて情報交換します。これにより双方がセッションで利用可能な機能を理解します。

- **ユーザーリクエスト**  
  ユーザーがホストと対話（例：プロンプトやコマンド入力）します。ホストはこの入力を収集し、処理のためにクライアントに渡します。

- **リソースまたはツールの利用**  
  - クライアントはモデルの理解を深めるために、サーバーから追加のコンテキストやリソース（ファイル、データベースエントリ、ナレッジベースの記事など）を要求することがあります。  
  - モデルがツールの使用を判断した場合（例：データ取得、計算、API呼び出しなど）、クライアントはツール名とパラメータを指定してサーバーにツール呼び出しリクエストを送信します。

- **サーバー実行**  
  サーバーはリソースまたはツールのリクエストを受け取り、必要な操作（関数の実行、データベースクエリ、ファイル取得など）を行い、結果を構造化された形式でクライアントに返します。

- **応答生成**  
  クライアントはサーバーの応答（リソースデータ、ツール出力など）を継続中のモデル対話に統合します。モデルはこれらの情報を用いて包括的かつ文脈に即した応答を生成します。

- **結果提示**  
  ホストはクライアントから最終出力を受け取り、ユーザーに提示します。通常はモデルが生成したテキストとツール実行やリソース参照の結果が含まれます。

この流れにより、MCPはモデルと外部ツールやデータソースをシームレスに接続し、高度で対話的かつコンテキスト認識型のAIアプリケーションをサポートします。

## プロトコルの詳細

MCP（Model Context Protocol）は[JSON-RPC 2.0](https://www.jsonrpc.org/)の上に構築されており、ホスト、クライアント、サーバー間の通信に標準化され言語非依存のメッセージ形式を提供します。この基盤により、多様なプラットフォームやプログラミング言語間で信頼性が高く構造化された拡張可能な相互作用が可能になります。

### 主要なプロトコル機能

MCPはJSON-RPC 2.0にツール呼び出し、リソースアクセス、プロンプト管理のための追加規約を拡張しています。複数のトランスポート層（STDIO、WebSocket、SSE）をサポートし、コンポーネント間で安全かつ拡張性のある言語非依存の通信を実現します。

#### 🧢 ベースプロトコル

- **JSON-RPCメッセージ形式**：すべてのリクエストとレスポンスはJSON-RPC 2.0仕様に準拠し、メソッド呼び出し、パラメータ、結果、エラー処理の一貫した構造を保証します
- **ステートフル接続**：MCPセッションは複数リクエストにまたがって状態を維持し、継続的な会話、コンテキストの蓄積、リソース管理をサポートします
- **機能の交渉**：接続設定時にクライアントとサーバーはサポート機能、プロトコルバージョン、利用可能なツールやリソースに関する情報を交換し、双方が相手の能力を理解し適応できるようにします

#### ➕ 追加ユーティリティ

以下はMCPが開発者体験を向上し高度なシナリオを可能にするために提供する追加のユーティリティとプロトコル拡張です：

- **設定オプション**：ツール権限、リソースアクセス、モデル設定などセッションパラメータを動的に構成可能で、各対話に最適化できます
- **進捗追跡**：長時間かかる処理は進捗更新を報告でき、複雑なタスク中の応答性の高いUIとユーザー体験を実現します
- **リクエストキャンセル**：クライアントは進行中のリクエストをキャンセル可能で、不要または遅延している操作を中断できます
- **エラー報告**：標準化されたエラーメッセージとコードにより問題の診断、失敗の優雅な処理、ユーザーや開発者への実用的なフィードバックを提供します
- **ログ記録**：クライアントとサーバーは監査、デバッグ、プロトコルの監視のために構造化ログを出力できます

これらのプロトコル機能を活用することで、MCPは言語モデルと外部ツールやデータソース間の堅牢で安全かつ柔軟な通信を保証します。

### 🔐 セキュリティ考慮事項

MCPの実装は、安全で信頼できるやり取りを確保するために以下の重要なセキュリティ原則に準拠する必要があります：

- **ユーザーの同意と制御**：データアクセスや操作実行の前にユーザーの明示的な同意が必要です。ユーザーはどのデータを共有し、どのアクションを許可するかを明確に制御できる必要があり、活動の確認・承認を行う直感的なUIが求められます。

- **データプライバシー**：ユーザーデータは明示的な同意がある場合のみ公開され、適切なアクセス制御によって保護されなければなりません。MCP実装は不正なデータ送信を防ぎ、すべてのやり取りでプライバシーを維持する必要があります。

- **ツールの安全性**：ツール呼び出し前には必ず明示的なユーザー同意が必要です。ユーザーは各ツールの機能を明確に理解し、不適切または危険なツール実行を防ぐために堅牢なセキュリティ境界が適用されなければなりません。

これらの原則を守ることで、MCPはプロトコルのすべてのやり取りにおいてユーザーの信頼、プライバシー、安全性を確保します。

## コード例：主要コンポーネント

以下は、主要なMCPサーバーコンポーネントとツールを実装する方法を示す、いくつかの主要なプログラミング言語によるコード例です。

### .NET例：ツールを備え

**免責事項**:  
本書類はAI翻訳サービス「Co-op Translator」（https://github.com/Azure/co-op-translator）を使用して翻訳されました。正確性の向上に努めておりますが、自動翻訳には誤りや不正確な箇所が含まれる可能性があることをご了承ください。原文の言語で記載された文書が正式な情報源となります。重要な情報については、専門の人間による翻訳を推奨いたします。本翻訳の利用により生じた誤解や誤訳について、当方は一切の責任を負いかねます。