<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "f00defb149ee1ac4a799e44a9783c7fc",
  "translation_date": "2025-06-06T18:07:47+00:00",
  "source_file": "01-CoreConcepts/README.md",
  "language_code": "ja"
}
-->
# 📖 MCPコアコンセプト：AI統合のためのModel Context Protocolの習得

Model Context Protocol（MCP）は、Large Language Models（LLM）と外部ツール、アプリケーション、データソース間の通信を最適化する強力で標準化されたフレームワークです。このSEO最適化されたガイドでは、MCPのクライアント-サーバーアーキテクチャ、主要コンポーネント、通信メカニズム、実装のベストプラクティスを理解できるように解説します。

## 概要

このレッスンでは、Model Context Protocol（MCP）エコシステムを構成する基本的なアーキテクチャとコンポーネントについて学びます。クライアント-サーバーアーキテクチャ、主要コンポーネント、MCPインタラクションを支える通信メカニズムについて理解を深めましょう。

## 👩‍🎓 主な学習目標

このレッスンの終了時には、以下ができるようになります：

- MCPのクライアント-サーバーアーキテクチャを理解する
- Hosts、Clients、Serversの役割と責任を特定する
- MCPが柔軟な統合レイヤーである核心的な特徴を分析する
- MCPエコシステム内での情報の流れを学ぶ
- .NET、Java、Python、JavaScriptによるコード例で実践的な知見を得る

## 🔎 MCPアーキテクチャ：詳細解説

MCPエコシステムはクライアント-サーバーモデルに基づいて構築されています。このモジュール構造により、AIアプリケーションはツール、データベース、API、コンテキストリソースと効率的に連携できます。ここでアーキテクチャの主要コンポーネントを分解して見ていきましょう。

### 1. Hosts

Model Context Protocol（MCP）におけるHostsは、ユーザーがプロトコルとやり取りするための主要なインターフェースとして重要な役割を果たします。HostsはMCPサーバーへの接続を開始し、データ、ツール、プロンプトにアクセスするアプリケーションや環境です。例としては、Visual Studio Codeのような統合開発環境（IDE）、Claude DesktopのようなAIツール、または特定のタスク向けに設計されたカスタムエージェントが挙げられます。

**Hosts**はLLMアプリケーションで、以下を行います：

- AIモデルを実行または操作して応答を生成する
- MCPサーバーとの接続を開始する
- 会話の流れとユーザーインターフェースを管理する
- 権限とセキュリティ制約を制御する
- データ共有やツール実行に対するユーザー同意を処理する

### 2. Clients

ClientsはHostsとMCPサーバー間のやり取りを円滑にする重要なコンポーネントです。Clientsは仲介役として機能し、HostsがMCPサーバーの機能を利用できるようにします。MCPアーキテクチャ内の通信をスムーズにし、効率的なデータ交換を支える重要な役割を果たします。

**Clients**はホストアプリケーション内のコネクタで、以下を行います：

- サーバーへプロンプトや指示を含むリクエストを送信する
- サーバーとの機能交渉を行う
- モデルからのツール実行リクエストを管理する
- ユーザーへの応答を処理・表示する

### 3. Servers

ServersはMCPクライアントからのリクエストを処理し、適切な応答を提供する役割を担います。データ取得、ツール実行、プロンプト生成などの操作を管理し、クライアントとHosts間の通信が効率的かつ信頼性高く行われるようにし、インタラクションの整合性を保ちます。

**Servers**はコンテキストと機能を提供するサービスで、以下を行います：

- 利用可能な機能（リソース、プロンプト、ツール）を登録する
- クライアントからのツール呼び出しを受け取り実行する
- モデルの応答を強化するためのコンテキスト情報を提供する
- 出力をクライアントに返す
- 必要に応じてインタラクション間の状態を維持する

Serversは専門的な機能を持つモデル能力の拡張として誰でも開発可能です。

### 4. Server Features

Model Context Protocol（MCP）のServersは、クライアント、ホスト、言語モデル間の豊かなインタラクションを可能にする基本的な構成要素を提供します。これらの機能は、構造化されたコンテキスト、ツール、プロンプトを提供することでMCPの能力を高めるよう設計されています。

MCPサーバーが提供できる主な機能は以下の通りです：

#### 📑 Resources

Model Context Protocol（MCP）におけるResourcesは、ユーザーやAIモデルが利用できるさまざまな種類のコンテキストやデータを含みます。具体的には：

- **コンテキストデータ**：ユーザーやAIモデルが意思決定やタスク実行に活用できる情報や文脈
- **ナレッジベースやドキュメントリポジトリ**：記事、マニュアル、研究論文などの構造化・非構造化データのコレクションで、価値ある知見を提供
- **ローカルファイルやデータベース**：デバイスやデータベースにローカル保存されたデータで、処理や分析にアクセス可能
- **APIやウェブサービス**：追加のデータや機能を提供する外部インターフェースやサービスで、多様なオンラインリソースやツールとの統合を可能にする

リソースの例として、以下のようなデータベーススキーマやファイルにアクセスすることが挙げられます：

```text
file://log.txt
database://schema
```

### 🤖 Prompts

Model Context Protocol（MCP）におけるPromptsは、ユーザーのワークフローを効率化し、コミュニケーションを強化するために設計された様々な事前定義テンプレートやインタラクションパターンを含みます。具体的には：

- **テンプレート化されたメッセージやワークフロー**：特定のタスクやインタラクションを案内する事前構築されたメッセージやプロセス
- **事前定義されたインタラクションパターン**：一貫性と効率的なコミュニケーションを促進する標準化された行動と応答のシーケンス
- **特化型会話テンプレート**：特定の会話タイプに合わせてカスタマイズ可能なテンプレートで、関連性の高い文脈適合的なやり取りを保証

プロンプトテンプレートの例は以下の通りです：

```markdown
Generate a product slogan based on the following {{product}} with the following {{keywords}}
```

#### ⛏️ Tools

Model Context Protocol（MCP）におけるToolsは、AIモデルが特定のタスクを実行するために呼び出せる関数です。これらのツールは、構造化され信頼性の高い操作を提供することでAIモデルの能力を拡張します。主なポイントは：

- **AIモデルが実行可能な関数**：ツールはAIモデルが呼び出して様々なタスクを実行できる関数
- **固有の名前と説明**：それぞれのツールには目的や機能を説明する明確な名前と詳細な説明が付与される
- **パラメーターと出力**：特定のパラメーターを受け取り、構造化された出力を返すことで一貫性と予測可能性を確保
- **個別機能**：ウェブ検索、計算、データベースクエリなどの明確に区別された機能を実行

ツールの例は以下のようになります：

```typescript
server.tool(
  "GetProducts",
  {
    pageSize: z.string().optional(),
    pageCount: z.string().optional()
  }, () => {
    // return results from API
  }
)
```

## Client Features

Model Context Protocol（MCP）において、クライアントはサーバーに対していくつかの重要な機能を提供し、プロトコル内の全体的な機能性とインタラクションを強化します。注目すべき機能の一つがSamplingです。

### 👉 Sampling

- **サーバー主導のエージェンシービヘイビア**：クライアントはサーバーが特定の行動や動作を自律的に開始できるようにし、システムの動的能力を向上させる
- **再帰的なLLMインタラクション**：大規模言語モデル（LLM）との再帰的なやり取りを可能にし、より複雑で反復的なタスク処理を実現
- **追加のモデル完了要求**：サーバーはモデルに追加の応答を要求でき、応答が十分で文脈に適したものとなるようにする

## MCPにおける情報の流れ

Model Context Protocol（MCP）は、Hosts、Clients、Servers、モデル間の情報の構造化された流れを定義しています。この流れを理解することで、ユーザーのリクエストがどのように処理され、外部ツールやデータがモデルの応答に統合されるかが明確になります。

- **Hostが接続を開始**  
  IDEやチャットインターフェースなどのホストアプリケーションが、通常STDIO、WebSocket、または他のサポートされているトランスポートを介してMCPサーバーへの接続を確立します。

- **機能交渉**  
  ホストに組み込まれたクライアントとサーバーが、サポートされている機能、ツール、リソース、プロトコルバージョンについて情報を交換します。これにより、双方がセッションで利用可能な機能を把握します。

- **ユーザーリクエスト**  
  ユーザーがホストとやり取りし（例：プロンプトやコマンドを入力）、ホストはこの入力をクライアントに渡して処理します。

- **リソースまたはツールの利用**  
  - クライアントは、モデルの理解を深めるためにサーバーから追加のコンテキストやリソース（ファイル、データベースのエントリ、ナレッジベース記事など）を要求することがあります。  
  - モデルがツールの使用を必要と判断した場合（例：データ取得、計算、API呼び出し）、クライアントはツール名とパラメーターを指定してサーバーにツール呼び出しリクエストを送信します。

- **サーバーの実行**  
  サーバーはリソースやツールのリクエストを受け取り、必要な操作（関数の実行、データベースクエリ、ファイル取得など）を行い、結果を構造化された形式でクライアントに返します。

- **応答生成**  
  クライアントはサーバーの応答（リソースデータ、ツール出力など）をモデルとの対話に統合します。モデルはこれらの情報を使って包括的で文脈に即した応答を生成します。

- **結果提示**  
  ホストはクライアントから最終出力を受け取り、ユーザーに提示します。通常、モデル生成テキストとツール実行やリソース参照の結果が含まれます。

この流れにより、MCPはモデルと外部ツール・データソースをシームレスに結び付け、高度でインタラクティブな文脈認識型AIアプリケーションをサポートします。

## プロトコルの詳細

MCP（Model Context Protocol）は[JSON-RPC 2.0](https://www.jsonrpc.org/)の上に構築されており、Hosts、Clients、Servers間の通信に標準化され言語非依存のメッセージフォーマットを提供します。この基盤により、多様なプラットフォームやプログラミング言語間で信頼性が高く構造化され拡張可能なインタラクションが可能です。

### 主なプロトコル機能

MCPはJSON-RPC 2.0を拡張し、ツール呼び出し、リソースアクセス、プロンプト管理のための追加規約を提供します。複数のトランスポート層（STDIO、WebSocket、SSE）をサポートし、セキュアで拡張性が高く言語非依存の通信を実現します。

#### 🧢 基本プロトコル

- **JSON-RPCメッセージフォーマット**：すべてのリクエストとレスポンスはJSON-RPC 2.0仕様に従い、メソッド呼び出し、パラメーター、結果、エラー処理の一貫した構造を保証
- **ステートフル接続**：MCPセッションは複数リクエスト間で状態を維持し、継続的な会話、コンテキスト蓄積、リソース管理をサポート
- **機能交渉**：接続確立時にクライアントとサーバーがサポートする機能、プロトコルバージョン、利用可能なツールやリソースについて情報交換し、双方の能力を理解し適応

#### ➕ 追加ユーティリティ

以下はMCPが提供する追加ユーティリティとプロトコル拡張で、開発者体験を向上し高度なシナリオを可能にします：

- **設定オプション**：ツール権限、リソースアクセス、モデル設定など、セッションパラメーターを動的に構成可能で、各インタラクションに最適化
- **進捗追跡**：長時間実行される操作は進捗更新を報告でき、複雑なタスク中のユーザーインターフェースの応答性とユーザー体験を向上
- **リクエストキャンセル**：クライアントは進行中のリクエストをキャンセル可能で、不要または長時間かかる操作を中断可能
- **エラー報告**：標準化されたエラーメッセージとコードにより問題の診断、失敗時の適切な処理、ユーザーや開発者への実用的なフィードバックを提供
- **ログ記録**：クライアントとサーバーは監査、デバッグ、プロトコルインタラクションのモニタリングのために構造化ログを出力可能

これらのプロトコル機能を活用することで、MCPは言語モデルと外部ツールやデータソース間の堅牢で安全かつ柔軟な通信を実現します。

### 🔐 セキュリティ考慮事項

MCP実装は安全で信頼できるインタラクションを保証するため、以下の重要なセキュリティ原則に従うべきです：

- **ユーザーの同意と制御**：データアクセスや操作実行前にユーザーの明示的な同意を得ること。共有データや許可されたアクションをユーザーが明確に管理できるよう、レビュー・承認用の直感的なユーザーインターフェースを提供すること。

- **データプライバシー**：ユーザーデータは明示的な同意がある場合のみ開示し、適切なアクセス制御で保護すること。MCP実装は不正なデータ送信を防止し、すべてのインタラクションでプライバシーが維持されるようにすること。

- **ツールの安全性**：ツールを呼び出す前に必ずユーザーの明示的な同意を得ること。ユーザーは各ツールの機能を明確に理解できるようにし、不意または安全でないツール実行を防ぐために堅牢なセキュリティ境界を設けること。

これらの原則を守ることで、MCPはユーザーの信頼、プライバシー、安全性をすべてのプロトコルインタラクションで維持します。

## コード例：主要コンポーネント

以下は、主要なMCPサーバーコンポーネントとツールの実装例を示す人気プログラミング言語でのコード

**免責事項**：  
本書類はAI翻訳サービス[Co-op Translator](https://github.com/Azure/co-op-translator)を使用して翻訳されました。正確性を期しておりますが、自動翻訳には誤りや不正確な部分が含まれる可能性があります。原文のネイティブ言語による文書が正式な情報源とみなされるべきです。重要な情報については、専門の人間による翻訳を推奨します。本翻訳の使用に起因するいかなる誤解や誤訳についても、当方は一切の責任を負いかねます。