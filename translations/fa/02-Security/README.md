<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "382fddb4ee4d9c1bdc806e2ee99b70c8",
  "translation_date": "2025-07-16T22:29:51+00:00",
  "source_file": "02-Security/README.md",
  "language_code": "fa"
}
-->
# بهترین شیوه‌های امنیتی

پذیرش پروتکل مدل کانتکست (MCP) قابلیت‌های قدرتمندی را به برنامه‌های مبتنی بر هوش مصنوعی می‌آورد، اما چالش‌های امنیتی منحصر به فردی را نیز ایجاد می‌کند که فراتر از ریسک‌های سنتی نرم‌افزاری است. علاوه بر نگرانی‌های شناخته‌شده‌ای مانند کدنویسی امن، حداقل امتیاز دسترسی و امنیت زنجیره تأمین، MCP و بارهای کاری هوش مصنوعی با تهدیدات جدیدی مانند تزریق پرامپت، مسمومیت ابزار، تغییر دینامیک ابزار، ربودن نشست، حملات نماینده گیج‌شده و آسیب‌پذیری‌های عبور توکن مواجه هستند. این ریسک‌ها در صورت مدیریت نادرست می‌توانند منجر به استخراج داده‌ها، نقض حریم خصوصی و رفتارهای ناخواسته سیستم شوند.

این درس به بررسی مهم‌ترین ریسک‌های امنیتی مرتبط با MCP می‌پردازد — از جمله احراز هویت، مجوزدهی، دسترسی‌های بیش از حد، تزریق پرامپت غیرمستقیم، امنیت نشست، مشکلات نماینده گیج‌شده، آسیب‌پذیری‌های عبور توکن و آسیب‌پذیری‌های زنجیره تأمین — و کنترل‌ها و بهترین شیوه‌های عملی برای کاهش آن‌ها را ارائه می‌دهد. همچنین خواهید آموخت چگونه از راهکارهای مایکروسافت مانند Prompt Shields، Azure Content Safety و GitHub Advanced Security برای تقویت پیاده‌سازی MCP خود بهره ببرید. با درک و به‌کارگیری این کنترل‌ها، می‌توانید احتمال رخداد نقض امنیتی را به طور قابل توجهی کاهش داده و اطمینان حاصل کنید که سیستم‌های هوش مصنوعی شما مقاوم و قابل اعتماد باقی می‌مانند.

# اهداف یادگیری

تا پایان این درس، قادر خواهید بود:

- ریسک‌های امنیتی منحصر به فردی که پروتکل مدل کانتکست (MCP) ایجاد می‌کند را شناسایی و توضیح دهید، از جمله تزریق پرامپت، مسمومیت ابزار، دسترسی‌های بیش از حد، ربودن نشست، مشکلات نماینده گیج‌شده، آسیب‌پذیری‌های عبور توکن و آسیب‌پذیری‌های زنجیره تأمین.
- کنترل‌های مؤثر کاهش‌دهنده ریسک‌های امنیتی MCP را شرح داده و به کار ببرید، مانند احراز هویت قوی، حداقل امتیاز دسترسی، مدیریت امن توکن، کنترل‌های امنیت نشست و تأیید زنجیره تأمین.
- راهکارهای مایکروسافت مانند Prompt Shields، Azure Content Safety و GitHub Advanced Security را برای محافظت از MCP و بارهای کاری هوش مصنوعی درک و به کار ببرید.
- اهمیت اعتبارسنجی متادیتای ابزار، نظارت بر تغییرات دینامیک، دفاع در برابر حملات تزریق پرامپت غیرمستقیم و جلوگیری از ربودن نشست را بشناسید.
- بهترین شیوه‌های امنیتی تثبیت‌شده مانند کدنویسی امن، سخت‌سازی سرور و معماری اعتماد صفر را در پیاده‌سازی MCP خود ادغام کنید تا احتمال و تأثیر نقض‌های امنیتی کاهش یابد.

# کنترل‌های امنیتی MCP

هر سیستمی که به منابع مهم دسترسی دارد، چالش‌های امنیتی ضمنی دارد. این چالش‌ها معمولاً از طریق به‌کارگیری صحیح کنترل‌ها و مفاهیم بنیادی امنیتی قابل حل هستند. از آنجا که MCP تازه تعریف شده است، مشخصات آن به سرعت در حال تغییر و تکامل است. در نهایت، کنترل‌های امنیتی درون آن بالغ خواهند شد و امکان ادغام بهتر با معماری‌ها و بهترین شیوه‌های امنیتی سازمانی فراهم می‌شود.

تحقیقات منتشر شده در [گزارش دفاع دیجیتال مایکروسافت](https://aka.ms/mddr) نشان می‌دهد که ۹۸٪ از نقض‌های گزارش‌شده با رعایت بهداشت امنیتی قوی قابل پیشگیری بوده‌اند و بهترین محافظت در برابر هر نوع نقض، داشتن بهداشت امنیتی پایه، بهترین شیوه‌های کدنویسی امن و امنیت زنجیره تأمین است — آن روش‌های آزموده‌شده که هنوز بیشترین تأثیر را در کاهش ریسک امنیتی دارند.

بیایید نگاهی به برخی از راه‌هایی بیندازیم که می‌توانید هنگام پذیرش MCP برای مقابله با ریسک‌های امنیتی شروع کنید.

> **Note:** اطلاعات زیر تا تاریخ **۲۹ مه ۲۰۲۵** صحیح است. پروتکل MCP به طور مداوم در حال تکامل است و پیاده‌سازی‌های آینده ممکن است الگوها و کنترل‌های جدید احراز هویت را معرفی کنند. برای آخرین به‌روزرسانی‌ها و راهنمایی‌ها، همیشه به [مشخصات MCP](https://spec.modelcontextprotocol.io/) و مخزن رسمی [MCP در گیت‌هاب](https://github.com/modelcontextprotocol) و [صفحه بهترین شیوه‌های امنیتی](https://modelcontextprotocol.io/specification/draft/basic/security_best_practices) مراجعه کنید.

### بیان مسئله  
مشخصات اصلی MCP فرض می‌کرد که توسعه‌دهندگان سرور احراز هویت خود را می‌نویسند. این نیازمند دانش OAuth و محدودیت‌های امنیتی مرتبط بود. سرورهای MCP به عنوان سرورهای مجوزدهی OAuth 2.0 عمل می‌کردند و احراز هویت کاربران را مستقیماً مدیریت می‌کردند، به جای واگذاری آن به سرویس خارجی مانند Microsoft Entra ID. از تاریخ **۲۶ آوریل ۲۰۲۵**، به‌روزرسانی مشخصات MCP اجازه می‌دهد سرورهای MCP احراز هویت کاربران را به سرویس خارجی واگذار کنند.

### ریسک‌ها
- منطق مجوزدهی نادرست در سرور MCP می‌تواند منجر به افشای داده‌های حساس و اعمال نادرست کنترل‌های دسترسی شود.
- سرقت توکن OAuth در سرور محلی MCP. در صورت سرقت، توکن می‌تواند برای جعل هویت سرور MCP و دسترسی به منابع و داده‌های سرویس مربوط به توکن OAuth استفاده شود.

#### عبور توکن
عبور توکن به صراحت در مشخصات مجوزدهی ممنوع است زیرا ریسک‌های امنیتی متعددی ایجاد می‌کند، از جمله:

#### دور زدن کنترل‌های امنیتی
سرور MCP یا APIهای پایین‌دستی ممکن است کنترل‌های امنیتی مهمی مانند محدودیت نرخ، اعتبارسنجی درخواست یا نظارت بر ترافیک را پیاده‌سازی کنند که به مخاطب توکن یا محدودیت‌های دیگر اعتبارنامه وابسته‌اند. اگر کلاینت‌ها بتوانند توکن‌ها را مستقیماً با APIهای پایین‌دستی بدون اعتبارسنجی صحیح سرور MCP یا اطمینان از صدور توکن برای سرویس درست استفاده کنند، این کنترل‌ها دور زده می‌شوند.

#### مشکلات مسئولیت‌پذیری و ردگیری
سرور MCP قادر به شناسایی یا تمایز بین کلاینت‌های MCP نخواهد بود وقتی کلاینت‌ها با توکن دسترسی صادرشده از بالا تماس می‌گیرند که ممکن است برای سرور MCP نامشخص باشد.  
لاگ‌های سرور منبع پایین‌دستی ممکن است درخواست‌هایی را نشان دهند که به نظر می‌رسد از منبع یا هویت متفاوتی آمده‌اند، نه از سرور MCP که در واقع توکن‌ها را منتقل می‌کند.  
هر دو عامل بررسی حادثه، کنترل‌ها و حسابرسی را دشوارتر می‌کنند.  
اگر سرور MCP توکن‌ها را بدون اعتبارسنجی ادعاهای آن‌ها (مانند نقش‌ها، امتیازات یا مخاطب) یا متادیتای دیگر منتقل کند، بازیگر مخرب در اختیار داشتن توکن سرقت‌شده می‌تواند از سرور به عنوان پروکسی برای استخراج داده‌ها استفاده کند.

#### مشکلات مرز اعتماد
سرور منبع پایین‌دستی به نهادهای خاصی اعتماد می‌کند. این اعتماد ممکن است شامل فرضیات درباره منشأ یا الگوهای رفتار کلاینت باشد. شکستن این مرز اعتماد می‌تواند به مشکلات غیرمنتظره منجر شود.  
اگر توکن بدون اعتبارسنجی مناسب توسط چندین سرویس پذیرفته شود، مهاجم با نفوذ به یک سرویس می‌تواند از توکن برای دسترسی به سایر سرویس‌های متصل استفاده کند.

#### ریسک سازگاری آینده
حتی اگر سرور MCP امروز به عنوان «پروکسی خالص» شروع کند، ممکن است بعداً نیاز به افزودن کنترل‌های امنیتی داشته باشد. شروع با جداسازی صحیح مخاطب توکن، مدل امنیتی را برای توسعه آسان‌تر می‌کند.

### کنترل‌های کاهش‌دهنده

**سرورهای MCP نباید هیچ توکنی را بپذیرند که به صراحت برای سرور MCP صادر نشده باشد**

- **بازبینی و سخت‌سازی منطق مجوزدهی:** پیاده‌سازی مجوزدهی سرور MCP خود را با دقت بررسی کنید تا اطمینان حاصل شود که فقط کاربران و کلاینت‌های مورد نظر به منابع حساس دسترسی دارند. برای راهنمایی عملی، به [Azure API Management Your Auth Gateway For MCP Servers | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) و [Using Microsoft Entra ID To Authenticate With MCP Servers Via Sessions - Den Delimarsky](https://den.dev/blog/mcp-server-auth-entra-id-session/) مراجعه کنید.
- **اجرای شیوه‌های امن توکن:** از [بهترین شیوه‌های مایکروسافت برای اعتبارسنجی و طول عمر توکن](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens) پیروی کنید تا از سوءاستفاده از توکن‌های دسترسی جلوگیری کرده و ریسک تکرار یا سرقت توکن را کاهش دهید.
- **حفاظت از ذخیره‌سازی توکن:** همیشه توکن‌ها را به صورت امن ذخیره کرده و از رمزنگاری برای محافظت از آن‌ها در حالت استراحت و انتقال استفاده کنید. برای نکات پیاده‌سازی، به [استفاده از ذخیره‌سازی امن توکن و رمزنگاری توکن‌ها](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2) مراجعه کنید.

# دسترسی‌های بیش از حد برای سرورهای MCP

### بیان مسئله  
ممکن است به سرورهای MCP دسترسی‌های بیش از حد به سرویس یا منبعی که به آن دسترسی دارند داده شده باشد. به عنوان مثال، سرور MCP که بخشی از یک برنامه فروش مبتنی بر هوش مصنوعی است و به یک مخزن داده سازمانی متصل می‌شود، باید دسترسی محدود به داده‌های فروش داشته باشد و اجازه دسترسی به همه فایل‌های مخزن را نداشته باشد. با بازگشت به اصل حداقل امتیاز دسترسی (یکی از قدیمی‌ترین اصول امنیتی)، هیچ منبعی نباید دسترسی بیش از حد مورد نیاز برای انجام وظایف خود داشته باشد. هوش مصنوعی در این زمینه چالش بیشتری ایجاد می‌کند زیرا برای انعطاف‌پذیری آن، تعریف دقیق دسترسی‌های لازم دشوار است.

### ریسک‌ها  
- اعطای دسترسی‌های بیش از حد می‌تواند اجازه استخراج یا تغییر داده‌هایی را بدهد که سرور MCP نباید به آن‌ها دسترسی داشته باشد. این همچنین می‌تواند مسئله حریم خصوصی باشد اگر داده‌ها اطلاعات شناسایی شخصی (PII) باشند.

### کنترل‌های کاهش‌دهنده  
- **اجرای اصل حداقل امتیاز دسترسی:** فقط حداقل دسترسی‌های لازم برای انجام وظایف مورد نیاز به سرور MCP اعطا کنید. این دسترسی‌ها را به طور منظم بازبینی و به‌روزرسانی کنید تا مطمئن شوید بیش از حد نیاز نیستند. برای راهنمایی دقیق‌تر، به [Secure least-privileged access](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access) مراجعه کنید.
- **استفاده از کنترل دسترسی مبتنی بر نقش (RBAC):** نقش‌هایی به سرور MCP اختصاص دهید که به منابع و عملیات خاص محدود شده‌اند و از دسترسی‌های گسترده یا غیرضروری اجتناب کنید.
- **نظارت و حسابرسی دسترسی‌ها:** استفاده از دسترسی‌ها را به طور مداوم نظارت کرده و لاگ‌های دسترسی را برای شناسایی و اصلاح سریع امتیازات بیش از حد یا بلااستفاده بررسی کنید.

# حملات تزریق پرامپت غیرمستقیم

### بیان مسئله

سرورهای MCP مخرب یا به خطر افتاده می‌توانند ریسک‌های قابل توجهی ایجاد کنند، از جمله افشای داده‌های مشتری یا فعال‌سازی اقدامات ناخواسته. این ریسک‌ها به ویژه در بارهای کاری مبتنی بر هوش مصنوعی و MCP اهمیت دارند، جایی که:

- **حملات تزریق پرامپت:** مهاجمان دستورالعمل‌های مخرب را در پرامپت‌ها یا محتوای خارجی جاسازی می‌کنند که باعث می‌شود سیستم هوش مصنوعی اقدامات ناخواسته انجام دهد یا داده‌های حساس را افشا کند. اطلاعات بیشتر: [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- **مسمومیت ابزار:** مهاجمان متادیتای ابزار (مانند توضیحات یا پارامترها) را دستکاری می‌کنند تا رفتار هوش مصنوعی را تحت تأثیر قرار دهند، که ممکن است کنترل‌های امنیتی را دور زده یا داده‌ها را استخراج کند. جزئیات: [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- **تزریق پرامپت بین دامنه‌ای:** دستورالعمل‌های مخرب در اسناد، صفحات وب یا ایمیل‌ها جاسازی می‌شوند که سپس توسط هوش مصنوعی پردازش شده و منجر به نشت یا دستکاری داده‌ها می‌شود.
- **تغییر دینامیک ابزار (Rug Pulls):** تعاریف ابزار می‌توانند پس از تأیید کاربر تغییر کنند و رفتارهای مخرب جدیدی بدون اطلاع کاربر ایجاد کنند.

این آسیب‌پذیری‌ها نیاز به اعتبارسنجی قوی، نظارت و کنترل‌های امنیتی هنگام ادغام سرورهای MCP و ابزارها در محیط شما را برجسته می‌کنند. برای بررسی عمیق‌تر، به مراجع لینک‌شده بالا مراجعه کنید.

![prompt-injection-lg-2048x1034](../../../translated_images/prompt-injection.ed9fbfde297ca877c15bc6daa808681cd3c3dc7bf27bbbda342ef1ba5fc4f52d.fa.png)

**تزریق پرامپت غیرمستقیم** (که به آن تزریق پرامپت بین دامنه‌ای یا XPIA نیز گفته می‌شود) یک آسیب‌پذیری حیاتی در سیستم‌های هوش مصنوعی مولد، از جمله آن‌هایی که از پروتکل مدل کانتکست (MCP) استفاده می‌کنند، است. در این حمله، دستورالعمل‌های مخرب در محتوای خارجی مانند اسناد، صفحات وب یا ایمیل‌ها پنهان می‌شوند. وقتی سیستم هوش مصنوعی این محتوا را پردازش می‌کند، ممکن است این دستورالعمل‌های جاسازی‌شده را به عنوان دستورات معتبر کاربر تفسیر کند که منجر به اقدامات ناخواسته‌ای مانند نشت داده، تولید محتوای مضر یا دستکاری تعاملات کاربر می‌شود. برای توضیح دقیق‌تر و مثال‌های واقعی، به [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/) مراجعه کنید.

شکل بسیار خطرناک این حمله، **مسمومیت ابزار** است. در این حالت، مهاجمان دستورالعمل‌های مخرب را در متادیتای ابزارهای MCP (مانند توضیحات یا پارامترهای ابزار) تزریق می‌کنند. از آنجا که مدل‌های زبانی بزرگ (LLMها) برای تصمیم‌گیری درباره ابزارهایی که باید فراخوانی شوند به این متادیتا تکیه می‌کنند، توضیحات به خطر افتاده می‌توانند مدل را فریب دهند تا فراخوانی‌های غیرمجاز ابزار را اجرا کند یا کنترل‌های امنیتی را دور بزند. این دستکاری‌ها اغلب برای کاربران نهایی نامرئی هستند اما توسط سیستم هوش مصنوعی تفسیر و اجرا می‌شوند. این ریسک در محیط‌های میزبانی شده سرور MCP که تعاریف ابزار پس از تأیید کاربر قابل به‌روزرسانی هستند — وضعیتی که گاهی به آن «rug pull» گفته می‌شود — افزایش می‌یابد. در چنین مواردی، ابزاری که قبلاً ایمن بود ممکن است بعداً برای انجام اقدامات مخرب مانند استخراج داده یا تغییر رفتار سیستم بدون اطلاع کاربر تغییر کند. برای اطلاعات بیشتر درباره این بردار حمله، به [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks) مراجعه کنید.

![tool-injection-lg-2048x1239 (1)](../../../translated_images/tool-injection.3b0b4a6b24de6befe7d3afdeae44138ef005881aebcfc84c6f61369ce31e3640.fa.png)

## ریسک‌ها  
اقدامات ناخواسته هوش مصنوعی ریسک‌های امنیتی متنوعی از جمله استخراج داده و نقض حریم خصوصی ایجاد می‌کند.

### کنترل‌های کاهش‌دهنده  
### استفاده از Prompt Shields برای محافظت در برابر حملات تزریق پرامپت غیرمستقیم
-----------------------------------------------------------------------------

**AI Prompt Shields** راهکاری است که توسط مایکروسافت برای دفاع در برابر حملات تزریق پرامپت مستقیم و غیرمستقیم توسعه یافته است. این راهکارها از طریق موارد زیر کمک می‌کنند:

1.  **شناسایی و فیلتر کردن:** Prompt Shields با استفاده از الگوریتم‌های پیشرفته یادگیری ماشین و پردازش زبان طبیعی، دستورالعمل‌های مخرب جاسازی‌شده در محتوای خارجی مانند اسناد، صفحات وب یا ایمیل‌ها را شناسایی و فیلتر می‌کنند.
    
2.  **Spotlighting:** این تکنیک به سیستم هوش مصنوعی کمک می‌کند تا بین دستورالعمل‌های معتبر سیستم و ورودی‌های خارجی بالقوه غیرقابل اعتماد تمایز قائل شود. با تبدیل متن ورودی به شکلی که برای مدل مرتبط‌تر باشد، Spotlighting اطمینان می‌دهد که هوش مصنوعی بهتر می‌تواند دستورالعمل‌های مخرب را شناسایی و نادیده بگیرد.
    
3.  **مرزگذاری و علامت‌گذاری داده‌ها:** درج مرزها در پیام سیستم به طور صریح محل متن ورودی را مشخص می‌کند و به سیستم هوش مصنوعی کمک می‌کند ورودی‌های کاربر را از محتوای خارجی بالقوه مضر جدا کند. علامت‌گذاری داده‌ها این مفهوم را با استفاده از نشانگرهای ویژه برای برجسته کردن مرزهای داده‌های
مسئله نماینده گیج‌ شده یک آسیب‌پذیری امنیتی است که زمانی رخ می‌دهد که یک سرور MCP به عنوان واسطه بین کلاینت‌های MCP و APIهای شخص ثالث عمل کند. این آسیب‌پذیری زمانی قابل سوءاستفاده است که سرور MCP از یک شناسه کلاینت ثابت برای احراز هویت با سرور مجوزدهی شخص ثالث استفاده کند که از ثبت کلاینت پویا پشتیبانی نمی‌کند.

### ریسک‌ها

- **دور زدن رضایت مبتنی بر کوکی**: اگر کاربر قبلاً از طریق سرور پروکسی MCP احراز هویت شده باشد، سرور مجوزدهی شخص ثالث ممکن است یک کوکی رضایت در مرورگر کاربر تنظیم کند. مهاجم می‌تواند بعداً با ارسال یک لینک مخرب حاوی درخواست مجوز ساختگی با URI بازگشت مخرب، از این موضوع سوءاستفاده کند.
- **سرقت کد مجوز**: وقتی کاربر روی لینک مخرب کلیک می‌کند، سرور مجوزدهی شخص ثالث ممکن است به دلیل وجود کوکی، صفحه رضایت را رد کند و کد مجوز به سرور مهاجم هدایت شود.
- **دسترسی غیرمجاز به API**: مهاجم می‌تواند کد مجوز سرقت شده را با توکن‌های دسترسی تعویض کند و به جای کاربر به API شخص ثالث دسترسی پیدا کند بدون اینکه اجازه صریحی داشته باشد.

### کنترل‌های کاهش‌دهنده

- **الزامات رضایت صریح**: سرورهای پروکسی MCP که از شناسه‌های کلاینت ثابت استفاده می‌کنند **باید** برای هر کلاینت ثبت شده پویا، رضایت کاربر را قبل از ارسال به سرورهای مجوزدهی شخص ثالث دریافت کنند.
- **پیاده‌سازی صحیح OAuth**: بهترین شیوه‌های امنیتی OAuth 2.1 را دنبال کنید، از جمله استفاده از چالش‌های کد (PKCE) برای درخواست‌های مجوز به منظور جلوگیری از حملات رهگیری.
- **اعتبارسنجی کلاینت**: اعتبارسنجی دقیق URIهای بازگشت و شناسه‌های کلاینت را پیاده‌سازی کنید تا از سوءاستفاده توسط بازیگران مخرب جلوگیری شود.


# آسیب‌پذیری‌های عبور توکن

### بیان مسئله

"عبور توکن" یک الگوی ضد است که در آن سرور MCP توکن‌ها را از کلاینت MCP بدون اعتبارسنجی اینکه توکن‌ها به درستی برای خود سرور MCP صادر شده‌اند، می‌پذیرد و سپس آن‌ها را به APIهای پایین‌دستی منتقل می‌کند. این روش به صراحت مشخصات مجوزدهی MCP را نقض می‌کند و ریسک‌های امنیتی جدی ایجاد می‌کند.

### ریسک‌ها

- **دور زدن کنترل‌های امنیتی**: کلاینت‌ها می‌توانند کنترل‌های امنیتی مهم مانند محدودیت نرخ، اعتبارسنجی درخواست یا نظارت بر ترافیک را دور بزنند اگر بتوانند توکن‌ها را مستقیماً با APIهای پایین‌دستی بدون اعتبارسنجی مناسب استفاده کنند.
- **مشکلات پاسخگویی و ردگیری**: سرور MCP قادر نخواهد بود کلاینت‌های MCP را هنگام استفاده از توکن‌های صادر شده از بالا تشخیص دهد یا تمایز قائل شود که بررسی حوادث و حسابرسی را دشوار می‌کند.
- **خروج غیرمجاز داده‌ها**: اگر توکن‌ها بدون اعتبارسنجی ادعاها منتقل شوند، یک بازیگر مخرب با توکن سرقت شده می‌تواند از سرور به عنوان واسطه برای خروج داده‌ها استفاده کند.
- **نقض مرز اعتماد**: سرورهای منابع پایین‌دستی ممکن است به نهادهای خاصی اعتماد کنند با فرضیات درباره منشأ یا الگوهای رفتاری. شکستن این مرز اعتماد می‌تواند به مشکلات امنیتی غیرمنتظره منجر شود.
- **سوءاستفاده از توکن چندسرویسی**: اگر توکن‌ها توسط چندین سرویس بدون اعتبارسنجی مناسب پذیرفته شوند، مهاجم با نفوذ به یک سرویس می‌تواند از توکن برای دسترسی به سایر سرویس‌های متصل استفاده کند.

### کنترل‌های کاهش‌دهنده

- **اعتبارسنجی توکن**: سرورهای MCP **نباید** هیچ توکنی را بپذیرند که به صراحت برای خود سرور MCP صادر نشده باشد.
- **تأیید مخاطب**: همیشه بررسی کنید که توکن‌ها ادعای مخاطب صحیحی داشته باشند که با هویت سرور MCP مطابقت دارد.
- **مدیریت چرخه عمر توکن مناسب**: توکن‌های دسترسی کوتاه‌مدت و شیوه‌های چرخش توکن مناسب را پیاده‌سازی کنید تا ریسک سرقت و سوءاستفاده کاهش یابد.


# ربودن نشست

### بیان مسئله

ربودن نشست یک بردار حمله است که در آن یک کلاینت یک شناسه نشست از سرور دریافت می‌کند و یک طرف غیرمجاز همان شناسه نشست را به دست می‌آورد و استفاده می‌کند تا به جای کلاینت اصلی عمل کند و اقدامات غیرمجاز انجام دهد. این موضوع به ویژه در سرورهای HTTP حالت‌دار که درخواست‌های MCP را مدیریت می‌کنند نگران‌کننده است.

### ریسک‌ها

- **تزریق درخواست ربودن نشست**: مهاجمی که شناسه نشست را به دست آورده می‌تواند رویدادهای مخرب به سروری ارسال کند که وضعیت نشست را با سروری که کلاینت به آن متصل است به اشتراک می‌گذارد، که ممکن است باعث اقدامات مضر یا دسترسی به داده‌های حساس شود.
- **تقلید ربودن نشست**: مهاجمی با شناسه نشست سرقت شده می‌تواند مستقیماً به سرور MCP تماس بگیرد، احراز هویت را دور بزند و به عنوان کاربر قانونی شناخته شود.
- **جریان‌های قابل ادامه آسیب‌دیده**: وقتی سرور از تحویل مجدد یا جریان‌های قابل ادامه پشتیبانی می‌کند، مهاجم می‌تواند درخواست را زودتر خاتمه دهد که باعث می‌شود بعداً توسط کلاینت اصلی با محتوای احتمالا مخرب ادامه یابد.

### کنترل‌های کاهش‌دهنده

- **تأیید مجوز**: سرورهای MCP که مجوزدهی را پیاده‌سازی می‌کنند **باید** تمام درخواست‌های ورودی را تأیید کنند و **نباید** از نشست‌ها برای احراز هویت استفاده کنند.
- **شناسه‌های نشست امن**: سرورهای MCP **باید** از شناسه‌های نشست امن و غیرقابل پیش‌بینی که با تولیدکننده اعداد تصادفی امن ساخته شده‌اند استفاده کنند. از شناسه‌های قابل پیش‌بینی یا ترتیبی اجتناب کنید.
- **بستن نشست به کاربر خاص**: سرورهای MCP **باید** شناسه‌های نشست را به اطلاعات خاص کاربر متصل کنند، به طوری که شناسه نشست با اطلاعات منحصر به فرد کاربر مجاز (مانند شناسه داخلی کاربر) ترکیب شود، مثلاً به فرم `
<user_id>:<session_id>`.
- **انقضای نشست**: انقضای مناسب نشست و چرخش آن را پیاده‌سازی کنید تا پنجره آسیب‌پذیری در صورت به خطر افتادن شناسه نشست محدود شود.
- **امنیت انتقال**: همیشه از HTTPS برای تمام ارتباطات استفاده کنید تا از رهگیری شناسه نشست جلوگیری شود.


# امنیت زنجیره تأمین

امنیت زنجیره تأمین در عصر هوش مصنوعی همچنان بنیادی است، اما دامنه آنچه به عنوان زنجیره تأمین شما محسوب می‌شود گسترش یافته است. علاوه بر بسته‌های کد سنتی، اکنون باید تمام اجزای مرتبط با هوش مصنوعی را به دقت بررسی و نظارت کنید، از جمله مدل‌های پایه، خدمات تعبیه، ارائه‌دهندگان زمینه و APIهای شخص ثالث. هر یک از این‌ها می‌توانند در صورت مدیریت نادرست، آسیب‌پذیری یا ریسک ایجاد کنند.

**شیوه‌های کلیدی امنیت زنجیره تأمین برای هوش مصنوعی و MCP:**
- **بررسی همه اجزا قبل از ادغام:** این شامل نه تنها کتابخانه‌های متن‌باز، بلکه مدل‌های هوش مصنوعی، منابع داده و APIهای خارجی است. همیشه اصالت، مجوز و آسیب‌پذیری‌های شناخته شده را بررسی کنید.
- **حفظ خطوط تولید امن:** از خطوط تولید CI/CD خودکار با اسکن امنیتی یکپارچه استفاده کنید تا مشکلات را زود شناسایی کنید. اطمینان حاصل کنید که فقط مصنوعات مورد اعتماد به تولید ارسال می‌شوند.
- **نظارت و حسابرسی مداوم:** نظارت مستمر بر تمام وابستگی‌ها، از جمله مدل‌ها و خدمات داده، برای شناسایی آسیب‌پذیری‌ها یا حملات زنجیره تأمین جدید پیاده‌سازی کنید.
- **اعمال حداقل امتیاز و کنترل‌های دسترسی:** دسترسی به مدل‌ها، داده‌ها و خدمات را فقط به آنچه برای عملکرد سرور MCP لازم است محدود کنید.
- **پاسخ سریع به تهدیدات:** فرآیندی برای وصله‌کردن یا جایگزینی اجزای به خطر افتاده و چرخش اسرار یا مدارک در صورت شناسایی نفوذ داشته باشید.

[GitHub Advanced Security](https://github.com/security/advanced-security) امکاناتی مانند اسکن اسرار، اسکن وابستگی‌ها و تحلیل CodeQL را ارائه می‌دهد. این ابزارها با [Azure DevOps](https://azure.microsoft.com/en-us/products/devops) و [Azure Repos](https://azure.microsoft.com/en-us/products/devops/repos/) ادغام می‌شوند تا به تیم‌ها در شناسایی و کاهش آسیب‌پذیری‌ها در کد و اجزای زنجیره تأمین هوش مصنوعی کمک کنند.

مایکروسافت همچنین شیوه‌های گسترده امنیت زنجیره تأمین را به صورت داخلی برای همه محصولات پیاده‌سازی می‌کند. برای اطلاعات بیشتر به [The Journey to Secure the Software Supply Chain at Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/) مراجعه کنید.


# بهترین شیوه‌های امنیتی تثبیت شده که وضعیت امنیتی پیاده‌سازی MCP شما را ارتقا می‌دهند

هر پیاده‌سازی MCP وضعیت امنیتی موجود محیط سازمان شما را که بر اساس آن ساخته شده به ارث می‌برد، بنابراین هنگام بررسی امنیت MCP به عنوان بخشی از سیستم‌های کلی هوش مصنوعی، توصیه می‌شود وضعیت امنیتی کلی موجود خود را ارتقا دهید. کنترل‌های امنیتی تثبیت شده زیر به ویژه مرتبط هستند:

- بهترین شیوه‌های کدنویسی امن در برنامه هوش مصنوعی شما - محافظت در برابر [ده مورد برتر OWASP](https://owasp.org/www-project-top-ten/)، [ده مورد برتر OWASP برای LLMها](https://genai.owasp.org/download/43299/?tmstv=1731900559)، استفاده از خزانه‌های امن برای اسرار و توکن‌ها، پیاده‌سازی ارتباطات امن انتها به انتها بین تمام اجزای برنامه و غیره.
- سخت‌سازی سرور -- استفاده از MFA در صورت امکان، به‌روزرسانی مداوم وصله‌ها، ادغام سرور با ارائه‌دهنده هویت شخص ثالث برای دسترسی و غیره.
- به‌روزرسانی دستگاه‌ها، زیرساخت و برنامه‌ها با وصله‌ها
- نظارت امنیتی -- پیاده‌سازی ثبت و نظارت بر برنامه هوش مصنوعی (شامل کلاینت/سرور MCP) و ارسال آن‌ها به یک SIEM مرکزی برای شناسایی فعالیت‌های غیرعادی
- معماری اعتماد صفر -- جداسازی اجزا از طریق کنترل‌های شبکه و هویت به صورت منطقی برای کاهش حرکت جانبی در صورت به خطر افتادن برنامه هوش مصنوعی.

# نکات کلیدی

- اصول امنیتی همچنان حیاتی هستند: کدنویسی امن، حداقل امتیاز، بررسی زنجیره تأمین و نظارت مداوم برای بارهای کاری MCP و هوش مصنوعی ضروری‌اند.
- MCP ریسک‌های جدیدی معرفی می‌کند—مانند تزریق درخواست، مسمومیت ابزار، ربودن نشست، مسئله نماینده گیج شده، آسیب‌پذیری‌های عبور توکن و مجوزهای بیش از حد—که نیازمند کنترل‌های سنتی و خاص هوش مصنوعی هستند.
- از شیوه‌های قوی احراز هویت، مجوزدهی و مدیریت توکن استفاده کنید و در صورت امکان از ارائه‌دهندگان هویت خارجی مانند Microsoft Entra ID بهره ببرید.
- در برابر تزریق غیرمستقیم درخواست و مسمومیت ابزار با اعتبارسنجی متادیتای ابزار، نظارت بر تغییرات پویا و استفاده از راه‌حل‌هایی مانند Microsoft Prompt Shields محافظت کنید.
- مدیریت نشست امن را با استفاده از شناسه‌های نشست غیرقابل پیش‌بینی، اتصال نشست‌ها به هویت کاربران و هرگز استفاده نکردن از نشست‌ها برای احراز هویت پیاده‌سازی کنید.
- از حملات نماینده گیج شده با درخواست رضایت صریح کاربر برای هر کلاینت ثبت شده پویا و پیاده‌سازی شیوه‌های امنیتی صحیح OAuth جلوگیری کنید.
- از آسیب‌پذیری‌های عبور توکن با اطمینان از اینکه سرورهای MCP فقط توکن‌هایی را می‌پذیرند که به صراحت برای آن‌ها صادر شده‌اند و اعتبارسنجی مناسب ادعاهای توکن جلوگیری کنید.
- همه اجزا در زنجیره تأمین هوش مصنوعی خود—شامل مدل‌ها، تعبیه‌ها و ارائه‌دهندگان زمینه—را با همان دقت وابستگی‌های کد مدیریت کنید.
- با مشخصات MCP در حال تحول همراه باشید و در جامعه مشارکت کنید تا به شکل‌گیری استانداردهای امن کمک کنید.

# منابع اضافی

## منابع خارجی
- [Microsoft Digital Defense Report](https://aka.ms/mddr)
- [MCP Specification](https://spec.modelcontextprotocol.io/)
- [MCP Security Best Practices](https://modelcontextprotocol.io/specification/draft/basic/security_best_practices)
- [MCP Authorization Specification](https://modelcontextprotocol.io/specification/draft/basic/authorization)
- [OAuth 2.0 Security Best Practices (RFC 9700)](https://datatracker.ietf.org/doc/html/rfc9700)
- [Prompt Injection in MCP (Simon Willison)](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- [Tool Poisoning Attacks (Invariant Labs)](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- [Rug Pulls in MCP (Wiz Security)](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)
- [Prompt Shields Documentation (Microsoft)](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [OWASP Top 10 for LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559)
- [GitHub Advanced Security](https://github.com/security/advanced-security)
- [Azure DevOps](https://azure.microsoft.com/products/devops)
- [Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [The Journey to Secure the Software Supply Chain at Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)
- [Secure Least-Privileged Access (Microsoft)](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [Best Practices for Token Validation and Lifetime](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [Use Secure Token Storage and Encrypt Tokens (YouTube)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)
- [Azure API Management as Auth Gateway for MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [Using Microsoft Entra ID to Authenticate with MCP Servers](https://den.dev/blog/mcp-server-auth-entra-id-session/)

## اسناد امنیتی اضافی

برای راهنمایی‌های امنیتی دقیق‌تر، لطفاً به این اسناد مراجعه کنید:

- [MCP Security Best Practices 2025](./mcp-security-best-practices-2025.md) - فهرست جامع بهترین شیوه‌های امنیتی برای پیاده‌سازی‌های MCP
- [Azure Content Safety Implementation](./azure-content-safety-implementation.md) - نمونه‌های پیاده‌سازی برای ادغام Azure Content Safety با سرورهای MCP
- [MCP Security Controls 2025](./mcp-security-controls-2025.md) - جدیدترین کنترل‌ها و تکنیک‌های امنیتی برای ایمن‌سازی استقرارهای MCP
- [MCP Best Practices](./mcp-best-practices.md) - راهنمای مرجع سریع برای امنیت MCP

### بعدی

بعدی: [فصل ۳: شروع کار](../03-GettingStarted/README.md)

**سلب مسئولیت**:  
این سند با استفاده از سرویس ترجمه هوش مصنوعی [Co-op Translator](https://github.com/Azure/co-op-translator) ترجمه شده است. در حالی که ما در تلاش برای دقت هستیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است حاوی خطاها یا نواقصی باشند. سند اصلی به زبان بومی خود باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حیاتی، ترجمه حرفه‌ای انسانی توصیه می‌شود. ما مسئول هیچ گونه سوءتفاهم یا تفسیر نادرستی که از استفاده این ترجمه ناشی شود، نیستیم.