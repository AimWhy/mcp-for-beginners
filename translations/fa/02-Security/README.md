<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "98be664d3b19a81ee24fa3f920233864",
  "translation_date": "2025-05-20T22:51:56+00:00",
  "source_file": "02-Security/README.md",
  "language_code": "fa"
}
-->
# بهترین روش‌های امنیتی

پذیرش پروتکل مدل کانتکست (MCP) قابلیت‌های قدرتمندی را به برنامه‌های مبتنی بر هوش مصنوعی می‌آورد، اما چالش‌های امنیتی منحصر به فردی را نیز ایجاد می‌کند که فراتر از ریسک‌های نرم‌افزاری سنتی است. علاوه بر نگرانی‌های شناخته شده مانند کدنویسی امن، حداقل امتیازات دسترسی، و امنیت زنجیره تامین، MCP و بارهای کاری هوش مصنوعی با تهدیدات جدیدی مثل تزریق پرامپت، مسمومیت ابزار و تغییرات دینامیک ابزار مواجه هستند. اگر این خطرات به درستی مدیریت نشوند، می‌توانند منجر به استخراج داده‌ها، نقض حریم خصوصی و رفتارهای ناخواسته سیستم شوند.

این درس به بررسی مهم‌ترین ریسک‌های امنیتی مرتبط با MCP می‌پردازد — از جمله احراز هویت، مجوزدهی، امتیازات بیش از حد، تزریق پرامپت غیرمستقیم و آسیب‌پذیری‌های زنجیره تامین — و کنترل‌ها و بهترین روش‌های عملی برای کاهش آن‌ها را ارائه می‌دهد. همچنین یاد می‌گیرید چگونه از راهکارهای مایکروسافت مانند Prompt Shields، Azure Content Safety و GitHub Advanced Security برای تقویت پیاده‌سازی MCP خود بهره ببرید. با درک و به‌کارگیری این کنترل‌ها، می‌توانید احتمال نفوذ امنیتی را به‌طور قابل توجهی کاهش داده و اطمینان حاصل کنید که سیستم‌های هوش مصنوعی شما مقاوم و قابل اعتماد باقی می‌مانند.

# اهداف یادگیری

تا پایان این درس، قادر خواهید بود:

- ریسک‌های امنیتی منحصر به فردی که توسط پروتکل مدل کانتکست (MCP) معرفی شده‌اند، از جمله تزریق پرامپت، مسمومیت ابزار، امتیازات بیش از حد و آسیب‌پذیری‌های زنجیره تامین را شناسایی و توضیح دهید.
- کنترل‌های موثر کاهش‌دهنده ریسک‌های امنیتی MCP را توصیف و به کار ببرید، مانند احراز هویت قوی، حداقل امتیازات دسترسی، مدیریت امن توکن‌ها و تایید زنجیره تامین.
- راهکارهای مایکروسافت مانند Prompt Shields، Azure Content Safety و GitHub Advanced Security را برای حفاظت از MCP و بارهای کاری هوش مصنوعی بشناسید و استفاده کنید.
- اهمیت اعتبارسنجی متادیتای ابزار، پایش تغییرات دینامیک و دفاع در برابر حملات تزریق پرامپت غیرمستقیم را درک کنید.
- بهترین روش‌های امنیتی تثبیت شده مانند کدنویسی امن، سخت‌سازی سرور و معماری اعتماد صفر را در پیاده‌سازی MCP خود ادغام کنید تا احتمال و تاثیر نفوذهای امنیتی را کاهش دهید.

# کنترل‌های امنیتی MCP

هر سیستمی که به منابع مهم دسترسی دارد، چالش‌های امنیتی ضمنی دارد. این چالش‌ها معمولاً از طریق اعمال صحیح کنترل‌ها و مفاهیم پایه امنیتی قابل مدیریت هستند. از آنجا که MCP تازه تعریف شده است، مشخصات آن به سرعت در حال تغییر و تکامل است. در نهایت، کنترل‌های امنیتی درون آن تکامل یافته و امکان ادغام بهتر با معماری‌ها و بهترین روش‌های امنیتی سازمانی را فراهم می‌کنند.

تحقیقات منتشر شده در [Microsoft Digital Defense Report](https://aka.ms/mddr) نشان می‌دهد که ۹۸٪ از نفوذهای گزارش شده با رعایت بهداشت امنیتی قوی قابل پیشگیری هستند و بهترین حفاظت در برابر هر نوع نفوذ، داشتن بهداشت امنیتی پایه، بهترین روش‌های کدنویسی امن و امنیت زنجیره تامین است — همان روش‌های آزمایش شده و شناخته شده که همچنان بیشترین تاثیر را در کاهش ریسک امنیتی دارند.

بیایید نگاهی بیندازیم به برخی از راه‌هایی که می‌توانید هنگام پذیرش MCP ریسک‌های امنیتی را مدیریت کنید.

# احراز هویت سرور MCP (اگر پیاده‌سازی MCP شما قبل از ۲۶ آوریل ۲۰۲۵ بود)

> **Note:** اطلاعات زیر تا تاریخ ۲۶ آوریل ۲۰۲۵ صحیح است. پروتکل MCP به طور مداوم در حال توسعه است و پیاده‌سازی‌های آینده ممکن است الگوها و کنترل‌های جدید احراز هویت را معرفی کنند. برای آخرین به‌روزرسانی‌ها و راهنمایی‌ها همیشه به [MCP Specification](https://spec.modelcontextprotocol.io/) و مخزن رسمی [MCP GitHub](https://github.com/modelcontextprotocol) مراجعه کنید.

### بیان مسئله  
مشخصات اولیه MCP فرض می‌کرد که توسعه‌دهندگان سرور احراز هویت خود را می‌نویسند. این نیازمند دانش OAuth و محدودیت‌های امنیتی مرتبط بود. سرورهای MCP به عنوان سرورهای احراز هویت OAuth 2.0 عمل می‌کردند و مدیریت احراز هویت کاربران را به طور مستقیم انجام می‌دادند، نه اینکه آن را به سرویس خارجی مانند Microsoft Entra ID واگذار کنند. از ۲۶ آوریل ۲۰۲۵، به‌روزرسانی مشخصات MCP اجازه می‌دهد سرورهای MCP احراز هویت کاربران را به سرویس خارجی واگذار کنند.

### ریسک‌ها  
- منطق مجوزدهی نادرست در سرور MCP می‌تواند منجر به افشای داده‌های حساس و اعمال نادرست کنترل‌های دسترسی شود.  
- سرقت توکن OAuth در سرور محلی MCP. اگر توکن دزدیده شود، می‌توان از آن برای جعل هویت سرور MCP و دسترسی به منابع و داده‌های سرویس مربوط به توکن استفاده کرد.

### کنترل‌های کاهش‌دهنده  
- **بازبینی و سخت‌سازی منطق مجوزدهی:** پیاده‌سازی مجوزدهی سرور MCP خود را به دقت بررسی کنید تا مطمئن شوید فقط کاربران و کلاینت‌های مورد نظر به منابع حساس دسترسی دارند. برای راهنمایی عملی، به [Azure API Management Your Auth Gateway For MCP Servers | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) و [Using Microsoft Entra ID To Authenticate With MCP Servers Via Sessions - Den Delimarsky](https://den.dev/blog/mcp-server-auth-entra-id-session/) مراجعه کنید.  
- **اجرای شیوه‌های امن مدیریت توکن:** از [بهترین روش‌های مایکروسافت برای اعتبارسنجی و طول عمر توکن](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens) پیروی کنید تا سوء استفاده از توکن‌های دسترسی جلوگیری و ریسک بازپخش یا سرقت توکن کاهش یابد.  
- **حفاظت از ذخیره‌سازی توکن:** همیشه توکن‌ها را به صورت امن ذخیره کرده و از رمزنگاری برای محافظت در حالت استراحت و انتقال استفاده کنید. برای نکات پیاده‌سازی، به [Use secure token storage and encrypt tokens](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2) مراجعه کنید.

# امتیازات بیش از حد برای سرورهای MCP

### بیان مسئله  
ممکن است به سرورهای MCP امتیازات بیش از حد برای سرویس یا منبعی که به آن دسترسی دارند داده شده باشد. به عنوان مثال، سرور MCP که بخشی از یک برنامه فروش هوش مصنوعی است و به یک مخزن داده سازمانی متصل می‌شود، باید فقط به داده‌های فروش دسترسی داشته باشد و اجازه دسترسی به همه فایل‌های مخزن را نداشته باشد. با مراجعه به اصل حداقل امتیاز (یکی از قدیمی‌ترین اصول امنیتی)، هیچ منبعی نباید امتیازاتی بیش از آنچه برای انجام وظایف مورد نظر لازم است داشته باشد. هوش مصنوعی چالش بیشتری در این زمینه ایجاد می‌کند زیرا برای انعطاف‌پذیری آن، تعریف دقیق امتیازات لازم می‌تواند دشوار باشد.

### ریسک‌ها  
- اعطای امتیازات بیش از حد می‌تواند اجازه استخراج یا تغییر داده‌هایی را بدهد که سرور MCP قرار نبوده به آن‌ها دسترسی داشته باشد. این موضوع همچنین می‌تواند مشکل حریم خصوصی باشد اگر داده‌ها اطلاعات شخصی قابل شناسایی (PII) باشند.

### کنترل‌های کاهش‌دهنده  
- **اعمال اصل حداقل امتیاز:** فقط حداقل امتیازات لازم برای انجام وظایف مورد نیاز را به سرور MCP بدهید. این امتیازات را به طور منظم بازبینی و به‌روزرسانی کنید تا مطمئن شوید از حد لازم فراتر نمی‌روند. برای راهنمایی دقیق‌تر، به [Secure least-privileged access](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access) مراجعه کنید.  
- **استفاده از کنترل دسترسی مبتنی بر نقش (RBAC):** نقش‌هایی را به سرور MCP اختصاص دهید که محدود به منابع و اقدامات خاص باشد و از اعطای امتیازات گسترده یا غیرضروری خودداری کنید.  
- **پایش و حسابرسی امتیازات:** استفاده از امتیازات را به طور مداوم پایش کرده و لاگ‌های دسترسی را برای شناسایی و اصلاح سریع امتیازات بیش از حد یا بلااستفاده بررسی کنید.

# حملات تزریق پرامپت غیرمستقیم

### بیان مسئله

سرورهای MCP مخرب یا آسیب‌دیده می‌توانند با افشای داده‌های مشتری یا فعال‌سازی اقدامات ناخواسته خطرات قابل توجهی ایجاد کنند. این خطرات به ویژه در بارهای کاری مبتنی بر هوش مصنوعی و MCP مهم هستند، جایی که:

- **حملات تزریق پرامپت:** مهاجمان دستورالعمل‌های مخرب را در پرامپت‌ها یا محتوای خارجی جاسازی می‌کنند و باعث می‌شوند سیستم هوش مصنوعی اقدامات ناخواسته انجام دهد یا داده‌های حساس را فاش کند. برای اطلاعات بیشتر: [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)  
- **مسمومیت ابزار:** مهاجمان متادیتای ابزار (مانند توضیحات یا پارامترها) را دستکاری می‌کنند تا رفتار هوش مصنوعی را تحت تاثیر قرار دهند، که می‌تواند کنترل‌های امنیتی را دور زده یا داده‌ها را استخراج کند. جزئیات: [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)  
- **تزریق پرامپت بین دامنه‌ای:** دستورالعمل‌های مخرب در اسناد، صفحات وب یا ایمیل‌ها جاسازی می‌شوند و سپس توسط هوش مصنوعی پردازش می‌شوند که منجر به افشای داده یا دستکاری می‌شود.  
- **تغییر دینامیک ابزار (Rug Pulls):** تعریف ابزارها پس از تایید کاربر تغییر می‌کند و رفتارهای مخرب جدید بدون آگاهی کاربر معرفی می‌شود.

این آسیب‌پذیری‌ها نیاز به اعتبارسنجی قوی، پایش و کنترل‌های امنیتی هنگام ادغام سرورهای MCP و ابزارها در محیط شما را نشان می‌دهند. برای بررسی عمیق‌تر، به منابع مرتبط مراجعه کنید.

![prompt-injection-lg-2048x1034](../../../translated_images/prompt-injection.ed9fbfde297ca877c15bc6daa808681cd3c3dc7bf27bbbda342ef1ba5fc4f52d.fa.png)

**تزریق پرامپت غیرمستقیم** (که به عنوان تزریق پرامپت بین دامنه‌ای یا XPIA نیز شناخته می‌شود) یک آسیب‌پذیری حیاتی در سیستم‌های هوش مصنوعی مولد، از جمله آن‌هایی که از پروتکل مدل کانتکست (MCP) استفاده می‌کنند، است. در این حمله، دستورالعمل‌های مخرب در محتوای خارجی — مانند اسناد، صفحات وب یا ایمیل‌ها — پنهان می‌شوند. وقتی سیستم هوش مصنوعی این محتوا را پردازش می‌کند، ممکن است دستورالعمل‌های جاسازی شده را به عنوان دستورات معتبر کاربر تفسیر کند و منجر به اقدامات ناخواسته‌ای مانند افشای داده، تولید محتوای مضر یا دستکاری تعاملات کاربر شود. برای توضیح مفصل و مثال‌های واقعی، به [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/) مراجعه کنید.

یک شکل بسیار خطرناک از این حمله، **مسمومیت ابزار** است. در اینجا، مهاجمان دستورالعمل‌های مخرب را در متادیتای ابزارهای MCP (مانند توضیحات یا پارامترهای ابزار) تزریق می‌کنند. از آنجا که مدل‌های زبان بزرگ (LLM) برای تصمیم‌گیری در مورد اینکه کدام ابزارها را فراخوانی کنند، به این متادیتا تکیه دارند، توضیحات آسیب‌دیده می‌تواند مدل را فریب دهد تا فراخوانی‌های غیرمجاز ابزار را انجام دهد یا کنترل‌های امنیتی را دور بزند. این دستکاری‌ها اغلب برای کاربران نهایی نامرئی است اما توسط سیستم هوش مصنوعی تفسیر و اجرا می‌شود. این ریسک در محیط‌های میزبانی شده سرور MCP که تعاریف ابزار می‌توانند پس از تایید کاربر به‌روزرسانی شوند — که گاهی به آن «rug pull» گفته می‌شود — تشدید می‌شود. در چنین مواردی، ابزاری که قبلاً امن بود ممکن است بعداً برای انجام اقدامات مخرب، مانند استخراج داده یا تغییر رفتار سیستم، بدون اطلاع کاربر تغییر کند. برای اطلاعات بیشتر در مورد این بردار حمله، به [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks) مراجعه کنید.

![tool-injection-lg-2048x1239 (1)](../../../translated_images/tool-injection.3b0b4a6b24de6befe7d3afdeae44138ef005881aebcfc84c6f61369ce31e3640.fa.png)

## ریسک‌ها  
اقدامات ناخواسته هوش مصنوعی انواع مختلفی از ریسک‌های امنیتی از جمله استخراج داده و نقض حریم خصوصی را ایجاد می‌کند.

### کنترل‌های کاهش‌دهنده  
### استفاده از Prompt Shields برای محافظت در برابر حملات تزریق پرامپت غیرمستقیم  
-----------------------------------------------------------------------------

**AI Prompt Shields** راهکاری است که توسط مایکروسافت برای دفاع در برابر حملات تزریق پرامپت مستقیم و غیرمستقیم توسعه یافته است. این راهکار از طریق موارد زیر کمک می‌کند:

1.  **شناسایی و فیلتر کردن:** Prompt Shields از الگوریتم‌های پیشرفته یادگیری ماشین و پردازش زبان طبیعی برای شناسایی و فیلتر کردن دستورالعمل‌های مخرب جاسازی شده در محتوای خارجی مانند اسناد، صفحات وب یا ایمیل‌ها استفاده می‌کند.  
2.  **تکنیک Spotlighting:** این روش به سیستم هوش مصنوعی کمک می‌کند تا بین دستورالعمل‌های معتبر سیستم و ورودی‌های خارجی بالقوه غیرقابل اعتماد تمایز قائل شود. با تبدیل متن ورودی به شکلی که برای مدل مرتبط‌تر باشد، Spotlighting اطمینان می‌دهد که هوش مصنوعی می‌تواند دستورالعمل‌های مخرب را بهتر شناسایی و نادیده بگیرد.  
3.  **جداکننده‌ها و نشانه‌گذاری داده:** استفاده از جداکننده‌ها در پیام سیستم به وضوح مکان متن ورودی را مشخص می‌کند و به سیستم هوش مصنوعی کمک می‌کند ورودی‌های کاربر را از محتوای خارجی بالقوه مضر جدا کند. نشانه‌گذاری داده این مفهوم را با استفاده از نشانگرهای خاص برای برجسته کردن مرزهای داده‌های مورد اعتماد و غیرمورد اعتماد گسترش می‌دهد.  
4.  **پایش و به‌روزرسانی مستمر:** مایکروسافت به طور مداوم Prompt Shields را پایش و به‌روزرسانی می‌کند تا با تهدیدات جدید و در حال تحول مقابله کند. این رویکرد پیشگیرانه اطمینان می‌دهد که دفاع‌ها در برابر جدیدترین تکنیک‌های حمله موثر باقی می‌مانند.  
5. **ادغام با Azure Content Safety:** Prompt Shields بخشی از مجموعه گسترده‌تر Azure AI Content Safety است که ابزارهای اضافی برای شناسایی تلاش‌های jailbreak، محتوای مضر و سایر ریسک‌های امنیتی در برنامه‌های هوش مصنوعی ارائه می‌دهد.

می‌توانید برای اطلاعات بیشتر درباره AI prompt shields به [مستندات Prompt Shields](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection) مراجعه کنید.

![prompt-shield-lg-2048x1328](../../../translated_images/prompt-shield.ff5b95be76e9c78c6ec0888206a4a6a0a5ab4bb787832a9eceef7a62fe0138d1.fa.png)

### امنیت زنجیره تامین

امنیت زنجیره تامین در عصر هوش مصنوعی همچنان بنیادین است، اما دامنه آن گسترش یافته است. علاوه بر بسته‌های کد سنتی، اکنون باید همه اجزای مرتبط با هوش مصنوعی از جمله مدل‌های پایه، خدمات embedding، تامین‌کنندگان کانتکست و APIهای شخص ثالث را به دقت تایید و پایش کنید. هر یک از این‌ها می‌توانند در صورت مدیریت نادرست، آسیب‌پذیری یا ریسک ایجاد کنند.

**روش‌های کلیدی امنیت زنجیره تامین برای هوش مصنوعی و MCP:**  
- **تایید همه اجزا پیش از ادغام:** این شامل کتابخانه‌های متن باز، مدل‌های هوش مصنوعی، منابع داده و APIهای خارجی می‌شود. همیشه اصالت، مجوزها و آسیب‌پذیری‌های شناخته شده را بررسی کنید.  
- **نگهداری خطوط تولید امن:** از خطوط تولید خودکار CI/CD با اسکن امنیتی یکپارچه استفاده کنید تا مشکلات زودهنگام شناسایی شوند. اطمینان حاصل کنید که فقط مصنوعات مورد اعتماد به تولید ارسال می‌شوند.  
- **پایش و حسابرسی مستمر:** نظارت مداوم بر همه وابستگی‌ها، از جمله مدل‌ها و خدمات داده‌ای، برای شناسایی آسیب‌پذیری‌ها یا حملات زنجیره تامین.  
- **اعمال اصل حداقل امتیاز و کنترل‌های دسترسی:** دسترسی به مدل‌ها، داده‌ها و خدمات را محدود به حد نیاز برای عملکرد سرور MCP خود کنید.  
- **واکنش سریع به تهدیدات:** فرآیندی برای وصله‌کردن یا جایگزینی اجزای آسیب‌دیده و چرخش اسرار یا اعتبارنامه‌ها در صورت تشخیص نفوذ داشته باشید.

[GitHub Advanced Security](https://github.com/security/advanced-security) امکاناتی مانند اسکن اسرار، اسکن وابستگی‌ها و تحلیل CodeQL ارائه می‌دهد. این ابزارها با [Azure DevOps](https://azure.microsoft.com/en-us/products/devops) و [Azure Repos](https://azure.microsoft.com/en-us/products/devops/repos/) ادغام شده‌اند تا به تیم‌ها در شناس
- [OWASP Top 10 for LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559)
- [GitHub Advanced Security](https://github.com/security/advanced-security)
- [Azure DevOps](https://azure.microsoft.com/products/devops)
- [Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [سفر به سمت امن‌سازی زنجیره تأمین نرم‌افزار در مایکروسافت](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)
- [Secure Least-Privileged Access (مایکروسافت)](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [بهترین روش‌ها برای اعتبارسنجی توکن و مدت زمان آن](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [استفاده از ذخیره‌سازی امن توکن و رمزگذاری توکن‌ها (YouTube)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)
- [مدیریت API آزور به‌عنوان دروازه احراز هویت برای MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [استفاده از Microsoft Entra ID برای احراز هویت با سرورهای MCP](https://den.dev/blog/mcp-server-auth-entra-id-session/)

### بعدی

بعدی: [فصل ۳: شروع کار](/03-GettingStarted/README.md)

**سلب مسئولیت**:  
این سند با استفاده از سرویس ترجمه هوش مصنوعی [Co-op Translator](https://github.com/Azure/co-op-translator) ترجمه شده است. در حالی که ما برای دقت تلاش می‌کنیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است حاوی خطاها یا نواقصی باشند. سند اصلی به زبان مبدأ باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حیاتی، ترجمه حرفه‌ای انسانی توصیه می‌شود. ما مسئول هیچ گونه سوءتفاهم یا برداشت نادرستی که از استفاده از این ترجمه ناشی شود، نیستیم.