<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "8248e3491f5245ee6ab48ef724a4f65a",
  "translation_date": "2025-07-13T21:26:13+00:00",
  "source_file": "03-GettingStarted/07-aitk/README.md",
  "language_code": "fa"
}
-->
# استفاده از سرور در افزونه AI Toolkit برای Visual Studio Code

وقتی در حال ساخت یک عامل هوش مصنوعی هستید، فقط تولید پاسخ‌های هوشمند مهم نیست؛ بلکه باید به عامل خود توانایی انجام اقدامات را هم بدهید. اینجاست که پروتکل زمینه مدل (MCP) وارد می‌شود. MCP دسترسی عامل‌ها به ابزارها و سرویس‌های خارجی را به روشی یکپارچه آسان می‌کند. می‌توانید آن را مثل وصل کردن عامل خود به یک جعبه ابزار واقعی در نظر بگیرید.

فرض کنید یک عامل را به سرور MCP ماشین‌حساب خود متصل می‌کنید. ناگهان عامل شما می‌تواند عملیات ریاضی را فقط با دریافت یک پرسش مثل «47 ضربدر 89 چند می‌شود؟» انجام دهد — بدون نیاز به کدنویسی منطق یا ساخت API سفارشی.

## مرور کلی

این درس نحوه اتصال یک سرور MCP ماشین‌حساب به یک عامل با استفاده از افزونه [AI Toolkit](https://aka.ms/AIToolkit) در Visual Studio Code را پوشش می‌دهد، که به عامل شما امکان می‌دهد عملیات ریاضی مانند جمع، تفریق، ضرب و تقسیم را از طریق زبان طبیعی انجام دهد.

AI Toolkit یک افزونه قدرتمند برای Visual Studio Code است که توسعه عامل‌ها را ساده می‌کند. مهندسان هوش مصنوعی می‌توانند به راحتی برنامه‌های هوش مصنوعی را با توسعه و آزمایش مدل‌های مولد هوش مصنوعی — به صورت محلی یا در فضای ابری — بسازند. این افزونه از اکثر مدل‌های مولد اصلی موجود پشتیبانی می‌کند.

*توجه*: AI Toolkit در حال حاضر از Python و TypeScript پشتیبانی می‌کند.

## اهداف یادگیری

در پایان این درس، شما قادر خواهید بود:

- از یک سرور MCP از طریق AI Toolkit استفاده کنید.
- پیکربندی عاملی را انجام دهید که به آن امکان کشف و استفاده از ابزارهای ارائه شده توسط سرور MCP را بدهد.
- از ابزارهای MCP از طریق زبان طبیعی بهره ببرید.

## رویکرد

در اینجا رویکرد کلی که باید داشته باشیم آمده است:

- ایجاد یک عامل و تعریف پرامپت سیستم آن.
- ساخت یک سرور MCP با ابزارهای ماشین‌حساب.
- اتصال Agent Builder به سرور MCP.
- آزمایش فراخوانی ابزارهای عامل از طریق زبان طبیعی.

عالی است، حالا که جریان کار را فهمیدیم، بیایید یک عامل هوش مصنوعی را طوری پیکربندی کنیم که از طریق MCP از ابزارهای خارجی استفاده کند و قابلیت‌هایش را افزایش دهد!

## پیش‌نیازها

- [Visual Studio Code](https://code.visualstudio.com/)
- [AI Toolkit برای Visual Studio Code](https://aka.ms/AIToolkit)

## تمرین: استفاده از یک سرور

در این تمرین، شما یک عامل هوش مصنوعی را با ابزارهای یک سرور MCP در داخل Visual Studio Code با استفاده از AI Toolkit می‌سازید، اجرا می‌کنید و بهبود می‌دهید.

### -0- مرحله پیش‌نیاز، افزودن مدل OpenAI GPT-4o به My Models

این تمرین از مدل **GPT-4o** استفاده می‌کند. قبل از ایجاد عامل، باید این مدل را به **My Models** اضافه کنید.

![تصویری از رابط انتخاب مدل در افزونه AI Toolkit برای Visual Studio Code. عنوان نوشته شده: "مدل مناسب برای راه‌حل هوش مصنوعی خود را پیدا کنید" با زیرعنوانی که کاربران را به کشف، آزمایش و استقرار مدل‌های هوش مصنوعی تشویق می‌کند. در بخش “Popular Models”، شش کارت مدل نمایش داده شده‌اند: DeepSeek-R1 (میزبانی شده توسط GitHub)، OpenAI GPT-4o، OpenAI GPT-4.1، OpenAI o1، Phi 4 Mini (CPU - کوچک، سریع)، و DeepSeek-R1 (میزبانی شده توسط Ollama). هر کارت شامل گزینه‌هایی برای “افزودن” مدل یا “آزمایش در Playground” است.](../../../../translated_images/aitk-model-catalog.2acd38953bb9c119aa629fe74ef34cc56e4eed35e7f5acba7cd0a59e614ab335.fa.png)

1. افزونه **AI Toolkit** را از **Activity Bar** باز کنید.
2. در بخش **Catalog**، گزینه **Models** را انتخاب کنید تا **Model Catalog** باز شود. انتخاب **Models** باعث باز شدن **Model Catalog** در یک تب جدید ویرایشگر می‌شود.
3. در نوار جستجوی **Model Catalog**، عبارت **OpenAI GPT-4o** را وارد کنید.
4. روی **+ Add** کلیک کنید تا مدل به لیست **My Models** شما اضافه شود. مطمئن شوید مدلی که انتخاب کرده‌اید **میزبانی شده توسط GitHub** است.
5. در **Activity Bar** تأیید کنید که مدل **OpenAI GPT-4o** در لیست ظاهر شده است.

### -1- ایجاد یک عامل

**Agent (Prompt) Builder** به شما امکان می‌دهد عامل‌های هوش مصنوعی خود را بسازید و سفارشی کنید. در این بخش، یک عامل جدید ایجاد کرده و مدلی را برای قدرت بخشیدن به مکالمه انتخاب می‌کنید.

![تصویری از رابط "Calculator Agent" در افزونه AI Toolkit برای Visual Studio Code. در پنل سمت چپ، مدل انتخاب شده "OpenAI GPT-4o (از طریق GitHub)" است. پرامپت سیستم نوشته شده: "شما استادی در دانشگاه هستید که ریاضی تدریس می‌کند" و پرامپت کاربر می‌گوید: "معادله فوریه را به زبان ساده برایم توضیح بده." گزینه‌های اضافی شامل دکمه‌هایی برای افزودن ابزارها، فعال کردن MCP Server و انتخاب خروجی ساختاری است. دکمه آبی رنگ “Run” در پایین قرار دارد. در پنل سمت راست، زیر "شروع با مثال‌ها"، سه عامل نمونه فهرست شده‌اند: توسعه‌دهنده وب (با MCP Server)، ساده‌ساز کلاس دوم و تعبیر خواب، هر کدام با توضیح کوتاهی از عملکردشان.](../../../../translated_images/aitk-agent-builder.901e3a2960c3e4774b29a23024ff5bec2d4232f57fae2a418b2aaae80f81c05f.fa.png)

1. افزونه **AI Toolkit** را از **Activity Bar** باز کنید.
2. در بخش **Tools**، گزینه **Agent (Prompt) Builder** را انتخاب کنید. انتخاب این گزینه باعث باز شدن **Agent (Prompt) Builder** در یک تب جدید ویرایشگر می‌شود.
3. روی دکمه **+ New Agent** کلیک کنید. افزونه یک جادوگر راه‌اندازی از طریق **Command Palette** اجرا می‌کند.
4. نام **Calculator Agent** را وارد کرده و کلید **Enter** را فشار دهید.
5. در **Agent (Prompt) Builder**، در فیلد **Model**، مدل **OpenAI GPT-4o (via GitHub)** را انتخاب کنید.

### -2- ایجاد پرامپت سیستم برای عامل

حالا که عامل ساخته شده، وقت آن است که شخصیت و هدف آن را تعریف کنیم. در این بخش، از ویژگی **Generate system prompt** استفاده می‌کنید تا رفتار مورد نظر عامل — در اینجا یک عامل ماشین‌حساب — را توصیف کنید و مدل پرامپت سیستم را برای شما بنویسد.

![تصویری از رابط "Calculator Agent" در AI Toolkit برای Visual Studio Code با پنجره مودال باز شده با عنوان "Generate a prompt". این پنجره توضیح می‌دهد که یک قالب پرامپت می‌تواند با به اشتراک گذاشتن جزئیات پایه تولید شود و شامل یک جعبه متن با نمونه پرامپت سیستم است: "شما یک دستیار ریاضی مفید و کارآمد هستید. وقتی مسئله‌ای مربوط به حساب پایه داده می‌شود، با نتیجه صحیح پاسخ می‌دهید." در پایین جعبه متن دکمه‌های "Close" و "Generate" قرار دارند. در پس‌زمینه، بخشی از پیکربندی عامل دیده می‌شود، شامل مدل انتخاب شده "OpenAI GPT-4o (via GitHub)" و فیلدهای پرامپت سیستم و کاربر.](../../../../translated_images/aitk-generate-prompt.ba9e69d3d2bbe2a26444d0c78775540b14196061eee32c2054e9ee68c4f51f3a.fa.png)

1. در بخش **Prompts**، روی دکمه **Generate system prompt** کلیک کنید. این دکمه در سازنده پرامپت باز می‌شود که از هوش مصنوعی برای تولید پرامپت سیستم برای عامل استفاده می‌کند.
2. در پنجره **Generate a prompt**، متن زیر را وارد کنید:  
   `شما یک دستیار ریاضی مفید و کارآمد هستید. وقتی مسئله‌ای مربوط به حساب پایه داده می‌شود، با نتیجه صحیح پاسخ می‌دهید.`
3. روی دکمه **Generate** کلیک کنید. یک اعلان در گوشه پایین سمت راست ظاهر می‌شود که تأیید می‌کند پرامپت سیستم در حال تولید است. پس از اتمام تولید، پرامپت در فیلد **System prompt** در **Agent (Prompt) Builder** ظاهر می‌شود.
4. پرامپت سیستم را مرور کرده و در صورت نیاز اصلاح کنید.

### -3- ایجاد یک سرور MCP

حالا که پرامپت سیستم عامل را تعریف کرده‌اید — که رفتار و پاسخ‌های آن را هدایت می‌کند — وقت آن است که عامل را به قابلیت‌های عملی مجهز کنید. در این بخش، یک سرور MCP ماشین‌حساب با ابزارهایی برای انجام عملیات جمع، تفریق، ضرب و تقسیم ایجاد می‌کنید. این سرور به عامل شما امکان می‌دهد عملیات ریاضی را در زمان واقعی در پاسخ به پرامپت‌های زبان طبیعی انجام دهد.

![تصویری از بخش پایین رابط Calculator Agent در افزونه AI Toolkit برای Visual Studio Code. منوهای قابل گسترش “Tools” و “Structure output” نشان داده شده‌اند، همراه با منوی کشویی “Choose output format” که روی “text” تنظیم شده است. در سمت راست، دکمه‌ای با عنوان “+ MCP Server” برای افزودن سرور پروتکل زمینه مدل وجود دارد. بالای بخش Tools، یک جایگاه آیکون تصویر نمایش داده شده است.](../../../../translated_images/aitk-add-mcp-server.9742cfddfe808353c0caf9cc0a7ed3e80e13abf4d2ebde315c81c3cb02a2a449.fa.png)

AI Toolkit قالب‌هایی برای آسان کردن ساخت سرور MCP شما دارد. ما از قالب Python برای ساخت سرور MCP ماشین‌حساب استفاده خواهیم کرد.

*توجه*: AI Toolkit در حال حاضر از Python و TypeScript پشتیبانی می‌کند.

1. در بخش **Tools** از **Agent (Prompt) Builder**، روی دکمه **+ MCP Server** کلیک کنید. افزونه یک جادوگر راه‌اندازی از طریق **Command Palette** اجرا می‌کند.
2. گزینه **+ Add Server** را انتخاب کنید.
3. گزینه **Create a New MCP Server** را انتخاب کنید.
4. قالب **python-weather** را انتخاب کنید.
5. پوشه پیش‌فرض را برای ذخیره قالب سرور MCP انتخاب کنید.
6. نام زیر را برای سرور وارد کنید: **Calculator**
7. یک پنجره جدید Visual Studio Code باز می‌شود. گزینه **Yes, I trust the authors** را انتخاب کنید.
8. با استفاده از ترمینال (**Terminal** > **New Terminal**)، یک محیط مجازی بسازید: `python -m venv .venv`
9. با استفاده از ترمینال، محیط مجازی را فعال کنید:  
    - ویندوز: `.venv\Scripts\activate`  
    - macOS/Linux: `source venv/bin/activate`
10. با استفاده از ترمینال، وابستگی‌ها را نصب کنید: `pip install -e .[dev]`
11. در نمای **Explorer** در **Activity Bar**، پوشه **src** را باز کرده و فایل **server.py** را برای ویرایش انتخاب کنید.
12. کد موجود در فایل **server.py** را با کد زیر جایگزین کرده و ذخیره کنید:

    ```python
    """
    Sample MCP Calculator Server implementation in Python.

    
    This module demonstrates how to create a simple MCP server with calculator tools
    that can perform basic arithmetic operations (add, subtract, multiply, divide).
    """
    
    from mcp.server.fastmcp import FastMCP
    
    server = FastMCP("calculator")
    
    @server.tool()
    def add(a: float, b: float) -> float:
        """Add two numbers together and return the result."""
        return a + b
    
    @server.tool()
    def subtract(a: float, b: float) -> float:
        """Subtract b from a and return the result."""
        return a - b
    
    @server.tool()
    def multiply(a: float, b: float) -> float:
        """Multiply two numbers together and return the result."""
        return a * b
    
    @server.tool()
    def divide(a: float, b: float) -> float:
        """
        Divide a by b and return the result.
        
        Raises:
            ValueError: If b is zero
        """
        if b == 0:
            raise ValueError("Cannot divide by zero")
        return a / b
    ```

### -4- اجرای عامل با سرور MCP ماشین‌حساب

حالا که عامل شما ابزار دارد، وقت استفاده از آن‌هاست! در این بخش، پرامپت‌هایی به عامل ارسال می‌کنید تا تست کنید آیا عامل از ابزار مناسب سرور MCP ماشین‌حساب استفاده می‌کند یا خیر.

![تصویری از رابط Calculator Agent در افزونه AI Toolkit برای Visual Studio Code. در پنل سمت چپ، زیر “Tools”، یک سرور MCP به نام local-server-calculator_server اضافه شده که چهار ابزار فعال دارد: add، subtract، multiply و divide. یک نشانگر تعداد چهار ابزار فعال را نمایش می‌دهد. بخش “Structure output” جمع شده و دکمه آبی “Run” در پایین قرار دارد. در پنل سمت راست، زیر “Model Response”، عامل ابزارهای multiply و subtract را با ورودی‌های {"a": 3, "b": 25} و {"a": 75, "b": 20} فراخوانی کرده است. پاسخ نهایی ابزار 75.0 نشان داده شده است. دکمه “View Code” در پایین دیده می‌شود.](../../../../translated_images/aitk-agent-response-with-tools.e7c781869dc8041a25f9903ed4f7e8e0c7e13d7d94f6786a6c51b1e172f56866.fa.png)

شما سرور MCP ماشین‌حساب را روی ماشین توسعه محلی خود از طریق **Agent Builder** به عنوان کلاینت MCP اجرا خواهید کرد.

1. کلید `F5` را فشار دهید تا اشکال‌زدایی سرور MCP شروع شود. **Agent (Prompt) Builder** در یک تب جدید ویرایشگر باز می‌شود. وضعیت سرور در ترمینال قابل مشاهده است.
2. در فیلد **User prompt** در **Agent (Prompt) Builder**، پرامپت زیر را وارد کنید:  
   `من 3 عدد کالا به قیمت هر کدام 25 دلار خریدم و سپس از تخفیف 20 دلاری استفاده کردم. چقدر پرداخت کردم؟`
3. روی دکمه **Run** کلیک کنید تا پاسخ عامل تولید شود.
4. خروجی عامل را بررسی کنید. مدل باید نتیجه بگیرد که شما **55 دلار** پرداخت کرده‌اید.
5. شرح اتفاقات به این صورت است:  
    - عامل ابزارهای **multiply** و **subtract** را برای کمک به محاسبه انتخاب می‌کند.  
    - مقادیر `a` و `b` برای ابزار **multiply** اختصاص داده می‌شوند.  
    - مقادیر `a` و `b` برای ابزار **subtract** اختصاص داده می‌شوند.  
    - پاسخ هر ابزار در بخش **Tool Response** مربوطه ارائه می‌شود.  
    - خروجی نهایی مدل در بخش **Model Response** نمایش داده می‌شود.
6. پرامپت‌های بیشتری ارسال کنید تا عامل را بیشتر آزمایش کنید. می‌توانید پرامپت موجود در فیلد **User prompt** را با کلیک کردن و جایگزینی متن تغییر دهید.
7. پس از پایان آزمایش عامل، می‌توانید سرور را از طریق **ترمینال** با فشردن **CTRL/CMD+C** متوقف کنید.

## تمرین

سعی کنید یک ابزار جدید به فایل **server.py** خود اضافه کنید (مثلاً محاسبه ریشه دوم یک عدد). پرامپت‌های جدیدی ارسال کنید که عامل را مجبور به استفاده از ابزار جدید (یا ابزارهای موجود) کند. حتماً سرور را برای بارگذاری ابزارهای جدید راه‌اندازی مجدد کنید.

## راه‌حل

[راه‌حل](./solution/README.md)

## نکات کلیدی

نکات مهم این فصل عبارتند از:

- افزونه AI Toolkit یک کلاینت عالی است که به شما امکان استفاده از سرورهای MCP و ابزارهای آن‌ها را می‌دهد.
- می‌توانید ابزارهای جدیدی به سرورهای MCP اضافه کنید و قابلیت‌های عامل را برای پاسخ به نیازهای در حال تغییر گسترش دهید.
- AI Toolkit شامل قالب‌هایی (مثلاً قالب‌های سرور MCP پایتون) است که ساخت ابزارهای سفارشی را ساده می‌کند.

## منابع بیشتر

- [مستندات AI Toolkit](https://aka.ms/AIToolkit/doc)

## مرحله بعدی
- مرحله بعد: [آزمایش و اشکال‌زدایی](../08-testing/README.md)

**سلب مسئولیت**:  
این سند با استفاده از سرویس ترجمه هوش مصنوعی [Co-op Translator](https://github.com/Azure/co-op-translator) ترجمه شده است. در حالی که ما در تلاش برای دقت هستیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است حاوی خطاها یا نادرستی‌هایی باشند. سند اصلی به زبان بومی خود باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حیاتی، ترجمه حرفه‌ای انسانی توصیه می‌شود. ما مسئول هیچ گونه سوءتفاهم یا تفسیر نادرستی که از استفاده از این ترجمه ناشی شود، نیستیم.