<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "98be664d3b19a81ee24fa3f920233864",
  "translation_date": "2025-05-20T23:10:51+00:00",
  "source_file": "02-Security/README.md",
  "language_code": "th"
}
-->
# Security Best Practices

การนำ Model Context Protocol (MCP) มาใช้ช่วยเพิ่มขีดความสามารถใหม่ๆ ให้กับแอปพลิเคชันที่ขับเคลื่อนด้วย AI แต่ก็สร้างความท้าทายด้านความปลอดภัยที่เฉพาะตัวซึ่งเกินกว่าความเสี่ยงของซอฟต์แวร์แบบดั้งเดิม นอกจากความกังวลที่มีอยู่แล้ว เช่น การเขียนโค้ดอย่างปลอดภัย สิทธิ์ที่น้อยที่สุด และความปลอดภัยของซัพพลายเชน MCP และงาน AI ยังเผชิญกับภัยคุกคามใหม่ๆ เช่น การโจมตีแบบ prompt injection, การวางยาพิษเครื่องมือ และการแก้ไขเครื่องมือแบบไดนามิก ความเสี่ยงเหล่านี้อาจนำไปสู่การรั่วไหลของข้อมูล การละเมิดความเป็นส่วนตัว และพฤติกรรมระบบที่ไม่ตั้งใจหากไม่ได้รับการจัดการอย่างเหมาะสม

บทเรียนนี้จะสำรวจความเสี่ยงด้านความปลอดภัยที่เกี่ยวข้องกับ MCP มากที่สุด — รวมถึงการตรวจสอบสิทธิ์ การอนุญาต สิทธิ์ที่มากเกินไป การโจมตี prompt injection ทางอ้อม และช่องโหว่ของซัพพลายเชน — พร้อมทั้งแนะนำการควบคุมและแนวปฏิบัติที่สามารถนำไปใช้ได้จริงเพื่อลดความเสี่ยงเหล่านี้ คุณจะได้เรียนรู้วิธีใช้โซลูชันของ Microsoft เช่น Prompt Shields, Azure Content Safety และ GitHub Advanced Security เพื่อเสริมความแข็งแกร่งในการใช้งาน MCP ของคุณ ด้วยความเข้าใจและการใช้การควบคุมเหล่านี้ คุณจะลดโอกาสเกิดการละเมิดความปลอดภัยได้อย่างมากและทำให้ระบบ AI ของคุณน่าเชื่อถือและมั่นคง

# Learning Objectives

เมื่อจบบทเรียนนี้ คุณจะสามารถ:

- ระบุและอธิบายความเสี่ยงด้านความปลอดภัยเฉพาะตัวที่เกิดจาก Model Context Protocol (MCP) เช่น prompt injection, การวางยาพิษเครื่องมือ, สิทธิ์ที่มากเกินไป และช่องโหว่ของซัพพลายเชน
- อธิบายและนำการควบคุมที่มีประสิทธิภาพมาใช้เพื่อลดความเสี่ยงด้านความปลอดภัยของ MCP เช่น การตรวจสอบสิทธิ์ที่แข็งแกร่ง, สิทธิ์ที่น้อยที่สุด, การจัดการโทเค็นอย่างปลอดภัย และการตรวจสอบซัพพลายเชน
- เข้าใจและใช้โซลูชันของ Microsoft เช่น Prompt Shields, Azure Content Safety และ GitHub Advanced Security เพื่อปกป้อง MCP และงาน AI
- ตระหนักถึงความสำคัญของการตรวจสอบข้อมูลเมตาของเครื่องมือ การติดตามการเปลี่ยนแปลงแบบไดนามิก และการป้องกันการโจมตี prompt injection ทางอ้อม
- รวมแนวปฏิบัติด้านความปลอดภัยที่ได้รับการยอมรับ เช่น การเขียนโค้ดอย่างปลอดภัย การเสริมความแข็งแกร่งของเซิร์ฟเวอร์ และสถาปัตยกรรม zero trust เข้ากับการใช้งาน MCP เพื่อช่วยลดโอกาสและผลกระทบจากการละเมิดความปลอดภัย

# MCP security controls

ระบบใดก็ตามที่เข้าถึงทรัพยากรสำคัญจะมีความท้าทายด้านความปลอดภัยแฝงอยู่ ความท้าทายเหล่านี้โดยทั่วไปสามารถแก้ไขได้ด้วยการใช้การควบคุมและแนวคิดพื้นฐานด้านความปลอดภัยอย่างถูกต้อง เนื่องจาก MCP เพิ่งถูกกำหนดขึ้นใหม่ ข้อกำหนดจึงเปลี่ยนแปลงอย่างรวดเร็วและโปรโตคอลยังคงพัฒนาไปเรื่อยๆ ในที่สุดการควบคุมด้านความปลอดภัยภายในจะเติบโตและทำให้การผสานรวมกับสถาปัตยกรรมความปลอดภัยองค์กรและแนวปฏิบัติที่ยอมรับกันเป็นที่แพร่หลายดีขึ้น

งานวิจัยที่เผยแพร่ใน [Microsoft Digital Defense Report](https://aka.ms/mddr) ระบุว่า 98% ของการละเมิดที่รายงานสามารถป้องกันได้ด้วยสุขอนามัยความปลอดภัยที่แข็งแกร่ง และการป้องกันที่ดีที่สุดต่อการละเมิดใดๆ คือการมีสุขอนามัยความปลอดภัยพื้นฐานที่ดี การเขียนโค้ดอย่างปลอดภัย และความปลอดภัยของซัพพลายเชนที่ถูกต้อง — แนวปฏิบัติที่ผ่านการทดสอบแล้วเหล่านี้ยังคงมีผลมากที่สุดในการลดความเสี่ยงด้านความปลอดภัย

มาดูวิธีการบางอย่างที่คุณสามารถเริ่มจัดการกับความเสี่ยงด้านความปลอดภัยเมื่อใช้ MCP

# MCP server authentication (if your MCP implementation was before 26th April 2025)

> **Note:** ข้อมูลต่อไปนี้ถูกต้อง ณ วันที่ 26 เมษายน 2025 โปรโตคอล MCP ยังคงพัฒนาอย่างต่อเนื่อง และการใช้งานในอนาคตอาจมีรูปแบบและการควบคุมการตรวจสอบสิทธิ์ใหม่ๆ สำหรับข้อมูลและคำแนะนำล่าสุด โปรดดูที่ [MCP Specification](https://spec.modelcontextprotocol.io/) และที่เก็บโค้ดอย่างเป็นทางการ [MCP GitHub repository](https://github.com/modelcontextprotocol)

### Problem statement  
ข้อกำหนด MCP เดิมสมมติว่านักพัฒนาจะเขียนเซิร์ฟเวอร์ตรวจสอบสิทธิ์ของตนเอง ซึ่งต้องมีความรู้เกี่ยวกับ OAuth และข้อจำกัดด้านความปลอดภัยที่เกี่ยวข้อง เซิร์ฟเวอร์ MCP ทำหน้าที่เป็น OAuth 2.0 Authorization Server จัดการการตรวจสอบสิทธิ์ผู้ใช้โดยตรงแทนที่จะมอบหมายให้บริการภายนอกเช่น Microsoft Entra ID ตั้งแต่วันที่ 26 เมษายน 2025 ข้อกำหนด MCP ได้รับการอัปเดตให้เซิร์ฟเวอร์ MCP สามารถมอบหมายการตรวจสอบสิทธิ์ผู้ใช้ให้กับบริการภายนอกได้

### Risks
- การกำหนดตรรกะการอนุญาตในเซิร์ฟเวอร์ MCP ผิดพลาดอาจทำให้ข้อมูลที่ละเอียดอ่อนรั่วไหลและควบคุมการเข้าถึงไม่ถูกต้อง
- การขโมยโทเค็น OAuth บนเซิร์ฟเวอร์ MCP ภายในเครื่อง หากถูกขโมย โทเค็นนี้สามารถถูกใช้เพื่อแอบอ้างเซิร์ฟเวอร์ MCP และเข้าถึงทรัพยากรและข้อมูลจากบริการที่โทเค็น OAuth นั้นใช้ได้

### Mitigating controls
- **ตรวจสอบและเสริมความแข็งแกร่งของตรรกะการอนุญาต:** ตรวจสอบการใช้งานการอนุญาตในเซิร์ฟเวอร์ MCP อย่างละเอียดเพื่อให้แน่ใจว่าผู้ใช้และไคลเอนต์ที่ตั้งใจเท่านั้นที่สามารถเข้าถึงทรัพยากรที่ละเอียดอ่อนได้ สำหรับคำแนะนำเชิงปฏิบัติ ดูที่ [Azure API Management Your Auth Gateway For MCP Servers | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) และ [Using Microsoft Entra ID To Authenticate With MCP Servers Via Sessions - Den Delimarsky](https://den.dev/blog/mcp-server-auth-entra-id-session/)
- **บังคับใช้แนวทางปฏิบัติที่ปลอดภัยในการใช้โทเค็น:** ปฏิบัติตาม [แนวทางปฏิบัติที่ดีที่สุดของ Microsoft สำหรับการตรวจสอบโทเค็นและอายุการใช้งาน](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens) เพื่อป้องกันการใช้งานโทเค็นที่ผิดวัตถุประสงค์และลดความเสี่ยงจากการนำโทเค็นไปใช้ซ้ำหรือถูกขโมย
- **ปกป้องการจัดเก็บโทเค็น:** เก็บโทเค็นอย่างปลอดภัยเสมอและใช้การเข้ารหัสเพื่อปกป้องขณะเก็บและส่งผ่าน สำหรับคำแนะนำในการใช้งาน ดูที่ [Use secure token storage and encrypt tokens](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)

# Excessive permissions for MCP servers

### Problem statement  
เซิร์ฟเวอร์ MCP อาจได้รับสิทธิ์มากเกินไปสำหรับบริการหรือทรัพยากรที่เข้าถึง เช่น เซิร์ฟเวอร์ MCP ที่เป็นส่วนหนึ่งของแอปขาย AI ที่เชื่อมต่อกับฐานข้อมูลองค์กร ควรมีสิทธิ์จำกัดเฉพาะข้อมูลการขายเท่านั้น และไม่ควรเข้าถึงไฟล์ทั้งหมดในฐานข้อมูล หลักการ least privilege (สิทธิ์น้อยที่สุด) ซึ่งเป็นหนึ่งในหลักการความปลอดภัยที่เก่าแก่ที่สุด ระบุว่าไม่มีทรัพยากรใดควรมีสิทธิ์เกินกว่าที่จำเป็นสำหรับการทำงานที่ตั้งใจไว้ AI สร้างความท้าทายเพิ่มขึ้นในเรื่องนี้เพราะต้องการความยืดหยุ่น ทำให้ยากที่จะกำหนดสิทธิ์ที่แน่นอนได้

### Risks  
- การให้สิทธิ์เกินความจำเป็นอาจทำให้เกิดการรั่วไหลหรือแก้ไขข้อมูลที่เซิร์ฟเวอร์ MCP ไม่ควรเข้าถึงได้ ซึ่งอาจเป็นปัญหาด้านความเป็นส่วนตัวหากข้อมูลนั้นเป็นข้อมูลส่วนบุคคล (PII)

### Mitigating controls
- **ใช้หลักการสิทธิ์น้อยที่สุด:** ให้สิทธิ์กับเซิร์ฟเวอร์ MCP เพียงเท่าที่จำเป็นสำหรับงานที่ต้องทำ ตรวจสอบและปรับปรุงสิทธิ์เหล่านี้อย่างสม่ำเสมอเพื่อให้แน่ใจว่าไม่เกินความจำเป็น สำหรับคำแนะนำละเอียด ดูที่ [Secure least-privileged access](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- **ใช้การควบคุมการเข้าถึงตามบทบาท (RBAC):** กำหนดบทบาทให้เซิร์ฟเวอร์ MCP ที่จำกัดเฉพาะทรัพยากรและการกระทำที่เจาะจง หลีกเลี่ยงสิทธิ์กว้างหรือไม่จำเป็น
- **ติดตามและตรวจสอบสิทธิ์:** ติดตามการใช้สิทธิ์อย่างต่อเนื่องและตรวจสอบบันทึกการเข้าถึงเพื่อค้นหาและแก้ไขสิทธิ์ที่เกินหรือไม่ได้ใช้งานอย่างรวดเร็ว

# Indirect prompt injection attacks

### Problem statement

เซิร์ฟเวอร์ MCP ที่เป็นอันตรายหรือถูกแทรกแซงสามารถสร้างความเสี่ยงสำคัญโดยการเปิดเผยข้อมูลลูกค้าหรือทำให้เกิดการกระทำที่ไม่ตั้งใจ ความเสี่ยงเหล่านี้มีความเกี่ยวข้องโดยเฉพาะกับงาน AI และ MCP เช่น:

- **Prompt Injection Attacks:** ผู้โจมตีฝังคำสั่งที่เป็นอันตรายลงใน prompt หรือเนื้อหาภายนอก ทำให้ระบบ AI ทำงานที่ไม่ตั้งใจหรือรั่วไหลข้อมูลสำคัญ เรียนรู้เพิ่มเติมที่ [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- **Tool Poisoning:** ผู้โจมตีแก้ไขข้อมูลเมตาของเครื่องมือ (เช่น คำอธิบายหรือพารามิเตอร์) เพื่อมีอิทธิพลต่อพฤติกรรมของ AI อาจหลบเลี่ยงการควบคุมความปลอดภัยหรือขโมยข้อมูล รายละเอียดที่ [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- **Cross-Domain Prompt Injection:** คำสั่งที่เป็นอันตรายฝังอยู่ในเอกสาร เว็บเพจ หรืออีเมล ซึ่งถูกประมวลผลโดย AI นำไปสู่การรั่วไหลหรือแก้ไขข้อมูล
- **Dynamic Tool Modification (Rug Pulls):** คำจำกัดความของเครื่องมือสามารถเปลี่ยนแปลงได้หลังจากที่ผู้ใช้อนุมัติ เพิ่มพฤติกรรมที่เป็นอันตรายโดยผู้ใช้ไม่รู้ตัว

ช่องโหว่เหล่านี้เน้นย้ำถึงความจำเป็นของการตรวจสอบอย่างเข้มงวด การติดตาม และการควบคุมความปลอดภัยเมื่อรวมเซิร์ฟเวอร์และเครื่องมือ MCP เข้ากับสภาพแวดล้อมของคุณ สำหรับข้อมูลเชิงลึกเพิ่มเติม ดูแหล่งอ้างอิงที่แนบไว้ด้านบน

![prompt-injection-lg-2048x1034](../../../translated_images/prompt-injection.ed9fbfde297ca877c15bc6daa808681cd3c3dc7bf27bbbda342ef1ba5fc4f52d.th.png)

**Indirect Prompt Injection** (หรือที่เรียกว่า cross-domain prompt injection หรือ XPIA) เป็นช่องโหว่ร้ายแรงในระบบ AI สร้างสรรค์ รวมถึงระบบที่ใช้ Model Context Protocol (MCP) ในการโจมตีนี้ คำสั่งที่เป็นอันตรายถูกซ่อนไว้ในเนื้อหาภายนอก เช่น เอกสาร เว็บเพจ หรืออีเมล เมื่อระบบ AI ประมวลผลเนื้อหาเหล่านี้ อาจตีความคำสั่งเหล่านั้นเป็นคำสั่งของผู้ใช้จริง ส่งผลให้เกิดการกระทำที่ไม่ตั้งใจ เช่น การรั่วไหลของข้อมูล การสร้างเนื้อหาที่เป็นอันตราย หรือการแทรกแซงปฏิสัมพันธ์กับผู้ใช้ สำหรับคำอธิบายอย่างละเอียดและตัวอย่างในโลกจริง ดูที่ [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)

รูปแบบที่อันตรายเป็นพิเศษของการโจมตีนี้คือ **Tool Poisoning** ที่ผู้โจมตีแทรกคำสั่งอันตรายลงในข้อมูลเมตาของเครื่องมือ MCP (เช่น คำอธิบายหรือพารามิเตอร์ของเครื่องมือ) เนื่องจากโมเดลภาษาใหญ่ (LLMs) พึ่งพาข้อมูลเมตานี้ในการตัดสินใจเลือกใช้เครื่องมือ คำอธิบายที่ถูกแทรกแซงสามารถหลอกโมเดลให้เรียกใช้เครื่องมือโดยไม่ได้รับอนุญาตหรือหลบเลี่ยงการควบคุมความปลอดภัย การแก้ไขเหล่านี้มักมองไม่เห็นโดยผู้ใช้ปลายทางแต่ AI สามารถตีความและดำเนินการได้ ความเสี่ยงนี้รุนแรงขึ้นในสภาพแวดล้อมเซิร์ฟเวอร์ MCP ที่โฮสต์ ที่ซึ่งคำจำกัดความของเครื่องมือสามารถอัปเดตได้หลังจากที่ผู้ใช้อนุมัติ ซึ่งบางครั้งเรียกว่า "[rug pull](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)" ในกรณีเช่นนี้ เครื่องมือที่เคยปลอดภัยอาจถูกแก้ไขให้ทำงานที่เป็นอันตราย เช่น การรั่วไหลของข้อมูลหรือการเปลี่ยนพฤติกรรมระบบโดยที่ผู้ใช้ไม่รู้ สำหรับข้อมูลเพิ่มเติมเกี่ยวกับช่องทางการโจมตีนี้ ดูที่ [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)

![tool-injection-lg-2048x1239 (1)](../../../translated_images/tool-injection.3b0b4a6b24de6befe7d3afdeae44138ef005881aebcfc84c6f61369ce31e3640.th.png)

## Risks  
การกระทำของ AI ที่ไม่ตั้งใจสร้างความเสี่ยงด้านความปลอดภัยหลายอย่าง รวมถึงการรั่วไหลของข้อมูลและการละเมิดความเป็นส่วนตัว

### Mitigating controls  
### Using prompt shields to protect against Indirect Prompt Injection attacks  
-----------------------------------------------------------------------------

**AI Prompt Shields** คือโซลูชันที่พัฒนาโดย Microsoft เพื่อป้องกันการโจมตี prompt injection ทั้งแบบตรงและแบบทางอ้อม โดยช่วยในเรื่อง:

1.  **การตรวจจับและกรอง:** Prompt Shields ใช้อัลกอริทึมการเรียนรู้ของเครื่องขั้นสูงและการประมวลผลภาษาธรรมชาติเพื่อตรวจจับและกรองคำสั่งที่เป็นอันตรายที่ฝังอยู่ในเนื้อหาภายนอก เช่น เอกสาร เว็บเพจ หรืออีเมล
2.  **Spotlighting:** เทคนิคนี้ช่วยให้ระบบ AI แยกแยะระหว่างคำสั่งระบบที่ถูกต้องกับข้อมูลภายนอกที่ไม่น่าเชื่อถือ โดยการเปลี่ยนข้อความนำเข้าให้มีความเกี่ยวข้องกับโมเดลมากขึ้น Spotlighting ช่วยให้ AI สามารถระบุและละเว้นคำสั่งที่เป็นอันตรายได้ดีขึ้น
3.  **Delimiters และ Datamarking:** การใส่ตัวคั่นในข้อความระบบช่วยระบุชัดเจนว่าข้อความนำเข้ามาจากที่ใด ช่วยให้ AI แยกแยะระหว่างข้อมูลของผู้ใช้กับเนื้อหาภายนอกที่อาจเป็นอันตราย Datamarking ขยายแนวคิดนี้โดยใช้เครื่องหมายพิเศษเพื่อเน้นขอบเขตของข้อมูลที่เชื่อถือได้และไม่ได้เชื่อถือ
4.  **การติดตามและอัปเดตอย่างต่อเนื่อง:** Microsoft ติดตามและอัปเดต Prompt Shields อย่างต่อเนื่องเพื่อรับมือกับภัยคุกคามใหม่ๆ แนวทางเชิงรุกนี้ช่วยให้การป้องกันมีประสิทธิภาพต่อเทคนิคการโจมตีล่าสุด
5. **การรวมกับ Azure Content Safety:** Prompt Shields เป็นส่วนหนึ่งของชุดเครื่องมือ Azure AI Content Safety ซึ่งมีเครื่องมือเพิ่มเติมสำหรับตรวจจับความพยายาม jailbreak เนื้อหาที่เป็นอันตราย และความเสี่ยงด้านความปลอดภัยอื่นๆ ในแอปพลิเคชัน AI

คุณสามารถอ่านรายละเอียดเพิ่มเติมเกี่ยวกับ AI prompt shields ได้ที่ [Prompt Shields documentation](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection)

![prompt-shield-lg-2048x1328](../../../translated_images/prompt-shield.ff5b95be76e9c78c6ec0888206a4a6a0a5ab4bb787832a9eceef7a62fe0138d1.th.png)

### Supply chain security

ความปลอดภัยของซัพพลายเชนยังคงเป็นพื้นฐานสำคัญในยุค AI แต่ขอบเขตของซัพพลายเชนได้ขยายออกไป นอกจากแพ็กเกจโค้ดแบบดั้งเด
- [OWASP Top 10 for LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559)
- [GitHub Advanced Security](https://github.com/security/advanced-security)
- [Azure DevOps](https://azure.microsoft.com/products/devops)
- [Azure Repos](https://azure.microsoft.com/products/devops/repos/)
- [การเดินทางสู่การรักษาความปลอดภัยของซัพพลายเชนซอฟต์แวร์ที่ Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)
- [Secure Least-Privileged Access (Microsoft)](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- [แนวทางปฏิบัติที่ดีที่สุดสำหรับการตรวจสอบและอายุของ Token](https://learn.microsoft.com/entra/identity-platform/access-tokens)
- [การใช้ Secure Token Storage และการเข้ารหัส Token (YouTube)](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)
- [Azure API Management เป็นเกตเวย์การตรวจสอบสิทธิ์สำหรับ MCP](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)
- [การใช้ Microsoft Entra ID เพื่อยืนยันตัวตนกับเซิร์ฟเวอร์ MCP](https://den.dev/blog/mcp-server-auth-entra-id-session/)

### ต่อไป

ต่อไป: [บทที่ 3: เริ่มต้นใช้งาน](/03-GettingStarted/README.md)

**ข้อจำกัดความรับผิดชอบ**:  
เอกสารนี้ได้รับการแปลโดยใช้บริการแปลภาษา AI [Co-op Translator](https://github.com/Azure/co-op-translator) แม้ว่าเราจะพยายามให้การแปลมีความถูกต้อง โปรดทราบว่าการแปลอัตโนมัติอาจมีข้อผิดพลาดหรือความไม่ถูกต้อง เอกสารต้นฉบับในภาษาดั้งเดิมควรถูกพิจารณาเป็นแหล่งข้อมูลที่เชื่อถือได้ สำหรับข้อมูลที่สำคัญ แนะนำให้ใช้บริการแปลโดยมนุษย์มืออาชีพ เราจะไม่รับผิดชอบต่อความเข้าใจผิดหรือการตีความผิดใด ๆ ที่เกิดขึ้นจากการใช้การแปลนี้