<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "382fddb4ee4d9c1bdc806e2ee99b70c8",
  "translation_date": "2025-07-17T06:06:40+00:00",
  "source_file": "02-Security/README.md",
  "language_code": "th"
}
-->
# แนวทางปฏิบัติด้านความปลอดภัยที่ดีที่สุด

การนำ Model Context Protocol (MCP) มาใช้ช่วยเพิ่มขีดความสามารถใหม่ ๆ ให้กับแอปพลิเคชันที่ขับเคลื่อนด้วย AI แต่ก็สร้างความท้าทายด้านความปลอดภัยเฉพาะตัวที่เกินกว่าความเสี่ยงซอฟต์แวร์แบบดั้งเดิม นอกเหนือจากความกังวลที่มีอยู่แล้ว เช่น การเขียนโค้ดอย่างปลอดภัย หลักการสิทธิ์น้อยที่สุด และความปลอดภัยของห่วงโซ่อุปทาน MCP และงาน AI ยังเผชิญกับภัยคุกคามใหม่ ๆ เช่น การฉีดคำสั่ง (prompt injection), การวางยาพิษเครื่องมือ (tool poisoning), การแก้ไขเครื่องมือแบบไดนามิก, การแฮ็กเซสชัน, การโจมตีแบบ confused deputy และช่องโหว่ token passthrough ความเสี่ยงเหล่านี้อาจนำไปสู่การรั่วไหลของข้อมูล การละเมิดความเป็นส่วนตัว และพฤติกรรมระบบที่ไม่ตั้งใจหากไม่ได้รับการจัดการอย่างเหมาะสม

บทเรียนนี้จะสำรวจความเสี่ยงด้านความปลอดภัยที่เกี่ยวข้องกับ MCP มากที่สุด — รวมถึงการตรวจสอบสิทธิ์ การอนุญาต สิทธิ์ที่เกินความจำเป็น การฉีดคำสั่งแบบอ้อม ความปลอดภัยของเซสชัน ปัญหา confused deputy ช่องโหว่ token passthrough และช่องโหว่ห่วงโซ่อุปทาน — พร้อมทั้งแนะนำมาตรการควบคุมและแนวทางปฏิบัติที่ดีที่สุดเพื่อบรรเทาความเสี่ยงเหล่านี้ นอกจากนี้คุณยังจะได้เรียนรู้วิธีใช้โซลูชันของ Microsoft เช่น Prompt Shields, Azure Content Safety และ GitHub Advanced Security เพื่อเสริมความแข็งแกร่งให้กับการใช้งาน MCP ของคุณ ด้วยความเข้าใจและการประยุกต์ใช้มาตรการเหล่านี้ คุณจะลดโอกาสเกิดการละเมิดความปลอดภัยได้อย่างมากและทำให้ระบบ AI ของคุณมีความมั่นคงและน่าเชื่อถือ

# วัตถุประสงค์การเรียนรู้

เมื่อจบบทเรียนนี้ คุณจะสามารถ:

- ระบุและอธิบายความเสี่ยงด้านความปลอดภัยเฉพาะที่เกิดจาก Model Context Protocol (MCP) รวมถึงการฉีดคำสั่ง, การวางยาพิษเครื่องมือ, สิทธิ์ที่เกินความจำเป็น, การแฮ็กเซสชัน, ปัญหา confused deputy, ช่องโหว่ token passthrough และช่องโหว่ห่วงโซ่อุปทาน
- อธิบายและประยุกต์ใช้มาตรการควบคุมที่มีประสิทธิภาพเพื่อลดความเสี่ยงด้านความปลอดภัยของ MCP เช่น การตรวจสอบสิทธิ์ที่แข็งแกร่ง หลักการสิทธิ์น้อยที่สุด การจัดการโทเค็นอย่างปลอดภัย การควบคุมความปลอดภัยของเซสชัน และการตรวจสอบห่วงโซ่อุปทาน
- เข้าใจและใช้โซลูชันของ Microsoft เช่น Prompt Shields, Azure Content Safety และ GitHub Advanced Security เพื่อปกป้อง MCP และงาน AI
- ตระหนักถึงความสำคัญของการตรวจสอบข้อมูลเมตาของเครื่องมือ การติดตามการเปลี่ยนแปลงแบบไดนามิก การป้องกันการโจมตีฉีดคำสั่งแบบอ้อม และการป้องกันการแฮ็กเซสชัน
- ผสานรวมแนวทางปฏิบัติด้านความปลอดภัยที่ดีที่สุดที่มีอยู่แล้ว เช่น การเขียนโค้ดอย่างปลอดภัย การเสริมความแข็งแกร่งของเซิร์ฟเวอร์ และสถาปัตยกรรม zero trust เข้ากับการใช้งาน MCP ของคุณเพื่อลดโอกาสและผลกระทบจากการละเมิดความปลอดภัย

# มาตรการควบคุมความปลอดภัยของ MCP

ระบบใดก็ตามที่เข้าถึงทรัพยากรสำคัญจะมีความท้าทายด้านความปลอดภัยโดยนัย ความท้าทายเหล่านี้โดยทั่วไปสามารถแก้ไขได้ด้วยการประยุกต์ใช้มาตรการควบคุมและแนวคิดด้านความปลอดภัยพื้นฐานอย่างถูกต้อง เนื่องจาก MCP เพิ่งถูกกำหนดขึ้นใหม่ ข้อกำหนดจึงเปลี่ยนแปลงอย่างรวดเร็วและพัฒนาไปตามโปรโตคอล ในที่สุดมาตรการควบคุมความปลอดภัยภายในจะมีความสมบูรณ์มากขึ้น ทำให้สามารถผสานรวมกับสถาปัตยกรรมความปลอดภัยขององค์กรและแนวทางปฏิบัติที่ดีที่สุดได้ดียิ่งขึ้น

งานวิจัยที่เผยแพร่ใน [Microsoft Digital Defense Report](https://aka.ms/mddr) ระบุว่า 98% ของการละเมิดที่รายงานสามารถป้องกันได้ด้วยสุขอนามัยความปลอดภัยที่เข้มงวด และการป้องกันที่ดีที่สุดต่อการละเมิดใด ๆ คือการมีสุขอนามัยความปลอดภัยพื้นฐานที่ดี การเขียนโค้ดอย่างปลอดภัย และความปลอดภัยของห่วงโซ่อุปทานที่ถูกต้อง — แนวทางปฏิบัติที่ผ่านการทดสอบและพิสูจน์แล้วเหล่านี้ยังคงมีผลมากที่สุดในการลดความเสี่ยงด้านความปลอดภัย

มาดูวิธีการบางอย่างที่คุณสามารถเริ่มต้นจัดการความเสี่ยงด้านความปลอดภัยเมื่อใช้ MCP

> **Note:** ข้อมูลต่อไปนี้ถูกต้อง ณ วันที่ **29 พฤษภาคม 2025** โปรโตคอล MCP ยังคงพัฒนาอย่างต่อเนื่อง และการใช้งานในอนาคตอาจมีรูปแบบการตรวจสอบสิทธิ์และมาตรการควบคุมใหม่ ๆ สำหรับข้อมูลและคำแนะนำล่าสุด โปรดดูที่ [MCP Specification](https://spec.modelcontextprotocol.io/) และที่เก็บโค้ด [MCP GitHub repository](https://github.com/modelcontextprotocol) รวมถึง [หน้าแนวทางปฏิบัติด้านความปลอดภัย](https://modelcontextprotocol.io/specification/draft/basic/security_best_practices)

### ปัญหาที่พบ
ข้อกำหนด MCP ดั้งเดิมสมมติว่านักพัฒนาจะเขียนเซิร์ฟเวอร์ตรวจสอบสิทธิ์ของตนเอง ซึ่งต้องมีความรู้เกี่ยวกับ OAuth และข้อจำกัดด้านความปลอดภัยที่เกี่ยวข้อง เซิร์ฟเวอร์ MCP ทำหน้าที่เป็น OAuth 2.0 Authorization Servers จัดการการตรวจสอบสิทธิ์ผู้ใช้โดยตรงแทนที่จะมอบหมายให้บริการภายนอก เช่น Microsoft Entra ID ตั้งแต่วันที่ **26 เมษายน 2025** เป็นต้นมา ข้อกำหนด MCP ได้รับการอัปเดตให้เซิร์ฟเวอร์ MCP สามารถมอบหมายการตรวจสอบสิทธิ์ผู้ใช้ให้กับบริการภายนอกได้

### ความเสี่ยง
- การกำหนดตรรกะการอนุญาตในเซิร์ฟเวอร์ MCP ผิดพลาดอาจทำให้ข้อมูลที่ละเอียดอ่อนรั่วไหลและการควบคุมการเข้าถึงถูกใช้งานผิดวิธี
- การขโมยโทเค็น OAuth บนเซิร์ฟเวอร์ MCP ท้องถิ่น หากถูกขโมย โทเค็นนั้นสามารถใช้แอบอ้างเป็นเซิร์ฟเวอร์ MCP และเข้าถึงทรัพยากรและข้อมูลจากบริการที่โทเค็น OAuth นั้นใช้ได้

#### Token Passthrough
การส่งผ่านโทเค็น (token passthrough) ถูกห้ามอย่างชัดเจนในข้อกำหนดการอนุญาตเนื่องจากก่อให้เกิดความเสี่ยงด้านความปลอดภัยหลายประการ ได้แก่:

#### การหลีกเลี่ยงมาตรการควบคุมความปลอดภัย
เซิร์ฟเวอร์ MCP หรือ API ปลายทางอาจมีมาตรการควบคุมความปลอดภัยสำคัญ เช่น การจำกัดอัตราการร้องขอ การตรวจสอบคำขอ หรือการตรวจสอบการจราจร ซึ่งขึ้นอยู่กับกลุ่มเป้าหมายของโทเค็นหรือข้อจำกัดของข้อมูลรับรองอื่น ๆ หากลูกค้าสามารถรับและใช้โทเค็นโดยตรงกับ API ปลายทางโดยไม่ผ่านการตรวจสอบอย่างถูกต้องจากเซิร์ฟเวอร์ MCP หรือไม่แน่ใจว่าโทเค็นออกให้กับบริการที่ถูกต้อง พวกเขาจะหลีกเลี่ยงมาตรการควบคุมเหล่านี้ได้

#### ปัญหาด้านความรับผิดชอบและการตรวจสอบ
เซิร์ฟเวอร์ MCP จะไม่สามารถระบุหรือแยกแยะระหว่างลูกค้า MCP ได้เมื่อมีการเรียกใช้ด้วยโทเค็นการเข้าถึงที่ออกโดย upstream ซึ่งอาจเป็นโทเค็นที่ไม่สามารถอ่านได้โดยเซิร์ฟเวอร์ MCP
บันทึกของเซิร์ฟเวอร์ทรัพยากรปลายทางอาจแสดงคำขอที่ดูเหมือนมาจากแหล่งที่มาและตัวตนที่แตกต่างจากเซิร์ฟเวอร์ MCP ที่ส่งต่อโทเค็นจริง
ปัจจัยทั้งสองนี้ทำให้การสืบสวนเหตุการณ์ การควบคุม และการตรวจสอบยากขึ้น
หากเซิร์ฟเวอร์ MCP ส่งต่อโทเค็นโดยไม่ตรวจสอบคำอ้างสิทธิ์ (เช่น บทบาท สิทธิ์ หรือกลุ่มเป้าหมาย) หรือข้อมูลเมตาอื่น ๆ ผู้ไม่หวังดีที่ครอบครองโทเค็นที่ถูกขโมยสามารถใช้เซิร์ฟเวอร์เป็นพร็อกซีสำหรับการรั่วไหลของข้อมูลได้

#### ปัญหาขอบเขตความเชื่อถือ
เซิร์ฟเวอร์ทรัพยากรปลายทางให้ความเชื่อถือกับหน่วยงานเฉพาะ ความเชื่อนี้อาจรวมถึงสมมติฐานเกี่ยวกับแหล่งที่มา หรือรูปแบบพฤติกรรมของลูกค้า การทำลายขอบเขตความเชื่อถือนี้อาจนำไปสู่ปัญหาที่ไม่คาดคิด
หากโทเค็นได้รับการยอมรับโดยหลายบริการโดยไม่มีการตรวจสอบอย่างเหมาะสม ผู้โจมตีที่เจาะบริการหนึ่งได้สามารถใช้โทเค็นนั้นเพื่อเข้าถึงบริการอื่น ๆ ที่เชื่อมต่อกันได้

#### ความเสี่ยงด้านความเข้ากันได้ในอนาคต
แม้ว่าเซิร์ฟเวอร์ MCP จะเริ่มต้นเป็น "พร็อกซีบริสุทธิ์" ในวันนี้ แต่ในอนาคตอาจจำเป็นต้องเพิ่มมาตรการควบคุมความปลอดภัย การเริ่มต้นด้วยการแยกกลุ่มเป้าหมายของโทเค็นอย่างถูกต้องจะช่วยให้การพัฒนารูปแบบความปลอดภัยง่ายขึ้น

### มาตรการบรรเทาความเสี่ยง

**เซิร์ฟเวอร์ MCP ต้องไม่รับโทเค็นใด ๆ ที่ไม่ได้ออกให้โดยเฉพาะสำหรับเซิร์ฟเวอร์ MCP**

- **ตรวจสอบและเสริมความแข็งแกร่งตรรกะการอนุญาต:** ตรวจสอบการใช้งานการอนุญาตของเซิร์ฟเวอร์ MCP อย่างละเอียดเพื่อให้แน่ใจว่ามีเพียงผู้ใช้และลูกค้าที่ตั้งใจเท่านั้นที่สามารถเข้าถึงทรัพยากรที่ละเอียดอ่อนได้ สำหรับคำแนะนำเชิงปฏิบัติ ดูที่ [Azure API Management Your Auth Gateway For MCP Servers | Microsoft Community Hub](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) และ [Using Microsoft Entra ID To Authenticate With MCP Servers Via Sessions - Den Delimarsky](https://den.dev/blog/mcp-server-auth-entra-id-session/)
- **บังคับใช้แนวทางปฏิบัติการจัดการโทเค็นอย่างปลอดภัย:** ปฏิบัติตาม [แนวทางปฏิบัติที่ดีที่สุดของ Microsoft สำหรับการตรวจสอบและอายุของโทเค็น](https://learn.microsoft.com/en-us/entra/identity-platform/access-tokens) เพื่อป้องกันการใช้โทเค็นเข้าถึงในทางที่ผิดและลดความเสี่ยงจากการเล่นซ้ำหรือการขโมยโทเค็น
- **ปกป้องการจัดเก็บโทเค็น:** เก็บโทเค็นอย่างปลอดภัยเสมอและใช้การเข้ารหัสเพื่อปกป้องโทเค็นทั้งในขณะพักและขณะส่ง สำหรับเคล็ดลับการใช้งาน ดูที่ [Use secure token storage and encrypt tokens](https://youtu.be/uRdX37EcCwg?si=6fSChs1G4glwXRy2)

# สิทธิ์ที่เกินความจำเป็นสำหรับเซิร์ฟเวอร์ MCP

### ปัญหาที่พบ
เซิร์ฟเวอร์ MCP อาจได้รับสิทธิ์เกินความจำเป็นสำหรับบริการหรือทรัพยากรที่เข้าถึง เช่น เซิร์ฟเวอร์ MCP ที่เป็นส่วนหนึ่งของแอปพลิเคชัน AI ด้านการขายที่เชื่อมต่อกับคลังข้อมูลองค์กร ควรมีสิทธิ์เข้าถึงเฉพาะข้อมูลการขายเท่านั้น ไม่ควรเข้าถึงไฟล์ทั้งหมดในคลังข้อมูล หลักการสิทธิ์น้อยที่สุด (หนึ่งในหลักการความปลอดภัยที่เก่าแก่ที่สุด) ระบุว่าไม่มีทรัพยากรใดควรมีสิทธิ์เกินกว่าที่จำเป็นสำหรับการทำงานที่ตั้งใจไว้ AI สร้างความท้าทายเพิ่มขึ้นในด้านนี้เพราะเพื่อให้มีความยืดหยุ่น การกำหนดสิทธิ์ที่จำเป็นอย่างแม่นยำอาจทำได้ยาก

### ความเสี่ยง
- การให้สิทธิ์เกินความจำเป็นอาจทำให้เกิดการรั่วไหลหรือแก้ไขข้อมูลที่เซิร์ฟเวอร์ MCP ไม่ควรเข้าถึงได้ ซึ่งอาจเป็นปัญหาด้านความเป็นส่วนตัวหากข้อมูลนั้นเป็นข้อมูลส่วนบุคคล (PII)

### มาตรการบรรเทาความเสี่ยง
- **ใช้หลักการสิทธิ์น้อยที่สุด:** ให้สิทธิ์เซิร์ฟเวอร์ MCP เพียงเท่าที่จำเป็นสำหรับการทำงานที่ต้องการเท่านั้น ทบทวนและปรับปรุงสิทธิ์เหล่านี้อย่างสม่ำเสมอเพื่อให้แน่ใจว่าไม่เกินความจำเป็น สำหรับคำแนะนำโดยละเอียด ดูที่ [Secure least-privileged access](https://learn.microsoft.com/entra/identity-platform/secure-least-privileged-access)
- **ใช้การควบคุมการเข้าถึงตามบทบาท (RBAC):** กำหนดบทบาทให้กับเซิร์ฟเวอร์ MCP ที่มีขอบเขตจำกัดเฉพาะทรัพยากรและการกระทำที่เจาะจง หลีกเลี่ยงการให้สิทธิ์กว้างหรือไม่จำเป็น
- **ติดตามและตรวจสอบสิทธิ์:** ตรวจสอบการใช้งานสิทธิ์อย่างต่อเนื่องและตรวจสอบบันทึกการเข้าถึงเพื่อค้นหาและแก้ไขสิทธิ์ที่เกินความจำเป็นหรือไม่ได้ใช้งานอย่างรวดเร็ว

# การโจมตีฉีดคำสั่งแบบอ้อม

### ปัญหาที่พบ

เซิร์ฟเวอร์ MCP ที่เป็นอันตรายหรือถูกเจาะสามารถสร้างความเสี่ยงอย่างมากโดยการเปิดเผยข้อมูลลูกค้าหรือทำให้เกิดการกระทำที่ไม่ตั้งใจ ความเสี่ยงเหล่านี้มีความเกี่ยวข้องอย่างยิ่งในงาน AI และงานที่ใช้ MCP ซึ่งได้แก่:

- **การโจมตีฉีดคำสั่ง (Prompt Injection Attacks):** ผู้โจมตีฝังคำสั่งที่เป็นอันตรายลงในคำสั่งหรือเนื้อหาภายนอก ทำให้ระบบ AI ทำงานที่ไม่ตั้งใจหรือรั่วไหลข้อมูลที่ละเอียดอ่อน เรียนรู้เพิ่มเติม: [Prompt Injection](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- **การวางยาพิษเครื่องมือ (Tool Poisoning):** ผู้โจมตีแก้ไขข้อมูลเมตาของเครื่องมือ (เช่น คำอธิบายหรือพารามิเตอร์) เพื่อมีอิทธิพลต่อพฤติกรรมของ AI อาจหลีกเลี่ยงมาตรการควบคุมความปลอดภัยหรือรั่วไหลข้อมูล รายละเอียด: [Tool Poisoning](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- **การฉีดคำสั่งข้ามโดเมน (Cross-Domain Prompt Injection):** คำสั่งที่เป็นอันตรายถูกฝังในเอกสาร เว็บเพจ หรืออีเมล ซึ่งถูกประมวลผลโดย AI ทำให้เกิดการรั่วไหลหรือการบิดเบือนข้อมูล
- **การแก้ไขเครื่องมือแบบไดนามิก (Rug Pulls):** คำจำกัดความของเครื่องมือสามารถเปลี่ยนแปลงหลังจากได้รับการอนุมัติจากผู้ใช้ ทำให้เกิดพฤติกรรมที่เป็นอันตรายใหม่โดยที่ผู้ใช้ไม่รู้ตัว

ช่องโหว่เหล่านี้เน้นย้ำถึงความจำเป็นในการตรวจสอบอย่างเข้มงวด การติดตาม และมาตรการควบคุมความปลอดภัยเมื่อผสานรวมเซิร์ฟเวอร์ MCP และเครื่องมือเข้ากับสภาพแวดล้อมของคุณ สำหรับข้อมูลเชิงลึกเพิ่มเติม โปรดดูแหล่งอ้างอิงที่เชื่อมโยงด้านบน

![prompt-injection-lg-2048x1034](../../../translated_images/prompt-injection.ed9fbfde297ca877c15bc6daa808681cd3c3dc7bf27bbbda342ef1ba5fc4f52d.th.png)

**การฉีดคำสั่งแบบอ้อม (Indirect Prompt Injection)** หรือที่รู้จักกันในชื่อ cross-domain prompt injection หรือ XPIA เป็นช่องโหว่ร้ายแรงในระบบ AI สร้างสรรค์ รวมถึงระบบที่ใช้ Model Context Protocol (MCP) ในการโจมตีนี้ คำสั่งที่เป็นอันตรายจะถูกซ่อนไว้ในเนื้อหาภายนอก เช่น เอกสาร เว็บเพจ หรืออี
ปัญหา confused deputy เป็นช่องโหว่ด้านความปลอดภัยที่เกิดขึ้นเมื่อเซิร์ฟเวอร์ MCP ทำหน้าที่เป็นพร็อกซีระหว่างไคลเอนต์ MCP กับ API ของบุคคลที่สาม ช่องโหว่นี้สามารถถูกโจมตีได้เมื่อเซิร์ฟเวอร์ MCP ใช้ client ID แบบคงที่เพื่อยืนยันตัวตนกับเซิร์ฟเวอร์อนุญาตของบุคคลที่สามซึ่งไม่มีการรองรับการลงทะเบียน client แบบไดนามิก

### ความเสี่ยง

- **การข้ามความยินยอมโดยใช้คุกกี้**: หากผู้ใช้เคยยืนยันตัวตนผ่านพร็อกซีเซิร์ฟเวอร์ MCP มาก่อน เซิร์ฟเวอร์อนุญาตของบุคคลที่สามอาจตั้งคุกกี้ความยินยอมในเบราว์เซอร์ของผู้ใช้ ผู้โจมตีสามารถใช้ประโยชน์จากคุกกี้นี้โดยส่งลิงก์ที่เป็นอันตรายพร้อมคำขออนุญาตที่ถูกสร้างขึ้นอย่างประสงค์ร้ายซึ่งมี redirect URI ที่เป็นอันตราย
- **การขโมยรหัสอนุญาต**: เมื่อผู้ใช้คลิกลิงก์ที่เป็นอันตราย เซิร์ฟเวอร์อนุญาตของบุคคลที่สามอาจข้ามหน้าความยินยอมเนื่องจากมีคุกกี้อยู่แล้ว และรหัสอนุญาตอาจถูกส่งต่อไปยังเซิร์ฟเวอร์ของผู้โจมตี
- **การเข้าถึง API โดยไม่ได้รับอนุญาต**: ผู้โจมตีสามารถแลกรหัสอนุญาตที่ถูกขโมยเป็น access token และแอบอ้างเป็นผู้ใช้เพื่อเข้าถึง API ของบุคคลที่สามโดยไม่ได้รับอนุญาตอย่างชัดเจน

### มาตรการลดความเสี่ยง

- **ข้อกำหนดความยินยอมอย่างชัดเจน**: เซิร์ฟเวอร์พร็อกซี MCP ที่ใช้ client ID แบบคงที่ **ต้อง** ขอความยินยอมจากผู้ใช้สำหรับแต่ละ client ที่ลงทะเบียนแบบไดนามิกก่อนส่งต่อไปยังเซิร์ฟเวอร์อนุญาตของบุคคลที่สาม
- **การใช้งาน OAuth อย่างถูกต้อง**: ปฏิบัติตามแนวทางปฏิบัติด้านความปลอดภัย OAuth 2.1 รวมถึงการใช้ code challenge (PKCE) สำหรับคำขออนุญาตเพื่อป้องกันการโจมตีแบบดักจับ
- **การตรวจสอบ client**: ดำเนินการตรวจสอบ redirect URI และตัวระบุ client อย่างเข้มงวดเพื่อป้องกันการถูกโจมตีโดยผู้ประสงค์ร้าย

# ช่องโหว่ Token Passthrough

### คำชี้แจงปัญหา

"Token passthrough" เป็นรูปแบบที่ไม่เหมาะสมซึ่งเซิร์ฟเวอร์ MCP รับ token จากไคลเอนต์ MCP โดยไม่ตรวจสอบว่า token เหล่านั้นถูกออกให้กับเซิร์ฟเวอร์ MCP จริงหรือไม่ จากนั้นจึง "ส่งต่อ" token เหล่านั้นไปยัง API ปลายทาง การปฏิบัตินี้ละเมิดข้อกำหนดการอนุญาตของ MCP อย่างชัดเจนและก่อให้เกิดความเสี่ยงด้านความปลอดภัยอย่างรุนแรง

### ความเสี่ยง

- **การหลีกเลี่ยงการควบคุมความปลอดภัย**: ไคลเอนต์อาจข้ามการควบคุมความปลอดภัยสำคัญ เช่น การจำกัดอัตรา การตรวจสอบคำขอ หรือการตรวจสอบการจราจร หากสามารถใช้ token โดยตรงกับ API ปลายทางโดยไม่ผ่านการตรวจสอบที่เหมาะสม
- **ปัญหาความรับผิดชอบและการตรวจสอบย้อนหลัง**: เซิร์ฟเวอร์ MCP จะไม่สามารถระบุหรือแยกแยะไคลเอนต์ MCP ได้เมื่อไคลเอนต์ใช้ access token ที่ออกโดย upstream ทำให้การสืบสวนเหตุการณ์และการตรวจสอบย้อนหลังทำได้ยากขึ้น
- **การขโมยข้อมูล**: หาก token ถูกส่งต่อโดยไม่ตรวจสอบ claims อย่างถูกต้อง ผู้ประสงค์ร้ายที่มี token ขโมยอาจใช้เซิร์ฟเวอร์เป็นพร็อกซีเพื่อขโมยข้อมูล
- **การละเมิดขอบเขตความน่าเชื่อถือ**: เซิร์ฟเวอร์ทรัพยากรปลายทางอาจให้ความไว้วางใจแก่เอนทิตีเฉพาะโดยมีสมมติฐานเกี่ยวกับแหล่งที่มาและรูปแบบพฤติกรรม การทำลายขอบเขตความน่าเชื่อถือนี้อาจนำไปสู่ปัญหาด้านความปลอดภัยที่ไม่คาดคิด
- **การใช้ token ผิดวัตถุประสงค์ในหลายบริการ**: หาก token ถูกยอมรับโดยหลายบริการโดยไม่มีการตรวจสอบที่เหมาะสม ผู้โจมตีที่เจาะบริการหนึ่งได้อาจใช้ token เพื่อเข้าถึงบริการอื่นที่เชื่อมต่อกัน

### มาตรการลดความเสี่ยง

- **การตรวจสอบ token**: เซิร์ฟเวอร์ MCP **ต้องไม่** รับ token ที่ไม่ได้ออกให้กับเซิร์ฟเวอร์ MCP โดยเฉพาะ
- **การตรวจสอบ audience**: ตรวจสอบเสมอว่า token มี audience claim ที่ถูกต้องตรงกับตัวตนของเซิร์ฟเวอร์ MCP
- **การจัดการวงจรชีวิต token อย่างเหมาะสม**: ใช้ access token ที่มีอายุสั้นและปฏิบัติการหมุนเวียน token อย่างถูกต้องเพื่อลดความเสี่ยงจากการขโมยและการใช้ token ผิดวัตถุประสงค์

# การแฮ็กเซสชัน

### คำชี้แจงปัญหา

การแฮ็กเซสชันเป็นช่องทางโจมตีที่ไคลเอนต์ได้รับ session ID จากเซิร์ฟเวอร์ และบุคคลที่ไม่ได้รับอนุญาตได้มาและใช้ session ID เดียวกันเพื่อแอบอ้างเป็นไคลเอนต์เดิมและทำการกระทำที่ไม่ได้รับอนุญาตแทน โดยเฉพาะอย่างยิ่งในเซิร์ฟเวอร์ HTTP ที่มีสถานะซึ่งจัดการคำขอ MCP

### ความเสี่ยง

- **การฉีดคำสั่งแฮ็กเซสชัน**: ผู้โจมตีที่ได้ session ID อาจส่งเหตุการณ์ที่เป็นอันตรายไปยังเซิร์ฟเวอร์ที่แชร์สถานะเซสชันกับเซิร์ฟเวอร์ที่ไคลเอนต์เชื่อมต่ออยู่ ซึ่งอาจทำให้เกิดการกระทำที่เป็นอันตรายหรือเข้าถึงข้อมูลที่ละเอียดอ่อนได้
- **การแอบอ้างตัวตนด้วยการแฮ็กเซสชัน**: ผู้โจมตีที่มี session ID ขโมยสามารถเรียกใช้เซิร์ฟเวอร์ MCP โดยตรง ข้ามการยืนยันตัวตน และถูกปฏิบัติเหมือนผู้ใช้ที่ถูกต้อง
- **การถูกโจมตีในสตรีมที่สามารถส่งซ้ำได้**: เมื่อเซิร์ฟเวอร์รองรับการส่งซ้ำหรือสตรีมที่สามารถต่อเนื่องได้ ผู้โจมตีอาจยุติคำขอก่อนเวลา ทำให้คำขอนั้นถูกส่งต่อโดยไคลเอนต์เดิมในภายหลังพร้อมเนื้อหาที่อาจเป็นอันตราย

### มาตรการลดความเสี่ยง

- **การตรวจสอบการอนุญาต**: เซิร์ฟเวอร์ MCP ที่ใช้การอนุญาต **ต้อง** ตรวจสอบคำขอที่เข้ามาทั้งหมดและ **ต้องไม่** ใช้เซสชันสำหรับการยืนยันตัวตน
- **การใช้ session ID ที่ปลอดภัย**: เซิร์ฟเวอร์ MCP **ต้อง** ใช้ session ID ที่ปลอดภัยและไม่สามารถทำนายได้ ซึ่งสร้างขึ้นด้วยตัวสร้างเลขสุ่มที่ปลอดภัย หลีกเลี่ยงการใช้ตัวระบุที่คาดเดาได้หรือเรียงลำดับ
- **การผูก session กับผู้ใช้เฉพาะ**: เซิร์ฟเวอร์ MCP **ควร** ผูก session ID กับข้อมูลเฉพาะของผู้ใช้ โดยรวม session ID กับข้อมูลที่ไม่ซ้ำกันของผู้ใช้ที่ได้รับอนุญาต (เช่น internal user ID) ในรูปแบบเช่น `<user_id>:<session_id>`
- **การหมดอายุของเซสชัน**: ดำเนินการหมดอายุและหมุนเวียนเซสชันอย่างเหมาะสมเพื่อลดช่วงเวลาที่เสี่ยงหาก session ID ถูกโจมตี
- **ความปลอดภัยของการสื่อสาร**: ใช้ HTTPS สำหรับการสื่อสารทั้งหมดเสมอเพื่อป้องกันการดักจับ session ID

# ความปลอดภัยของห่วงโซ่อุปทาน

ความปลอดภัยของห่วงโซ่อุปทานยังคงเป็นพื้นฐานสำคัญในยุค AI แต่ขอบเขตของสิ่งที่ถือเป็นห่วงโซ่อุปทานของคุณได้ขยายออกไป นอกจากแพ็กเกจโค้ดแบบดั้งเดิมแล้ว คุณต้องตรวจสอบและติดตามส่วนประกอบที่เกี่ยวข้องกับ AI ทั้งหมดอย่างเข้มงวด รวมถึงโมเดลพื้นฐาน บริการ embeddings ผู้ให้บริการบริบท และ API ของบุคคลที่สาม แต่ละส่วนเหล่านี้อาจนำมาซึ่งช่องโหว่หรือความเสี่ยงหากไม่ได้รับการจัดการอย่างเหมาะสม

**แนวทางปฏิบัติด้านความปลอดภัยของห่วงโซ่อุปทานสำหรับ AI และ MCP:**
- **ตรวจสอบส่วนประกอบทั้งหมดก่อนการรวมเข้าด้วยกัน:** ไม่เพียงแต่ไลบรารีโอเพนซอร์สเท่านั้น แต่รวมถึงโมเดล AI แหล่งข้อมูล และ API ภายนอก ตรวจสอบแหล่งที่มา สิทธิ์การใช้งาน และช่องโหว่ที่ทราบอยู่เสมอ
- **รักษาท่อส่งงานที่ปลอดภัย:** ใช้ท่อส่งงาน CI/CD อัตโนมัติที่มีการสแกนความปลอดภัยในตัวเพื่อตรวจจับปัญหาแต่เนิ่นๆ และมั่นใจว่าเฉพาะอาร์ติแฟกต์ที่เชื่อถือได้เท่านั้นที่จะถูกนำไปใช้ในสภาพแวดล้อมจริง
- **ติดตามและตรวจสอบอย่างต่อเนื่อง:** ดำเนินการติดตามอย่างต่อเนื่องสำหรับทุกการพึ่งพา รวมถึงโมเดลและบริการข้อมูล เพื่อตรวจจับช่องโหว่ใหม่หรือการโจมตีห่วงโซ่อุปทาน
- **ใช้หลักการสิทธิ์น้อยที่สุดและการควบคุมการเข้าถึง:** จำกัดการเข้าถึงโมเดล ข้อมูล และบริการเฉพาะสิ่งที่จำเป็นสำหรับการทำงานของเซิร์ฟเวอร์ MCP ของคุณ
- **ตอบสนองต่อภัยคุกคามอย่างรวดเร็ว:** มีขั้นตอนสำหรับการแพตช์หรือเปลี่ยนส่วนประกอบที่ถูกโจมตี และสำหรับการหมุนเวียนความลับหรือข้อมูลรับรองหากตรวจพบการละเมิด

[GitHub Advanced Security](https://github.com/security/advanced-security) มีฟีเจอร์เช่น การสแกนความลับ การสแกนการพึ่งพา และการวิเคราะห์ CodeQL เครื่องมือเหล่านี้ผสานรวมกับ [Azure DevOps](https://azure.microsoft.com/en-us/products/devops) และ [Azure Repos](https://azure.microsoft.com/en-us/products/devops/repos/) เพื่อช่วยทีมในการระบุและลดช่องโหว่ทั้งในโค้ดและส่วนประกอบห่วงโซ่อุปทาน AI

ไมโครซอฟท์ยังดำเนินการปฏิบัติด้านความปลอดภัยห่วงโซ่อุปทานอย่างเข้มงวดภายในสำหรับผลิตภัณฑ์ทั้งหมด เรียนรู้เพิ่มเติมได้ที่ [The Journey to Secure the Software Supply Chain at Microsoft](https://devblogs.microsoft.com/engineering-at-microsoft/the-journey-to-secure-the-software-supply-chain-at-microsoft/)

# แนวทางปฏิบัติด้านความปลอดภัยที่ได้รับการยอมรับซึ่งจะช่วยยกระดับความปลอดภัยของการใช้งาน MCP ของคุณ

การใช้งาน MCP ใดๆ จะสืบทอดสถานะความปลอดภัยที่มีอยู่ของสภาพแวดล้อมองค์กรที่สร้างขึ้น ดังนั้นเมื่อพิจารณาความปลอดภัยของ MCP ในฐานะส่วนประกอบของระบบ AI โดยรวม ขอแนะนำให้คุณยกระดับสถานะความปลอดภัยโดยรวมที่มีอยู่ แนวทางควบคุมความปลอดภัยที่ได้รับการยอมรับต่อไปนี้มีความสำคัญเป็นพิเศษ:

- แนวทางปฏิบัติการเขียนโค้ดที่ปลอดภัยในแอปพลิเคชัน AI ของคุณ — ป้องกัน [OWASP Top 10](https://owasp.org/www-project-top-ten/), [OWASP Top 10 สำหรับ LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559), การใช้ vault ที่ปลอดภัยสำหรับความลับและ token, การสื่อสารที่ปลอดภัยแบบ end-to-end ระหว่างส่วนประกอบแอปพลิเคชันทั้งหมด เป็นต้น
- การเสริมความแข็งแกร่งของเซิร์ฟเวอร์ — ใช้ MFA เมื่อเป็นไปได้ อัปเดตแพตช์อย่างสม่ำเสมอ รวมเซิร์ฟเวอร์กับผู้ให้บริการตัวตนบุคคลที่สามสำหรับการเข้าถึง เป็นต้น
- รักษาอุปกรณ์ โครงสร้างพื้นฐาน และแอปพลิเคชันให้อัปเดตด้วยแพตช์ล่าสุด
- การตรวจสอบความปลอดภัย — ดำเนินการบันทึกและตรวจสอบแอปพลิเคชัน AI (รวมถึงไคลเอนต์/เซิร์ฟเวอร์ MCP) และส่งบันทึกเหล่านั้นไปยัง SIEM กลางเพื่อการตรวจจับกิจกรรมผิดปกติ
- สถาปัตยกรรม Zero Trust — แยกส่วนประกอบผ่านการควบคุมเครือข่ายและตัวตนในลักษณะที่เป็นตรรกะเพื่อลดการเคลื่อนที่ในแนวนอนหากแอปพลิเคชัน AI ถูกโจมตี

# สรุปประเด็นสำคัญ

- พื้นฐานความปลอดภัยยังคงสำคัญ: การเขียนโค้ดที่ปลอดภัย สิทธิ์น้อยที่สุด การตรวจสอบห่วงโซ่อุปทาน และการติดตามอย่างต่อเนื่องเป็นสิ่งจำเป็นสำหรับงาน MCP และ AI
- MCP นำความเสี่ยงใหม่ๆ เช่น การฉีดคำสั่ง (prompt injection), การวางยาพิษเครื่องมือ (tool poisoning), การแฮ็กเซสชัน, ปัญหา confused deputy, ช่องโหว่ token passthrough และสิทธิ์ที่เกินจำเป็น ซึ่งต้องใช้การควบคุมทั้งแบบดั้งเดิมและเฉพาะ AI
- ใช้การยืนยันตัวตน การอนุญาต และการจัดการ token ที่แข็งแกร่ง โดยใช้ผู้ให้บริการตัวตนภายนอกเช่น Microsoft Entra ID เมื่อเป็นไปได้
- ป้องกันการฉีดคำสั่งทางอ้อมและการวางยาพิษเครื่องมือโดยการตรวจสอบเมตาดาต้าของเครื่องมือ ติดตามการเปลี่ยนแปลงแบบไดนามิก และใช้โซลูชันเช่น Microsoft Prompt Shields
- ดำเนินการจัดการเซสชันอย่างปลอดภัยโดยใช้ session ID ที่ไม่สามารถทำนายได้ ผูกเซสชันกับตัวตนผู้ใช้ และไม่ใช้เซสชันสำหรับการยืนยันตัวตน
- ป้องกันการโจมตี confused deputy โดยการขอความยินยอมจากผู้ใช้อย่างชัดเจนสำหรับแต่ละ client ที่ลงทะเบียนแบบไดนามิก และใช้แนวทางปฏิบัติด้านความปลอดภัย OAuth ที่เหมาะสม
- หลีกเลี่ยงช่องโหว่ token passthrough โดยให้เซิร์ฟเวอร์ MCP รับเฉพาะ token ที่ออกให้กับตนเองเท่านั้นและตรวจสอบ claims ของ token อย่างเหมาะสม
- ปฏิบัติต่อส่วนประกอบทั้งหมดในห่วงโซ่อุปทาน AI ของคุณ — รวมถึงโมเดล embeddings และผู้ให้บริการบริบท — ด้วยความเข้มงวดเทียบเท่ากับการพึ่งพาโค้ด
- ติดตามข้อกำหนด MCP ที่พัฒนาอย่างต่อเนื่องและมีส่วนร่วมกับชุมชนเพื่อช่วยกำหนดมาตรฐานความปลอดภัย

# แหล่งข้อมูลเพิ่มเติม

## แหล่งข้อมูลภายนอก
- [Microsoft Digital Defense Report](https://aka.ms/mddr)
- [MCP Specification](https://spec.modelcontextprotocol.io/)
- [MCP Security Best Practices](https://modelcontextprotocol.io/specification/draft/basic/security_best_practices)
- [MCP Authorization Specification](https://modelcontextprotocol.io/specification/draft/basic/authorization)
- [OAuth 2.0 Security Best Practices (RFC 9700)](https://datatracker.ietf.org/doc/html/rfc9700)
- [Prompt Injection in MCP (Simon Willison)](https://simonwillison.net/2025/Apr/9/mcp-prompt-injection/)
- [Tool Poisoning Attacks (Invariant Labs)](https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks)
- [Rug Pulls in MCP (Wiz Security)](https://www.wiz.io/blog/mcp-security-research-briefing#remote-servers-22)
- [Prompt Shields Documentation (Microsoft)](https://learn.microsoft.com/azure/ai-services/content-safety/concepts/jailbreak-detection)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [OWASP Top 10 for LLMs](https://genai.owasp.org/download/43299/?tmstv=1731900559)
- [GitHub Advanced Security](https://github.com/security/advanced-security)
- [Azure DevOps](https://azure.microsoft.com/products/devops)
- [Azure Repos](https://azure.microsoft.com

**ข้อจำกัดความรับผิดชอบ**:  
เอกสารนี้ได้รับการแปลโดยใช้บริการแปลภาษาอัตโนมัติ [Co-op Translator](https://github.com/Azure/co-op-translator) แม้เราจะพยายามให้ความถูกต้องสูงสุด แต่โปรดทราบว่าการแปลอัตโนมัติอาจมีข้อผิดพลาดหรือความไม่ถูกต้อง เอกสารต้นฉบับในภาษาต้นทางถือเป็นแหล่งข้อมูลที่เชื่อถือได้ สำหรับข้อมูลที่สำคัญ ขอแนะนำให้ใช้บริการแปลโดยผู้เชี่ยวชาญมนุษย์ เราไม่รับผิดชอบต่อความเข้าใจผิดหรือการตีความผิดใด ๆ ที่เกิดจากการใช้การแปลนี้